<?xml version="1.0" encoding="UTF-8"?>
<modification>
  <id>Product Option Image PRO / Изображения опций PRO</id>
  <version>2.3.0</version>
  <vqmver>2.5.X</vqmver>
  <author>Support: support@liveopencart.com / Поддержка: help@liveopencart.ru</author>
  
  
  <file name="admin/model/catalog/option.php,vendorpanel/model/catalog/option.php,admin/model/catalog/mvd_option.php,admin/model/catalog/vdi_option.php,admin/model/editors/option.php" error="skip">
  
    <operation>
      <search position="after"><![CDATA[
      $this->db->query("DELETE FROM " . DB_PREFIX . "option_description
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      if ( !$this->model_module_product_option_image_pro ) {
				$this->load->model('module/product_option_image_pro');
			}
      $this->model_module_product_option_image_pro->deleteRealOptionSettings($option_id);
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
    
    <operation>
      <search position="before"><![CDATA[
      if (isset($data['option_value'])) {
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      if ( !$this->model_module_product_option_image_pro ) {
				$this->load->model('module/product_option_image_pro');
			}
      if (isset($data['poip_settings'])) {
        $this->model_module_product_option_image_pro->setRealOptionSettings($option_id, $data['poip_settings']);
      }
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
  </file>
  
  <file name="admin/controller/catalog/option.php,admin/controller/catalog/mvd_option.php,admin/controller/catalog/vdi_option.php,admin/controller/editors/option.php" error="skip">
    
    <!-- LANGUAGE OC 2.0.X -->
		<operation error="skip">
      <search position="before" regex="true"><![CDATA[~\$this->load->language\('catalog/(mvd_|vdi_)?option'\)~]]></search>
			<!--
			<search position="before"><![CDATA[
      $this->load->language('catalog/
      ]]></search>
			-->
      <add><![CDATA[
      // Product Option Image PRO module <<
      $this->load->language('module/product_option_image_pro');
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
		
		<!-- LANGUAGE OC 2.1.X -->
		<operation error="skip">
      <search position="before" regex="true"><![CDATA[~\$this->language->load\('catalog/(mvd_|vdi_)?option'\)~]]></search>
			<!--
			<search position="before"><![CDATA[
      $this->language->load('catalog/
      ]]></search>
			-->
      <add><![CDATA[
      // Product Option Image PRO module <<
      $this->language->load('module/product_option_image_pro');
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
    
    <!-- MODULE INSTALLED FLAG & MODULE ENTRIES-->
    <operation >
      <search position="after"><![CDATA[
      function getForm()
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      if ( !$this->model_module_product_option_image_pro ) {
				$this->load->model('module/product_option_image_pro');
			}
      $data['poip_installed'] = $this->model_module_product_option_image_pro->installed();
      $data['poip_settings_names'] = $this->model_module_product_option_image_pro->getSettingsNames();
      $data['poip_settings_values'] = $this->model_module_product_option_image_pro->getSettingsValues();
      $data['poip_module_name'] = $this->language->get('poip_module_name');
      $data['poip_saved_settings'] = $this->model_module_product_option_image_pro->getRealOptionSettings( isset($this->request->get['option_id']) ? $this->request->get['option_id'] : 0 );
      
      $data['entry_sort_order_short'] = $this->language->get('entry_sort_order_short');
      $data['poip_settings_select_options'] = array('0'=>$this->language->get('entry_settings_default'), '2'=>$this->language->get('entry_settings_yes'), '1'=>$this->language->get('entry_settings_no'));
      
      $settings_names = $this->model_module_product_option_image_pro->getSettingsNames(false);
      foreach ($settings_names as $setting_name) {
        $data['entry_'.$setting_name] = $this->language->get('entry_'.$setting_name);
        $data['entry_'.$setting_name.'_help'] = $this->language->get('entry_'.$setting_name.'_help');
      }
      $settings_values = $this->model_module_product_option_image_pro->getSettingsValues();
      foreach ($settings_values as $setting_value) {
        $data[$setting_value] = $this->language->get($setting_value); // new
      }
      $data['settings_values'] = $settings_values;
      
			$data['entry_show_hide'] = $this->language->get('entry_show_hide');
      //$data['entry_show_settings'] = $this->language->get('entry_show_settings');
      //$data['entry_hide_settings'] = $this->language->get('entry_hide_settings');
      
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
    
  </file>
  
  
  <file name="admin/view/template/catalog/option_form.tpl,admin/view/template/catalog/mvd_option_form.tpl,admin/view/template/catalog/vdi_option_form.tpl,admin/view/template/editors/option/option_form.tpl" error="skip">
    
    <operation >
      <search position="before"><![CDATA[<table id="option-value" class="table table-striped table-bordered table-hover">]]></search>
      <add><![CDATA[
      <!-- Product Option Image PRO module << -->
      <?php  if ( !empty($poip_installed) ) {  ?>
			
				<div class="form-group">
					<label class="col-sm-2 control-label" for="input-sort-order"><?php echo $poip_module_name; ?>:</label>
					<div class="col-sm-10">
						
						<?php foreach ($poip_settings_names as $poip_setting_name) { ?>
							<div class="col-sm-4">
							<?php echo ${"entry_".$poip_setting_name}; ?>:
							<select name="poip_settings[<?php echo $poip_setting_name; ?>]" class="form-control">
								<?php
									$poip_html = "";
									
									// new
									if (in_array('entry_'.$poip_setting_name."_v0", $poip_settings_values)) {
										$poip_html .= "<option value=\"0\" ".(isset($poip_saved_settings[$poip_setting_name]) && $poip_saved_settings[$poip_setting_name]==0 ? "selected":"").">".$poip_settings_select_options[0]."</option>";
										for ($i=1; $i<9; $i++) {
											if (in_array('entry_'.$poip_setting_name."_v".$i, $poip_settings_values)) {
												$poip_html .= "<option value=\"".(1+$i)."\" ".(isset($poip_saved_settings[$poip_setting_name]) && $poip_saved_settings[$poip_setting_name]==(1+$i) ? "selected":"").">".${("entry_".$poip_setting_name."_v".$i)}."</option>";
											}
										}
										$poip_html .= "<option value=\"".(1)."\" ".(isset($poip_saved_settings[$poip_setting_name]) && $poip_saved_settings[$poip_setting_name]==1 ? "selected":"").">".${("entry_".$poip_setting_name."_v0")}."</option>";
									} else {
										foreach ($poip_settings_select_options as $select_value => $select_name) {
											$poip_html .= "<option value=\"".$select_value."\" ".(isset($poip_saved_settings[$poip_setting_name]) && $poip_saved_settings[$poip_setting_name]==$select_value ? "selected":"").">".$select_name."</option>";
										}
									}
									echo $poip_html;
								?>
								
							</select>
							</div>
						<?php } ?>
						
					</div>
				</div>
      
      <?php  }  ?>
      <!-- >> Product Option Image PRO module -->]]></add>
    </operation>
    
  </file>
  
  <file name="admin/model/catalog/product.php,admin/model/catalog/mproduct.php,admin/model/soconfig/mproduct.php,vendorpanel/model/catalog/product.php,admin/model/catalog/mvd_product.php,admin/model/catalog/vdi_product.php,admin/model/catalog/product_aepro.php,admin/model/editors/product.php" error="skip">
    
    <!-- ADD & EDIT PRODUCT - DELETE OPTIONS IMAGES & OPTIONS IMAGE SETINGS-->
    <operation >
      <search position="after"><![CDATA[
      $this->db->query("DELETE FROM " . DB_PREFIX . "product_option WHERE product_id
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      if ( !$this->model_module_product_option_image_pro ) {
				$this->load->model('module/product_option_image_pro');
			}
      $this->model_module_product_option_image_pro->deleteProductOptionValueImages($product_id);
      $this->model_module_product_option_image_pro->deleteRealProductSettings($product_id);
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
    
    <!-- ADD & EDIT PRODUCT - SAVE OPTIONS IMAGES -->
    <operation >
      <search position="after"><![CDATA[
      $this->db->query("INSERT INTO " . DB_PREFIX . "product_option_value
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      $product_option_value_id = $this->db->getLastId();
      if ( !$this->model_module_product_option_image_pro ) {
				$this->load->model('module/product_option_image_pro');
			}
      if (isset($product_option_value['images'])) {
        $this->model_module_product_option_image_pro->saveProductOptionValueImages($product_id, $product_option_id, $product_option_value_id, $product_option_value['images']);
      }
			
			// dependent options and others compatibility (product_option_image_pro.xml - must be loaded after them)
			// delete and new insert - give as correct result of $product_option_value_id = $this->db->getLastId();
			$query_pov = $this->db->query("SELECT * FROM " . DB_PREFIX . "product_option_value WHERE product_option_value_id = ".$product_option_value_id." ");
			if ($query_pov->num_rows) {
				
				$sql_set = "";
				foreach ($query_pov->row as $pov_key => $pov_value) {
					$sql_set .= ", `".$pov_key."` = '".$this->db->escape($pov_value)."' ";
				}
				$sql_set = substr($sql_set, 1);
				$this->db->query("DELETE FROM " . DB_PREFIX . "product_option_value WHERE product_option_value_id = ".$product_option_value_id." ");
				$this->db->query("INSERT INTO " . DB_PREFIX . "product_option_value SET ".$sql_set);
			}
			
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
    
    <!-- ADD & EDIT PRODUCT - SAVE PRODUCT OPTIONS IMAGE SETTINGS -->
    <operation >
      <search position="after"><![CDATA[
			$product_option_id = $this->db->getLastId();
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      if ( !$this->model_module_product_option_image_pro ) {
				$this->load->model('module/product_option_image_pro');
			}
      if (isset($product_option['poip_settings'])) {
        $this->model_module_product_option_image_pro->setRealProductSettings($product_id, $product_option_id, $product_option['poip_settings']);
      }
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
    
    <!-- GET PRODUCT OPTIONS WITH IMAGES & MODULE SETTINGS-->
    <operation >
      <search position="after"><![CDATA[
      public function getProductOptions($product_id
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      if ( !$this->model_module_product_option_image_pro ) {
				$this->load->model('module/product_option_image_pro');
			}
      $images = $this->model_module_product_option_image_pro->getProductOptionImages($product_id);
      $product_poip_settings = $this->model_module_product_option_image_pro->getRealProductSettings($product_id);
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
    
    <operation >
      <search position="before"><![CDATA[
      $product_option_value_data[] = array(
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      $option_value_images = array();
      if (isset($images[$product_option['product_option_id']][$product_option_value['product_option_value_id']])) {
        foreach ($images[$product_option['product_option_id']][$product_option_value['product_option_value_id']] as $poip_image) {
          $option_value_images[] = $poip_image;
        }
      }
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
    
    <operation >
      <search position="after"><![CDATA[
      $product_option_value_data[] = array(
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      'images' => $option_value_images,
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
    
    <operation >
      <search position="after"><![CDATA[
      $product_option_data[] = array(
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      'poip_settings' => (isset($product_poip_settings[$product_option['product_option_id']]) ? $product_poip_settings[$product_option['product_option_id']] : false),
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
    
		<!-- // new  -->
		<operation >
			<search position="after"><![CDATA[
				$query = $this->db->query("SELECT * FROM " . DB_PREFIX . "product_image WHERE product_id = '"
      ]]></search>
			<!--
      <search position="after"><![CDATA[
      $query = $this->db->query("SELECT * FROM " . DB_PREFIX . "product_image WHERE product_id = '" . (int)$product_id
      ]]></search>
			-->
      <add><![CDATA[
      // Product Option Image PRO module <<
      
			if ( !$this->model_module_product_option_image_pro ) {
				$this->load->model('module/product_option_image_pro');
			}
			if ($this->model_module_product_option_image_pro->installed()) {
			
				$poip_global_settings = $this->model_module_product_option_image_pro->getGlobalSettings();
				if ( $poip_global_settings['options_images_edit'] == 1 ) {
					
					$poip_options_for_images = $this->model_module_product_option_image_pro->getOptionsForImages($product_id);
					
					$included_images = array();
					foreach ($query->rows as &$row) {
						if ( isset($poip_options_for_images[$row['image']]) ) {
							$row['poip'] = $poip_options_for_images[$row['image']];
							$included_images[] = $row['image'];
						} else {
							$row['poip'] = false;
						}
					}
					unset($row);
					
					// if option images is not set for additional image - add this image in additional images array
					foreach ($poip_options_for_images as $poip_image => $image_options) {
						if ( !in_array($poip_image, $included_images) ) {
							$query->rows[] = array('product_image_id'=>0, 'product_id'=>$product_id, 'image'=>$poip_image, 'sort_order'=>0, 'poip'=>$image_options);
						}
					}
					
				}
			}
			
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
  
		
		<!-- // new  -->
		<operation >
      <search position="before" offset="2"><![CDATA[
      $this->db->query("INSERT INTO `" . DB_PREFIX . "product_recurring
      ]]></search>
      <!--
      <search position="before"><![CDATA[
      $this->event->trigger('post.admin.product.add', $product_id);
      ]]></search>
      -->
      <add><![CDATA[
      // Product Option Image PRO module <<
      
			if (isset($data['product_image'])) {
				if ( !$this->model_module_product_option_image_pro ) {
					$this->load->model('module/product_option_image_pro');
				}
				$this->model_module_product_option_image_pro->saveOptionsForImages($product_id, $data['product_image']);
			}
			
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
		
  </file>
  
  
  <file name="admin/controller/catalog/product.php,admin/controller/catalog/mproduct.php,vendorpanel/controller/catalog/product.php,admin/controller/catalog/mvd_product.php,admin/controller/catalog/vdi_product.php,admin/controller/catalog/product_aepro.php,admin/controller/editors/product.php" error="skip">
    
		<!-- LANGUAGE product_aepro 
		<operation error="skip">
      <search position="before"><![CDATA[
      $this->load->language('catalog/product_aepro');
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      $this->load->language('module/product_option_image_pro');
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
		-->
		
    <!-- LANGUAGE OC 2.0.X -->
		<operation error="skip">
      <search position="before" regex="true"><![CDATA[~\$this->load->language\('(catalog|soconfig|editors)/(mvd_|vdi_|m|)product~]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      $this->load->language('module/product_option_image_pro');
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
		
		<!-- LANGUAGE OC 2.1.X -->
		<operation error="skip">
      <search position="before" regex="true"><![CDATA[~\$this->language->load\('(catalog|soconfig)/(mvd_|vdi_|m|)product~]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      $this->language->load('module/product_option_image_pro');
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
    
    
    <!-- MODULE INSTALLED FLAG & MODULE ENTRYES-->
    <operation >
      <search position="after"><![CDATA[
      function getForm()
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      if ( !$this->model_module_product_option_image_pro ) {
				$this->load->model('module/product_option_image_pro');
			}
      $data['poip_installed'] = $this->model_module_product_option_image_pro->installed();
			$data['poip_global_settings'] = $this->model_module_product_option_image_pro->getGlobalSettings();
      $data['poip_settings_names'] = $this->model_module_product_option_image_pro->getSettingsNames();
      $data['poip_settings_values'] = $this->model_module_product_option_image_pro->getSettingsValues();
      $data['poip_module_name'] = $this->language->get('poip_module_name');
      $data['poip_saved_settings'] = $this->model_module_product_option_image_pro->getRealProductSettings( isset($this->request->get['product_id']) ? $this->request->get['product_id'] : 0 );
			
			$data['entry_sort_order_short'] = $this->language->get('entry_sort_order_short');
      $data['poip_settings_select_options'] = array('0'=>$this->language->get('entry_settings_default'), '2'=>$this->language->get('entry_settings_yes'), '1'=>$this->language->get('entry_settings_no'));
      
      $settings_names = $this->model_module_product_option_image_pro->getSettingsNames(false);
      foreach ($settings_names as $setting_name) {
        $data['entry_'.$setting_name] = $this->language->get('entry_'.$setting_name);
        $data['entry_'.$setting_name.'_help'] = $this->language->get('entry_'.$setting_name.'_help');
      }
      $settings_values = $this->model_module_product_option_image_pro->getSettingsValues();
      foreach ($settings_values as $setting_value) {
        $data[$setting_value] = $this->language->get($setting_value); // new
      }
      $data['settings_values'] = $settings_values;
      
      $data['entry_show_settings'] 	= $this->language->get('entry_show_settings');
      $data['entry_hide_settings'] 	= $this->language->get('entry_hide_settings');
			
			$data['entry_no_value'] 			= $this->language->get('entry_no_value');
			$data['entry_no_value_help'] 	= $this->language->get('entry_no_value_help');
			
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
    
    <!-- OPTIONS IMAGES TO TPL -->
    <operation >
      <search position="after"><![CDATA[
      $product_option_value_data[] = array(
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      'images' => (isset($product_option_value['images'])? $this->model_module_product_option_image_pro->addThumbsIfNeeded($product_option_value['images']) : array()),
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
    
		<!-- // new -->
		<operation error="log">
      <search position="after"><![CDATA[
      $data['product_images'][] = array(
      ]]></search>
      <add><![CDATA[
      // << Product Option Image PRO module
      'poip'      => isset($product_image['poip']) ? $product_image['poip'] : false,
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
    
  </file>
  
  
  
  <file name="admin/view/template/catalog/product_form.tpl,vendorpanel/view/template/catalog/product_form.tpl,admin/view/template/catalog/mvd_product_form.tpl,admin/view/template/catalog/vdi_product_form.tpl,admin/view/template/catalog/product_form_aepro.tpl,admin/view/template/catalog/product_form_aepro_modal.tpl,admin/view/template/catalog/product_tshirtecommerce.tpl,admin/view/template/catalog/mproduct_form.tpl,admin/view/template/extension/soconfig/mproduct_form.tpl,admin/view/template/editors/product/product_form.tpl" error="skip">
    
		<!-- << OPTIONS FOR IMAGES STYLE // new -->
		
		<operation >
      <search position="before"><![CDATA[
      <td class="text-right"><?php echo $entry_sort_order; ?></td>
      ]]></search>
      <add><![CDATA[
      <!-- Product Option Image PRO module << -->
      <?php if ( !empty($poip_installed) && $poip_global_settings['options_images_edit'] == 1 ) { //new ?>
        
					<td class="text-left"><?php echo $entry_option; ?></td>  
					
			<?php } ?>
      <!-- >> Product Option Image PRO module -->]]></add>
    </operation>
		 
		<operation error="skip">
      <search position="before"><![CDATA[
      <td class="text-left"><button type="button" onclick="addImage()
      ]]></search>
      <add><![CDATA[
      <!-- Product Option Image PRO module << -->
      <?php if ( !empty($poip_installed) && $poip_global_settings['options_images_edit'] == 1 ) { //new ?>
        
					<td class="text-left"></td>
					
			<?php } ?>
      <!-- >> Product Option Image PRO module -->]]></add>
    </operation>
		
		<!-- Power Image Manager 2.0 comp -->
		<operation error="skip">
      <search position="before"><![CDATA[
      <td class="text-left"><?php if ($pim_status){?><a type="button" data-toggle="manager
      ]]></search>
      <add><![CDATA[
      <!-- Product Option Image PRO module << -->
      <?php if ( !empty($poip_installed) && $poip_global_settings['options_images_edit'] == 1 ) { //new ?>
        
					<td class="text-left"></td>
					
			<?php } ?>
      <!-- >> Product Option Image PRO module -->]]></add>
    </operation>
		
		<!-- Power Image Manager 2.0 comp -->		
		<operation error="skip">
      <search position="after"><![CDATA[
      html += '<img src="'+json.file+'" alt="" title="" data-placeholder="<?php echo $placeholder; ?>" />';
      ]]></search>
      <add><![CDATA[
      // << Product Option Image PRO module
      <?php if ( !empty($poip_installed) ) { ?>
        
					var current_block = $('[id^="div_option_image"][data-poip-fm-active]');
					if ( current_block.length ) {
						
						if ( !current_block.find('input[type="hidden"][id^="option_image"]').attr('value') ) {
							
							current_block.find('input[type="hidden"][id^="option_image"]').attr('value', decodeURIComponent(json.abs));
							current_block.find('a[data-toggle="image"] img').attr('src', json.file);
						} else {
						
							if ( current_block.parent().siblings('button[onclick^="add_option_image"]').length ) {
								current_block.parent().siblings('button[onclick^="add_option_image"]').click();
								
								var new_block = current_block.siblings('[id^="div_option_image"]:last');
								new_block.find('input[type="hidden"][id^="option_image"]').attr('value', decodeURIComponent(json.abs));
								new_block.find('a[data-toggle="image"] img').attr('src', json.file);
								
							}
						}
						return;
					}
			<?php } ?>
      // >> Product Option Image PRO module
				]]></add>
    </operation>
		
		
		<operation >
      <search position="after" regex="true" index="1"><![CDATA[~<div id="content">|<div class="modal-content">~]]></search>
			<!-- <search position="after"><![CDATA[<div id="content">]]></search> -->
      <add><![CDATA[
      <!-- Product Option Image PRO module << -->
      <?php if ( !empty($poip_installed) && $poip_global_settings['options_images_edit'] == 1 ) { //new ?>
        <style>
					.poip-options-to-image {
						vertical-align: top;
					}
					.poip-option-to-image {
						display: inline-block;
						vertical-align: top;
						padding-right: 20px;
					}
					.poip-option-to-image .checkbox {
						width: auto;
						opacity: 1;
						position: relative;
						min-height: 20px;
						padding-top: 1px;
						white-space: nowrap;
					}
				</style>
				<script type="text/javascript"><!--
					
					var product_options = <?php echo (isset($product_options) && $product_options) ? json_encode($product_options) : 'false' ; ?>;
					var option_values = <?php echo (isset($option_values) && $option_values) ? json_encode($option_values) : 'false' ; ?>;
					
					function poip_get_product_option_value_name(option_id, option_value_id) {
						for (var i in option_values[option_id]) {
							if (option_values[option_id][i]['option_value_id'] == option_value_id) {
								return option_values[option_id][i]['name'];
							}
						}
					}
					
					function poip_show_image_options(row, data) {
						if ( !$('#image-row'+row).length ) return;
						if ( !$('#image-row'+row+' td[data-poip-options]').length ) {
							$('#image-row'+row+' td:first').after('<td class="poip-options-to-image text-left" data-poip-options ></td>');
						}
						
						var html = '';
						var checkbox_names = [];
						
						for (var i in product_options) {
							if ( !product_options.hasOwnProperty(i) ) continue;
							
							var product_option = product_options[i];
							
							if ( $.inArray(product_option['type'], ['select', 'radio', 'image', 'checkbox', 'color', 'block']) != -1) {
								
								html+= '<div class="text-left poip-option-to-image">';
								html+= '<b>'+product_option['name']+'</b><br>';
								
								var checkbox_name = 'product_image['+row+'][poip]['+product_option['option_id']+'][]';
								checkbox_names.push(checkbox_name);
								
								for (var j in product_option['product_option_value']) {
									if ( !product_option['product_option_value'].hasOwnProperty(j) ) continue;
								
									var product_option_value = product_option['product_option_value'][j];
									
									html+= '<div class="checkbox" >';
									html+= '<label>';
									html+= '<input type="checkbox" name="'+checkbox_name+'" value="'+product_option_value['option_value_id']+'"';
									if (data && data['poip'] && data['poip'][product_option['option_id']]) {
										if ( $.inArray(product_option_value['option_value_id'], data['poip'][product_option['option_id']]) != -1 ) {
											html+= ' checked ';
										}
									}
									html+= '>&nbsp;'+poip_get_product_option_value_name(product_option['option_id'], product_option_value['option_value_id']);
									html+= '</label>';
									html+= '</div>';
									
									html+= '';
									html+= '';
								}
								
								// no value
								html+= '<div class="checkbox" >';
								html+= '<i><label title="<?php echo addslashes($entry_no_value_help); ?>">';
								html+= '<input type="checkbox" name="'+checkbox_name+'" value="0"';
								if (data && data['poip'] && data['poip'][product_option['option_id']]) {
									if ( $.inArray(0, data['poip'][product_option['option_id']]) != -1 ) {
										html+= ' checked ';
									}
								}
								html+= '>&nbsp;<?php echo addslashes($entry_no_value); ?>';
								html+= '</label></i>';
								html+= '</div>';
								
								html+= '</div>';
							}
						}
						$('#image-row'+row+' td[data-poip-options]').html(html);
						
						for ( var i_checkbox_names in checkbox_names ) {
							if ( !checkbox_names.hasOwnProperty(i_checkbox_names) ) continue;
							var checkbox_name = checkbox_names[i_checkbox_names];
							poip_setAvailabilityOfNoValueByName(checkbox_name);
						}
						
					}
					
					
					// << visibility of the checkbox "no value"
					function poip_setAvailabilityOfNoValueByName(name) {
						var no_value_disabled = ( $(':checkbox[name="'+name+'"][value!="0"]:checked').length == 0 );
						$(':checkbox[name="'+name+'"][value="0"]').prop('disabled', no_value_disabled);
						$(':checkbox[name="'+name+'"][value="0"]').parent().fadeTo('fast', (no_value_disabled ? 0.1 : 1) ); // label
					}
					$(document).on('change', ':checkbox[name^="product_image["][name*="[poip]["][value!="0"]', function(){
						poip_setAvailabilityOfNoValueByName( $(this).attr('name') );
					});

					// >> visibility of the checkbox "no value"
					
				//--></script>
					
			<?php } ?>
      <!-- >> Product Option Image PRO module -->]]></add>
    </operation>
		
		<operation >
      <search position="before"><![CDATA[
      <?php $image_row++; ?>
      ]]></search>
      <add><![CDATA[
      <!-- Product Option Image PRO module << -->
      <?php if ( !empty($poip_installed) && $poip_global_settings['options_images_edit'] == 1 ) { //new ?>
        
				<script type="text/javascript"><!--
					poip_show_image_options(<?php echo $image_row; ?>, <?php echo json_encode($product_image); ?>);
				//--></script>
					
			<?php } ?>
      <!-- >> Product Option Image PRO module -->]]></add>
    </operation>
		
		<operation >
      <search position="after"><![CDATA[
      $('#images tbody').append(html);
      ]]></search>
      <add><![CDATA[
      <!-- Product Option Image PRO module << -->
      <?php if ( !empty($poip_installed) && $poip_global_settings['options_images_edit'] == 1 ) { //new ?>
				poip_show_image_options(image_row);
			<?php } ?>
			
      <!-- >> Product Option Image PRO module -->]]></add>
    </operation>
		
		<!-- >> OPTIONS FOR IMAGES STYLE -->
		
    <!-- MODULE INIT -->
    <operation error="skip">
			<search position="after" index="1" regex="true"><![CDATA[~echo \$header;[ ]*\?>~]]></search>
			<!--<search position="after" regex="true" index="1"><![CDATA[~<\?php echo \$header; \?>|<div class="modal-dialog">~]]></search>-->
      <!-- <search position="after"><![CDATA[<?php echo $header; ?>]]></search> -->
			<ignoreif><![CDATA[SET POIP SCRIPT AFTER HEADER]]></ignoreif>
      <add><![CDATA[<?php
        if (!empty($poip_installed)) {
					// SET POIP SCRIPT AFTER HEADER
          $poip_script = "";
        }
      ?>]]></add>
    </operation>
		
		<operation error="skip">
			<search position="iafter" index="1"><![CDATA[<div class="modal-dialog">]]></search>
			<!--<search position="after" regex="true" index="1"><![CDATA[~<\?php echo \$header; \?>|<div class="modal-dialog">~]]></search>-->
      <!-- <search position="after"><![CDATA[<?php echo $header; ?>]]></search> -->
			<ignoreif><![CDATA[// SET POIP SCRIPT AFTER HEADER]]></ignoreif>
      <add><![CDATA[
      <!-- Product Option Image PRO module << -->
      <?php
        if (!empty($poip_installed)) {
					// SET POIP SCRIPT AFTER HEADER
          $poip_script = "";
        }
      ?>
      <!-- >> Product Option Image PRO module -->]]></add>
    </operation>
    
    <!-- PRODUCT OPTION SETTINGS : injection in middle of text, including js - line breaks inside of php is not allowed -->
    <operation >
      <search position="ibefore"><![CDATA[
      <label class="col-sm-2 control-label" for="input-required
      ]]></search>
      <add><![CDATA[<?php
      // Product Option Image PRO module <<
      if ( !empty($poip_installed) ) {
        $poip_html  = "<div poip_settings style=\"display: none; \">";
        $poip_html .= "<label class=\"col-sm-2 control-label\">".$poip_module_name."</label>";
				$poip_html .= "<div class=\"col-sm-10\">";
        //$poip_html .= "<a id=\"poip_settings_on\" onclick=\"poip_settings_toggle(this);\">".$entry_show_settings."</a>";
        //$poip_html .= "<a id=\"poip_settings_off\" onclick=\"poip_settings_toggle(this);\" style=\"display: none;\">".$entry_hide_settings."</a>";
        //$poip_html .= "<table id=\"poip_settings_values\" style=\"display: none;\">";
        foreach ($poip_settings_names as $poip_setting_name) {
          $poip_html .= "<div class=\"col-sm-4\" style=\"padding-left:0px;\">";
          $poip_entry_name = "entry_".$poip_setting_name;
          $poip_html .= "".$$poip_entry_name.":";
          $poip_html .= "";
          $poip_html .= "<select ".$poip_setting_name." class=\"form-control\">";
          // new
          if (in_array('entry_'.$poip_setting_name."_v0", $poip_settings_values)) {
            $poip_html .= "<option value=\"0\">".$poip_settings_select_options[0]."</option>";
            for ($i=1; $i<9; $i++) {
              if (in_array('entry_'.$poip_setting_name."_v".$i, $poip_settings_values)) {
                $poip_html .= "<option value=\"".(1+$i)."\">".${("entry_".$poip_setting_name."_v".$i)}."</option>";
              }
            }
            $poip_html .= "<option value=\"".(1)."\">".${("entry_".$poip_setting_name."_v0")}."</option>";
          } else {
            foreach ($poip_settings_select_options as $select_value => $select_name) {
              $poip_html .= "<option value=\"".$select_value."\">".$select_name."</option>";
            }
          }
          $poip_html .= "</select>";
          $poip_html .= "</div>";
        }
				$poip_html .= "</div>";
        $poip_html .= "</div>";
        $poip_html .= "</div><div class=\"form-group\">";
        echo $poip_html;
      }
      // >> Product Option Image PRO module
      ?>]]></add>
    </operation>
    
    
    
    <!-- show recently added options -->
    <operation>
      <search position="after"><![CDATA[
      $('#tab-option .tab-content').append(html);
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module << // new
      <?php  if ( !empty($poip_installed) ) {  ?>
        if (item['type'] == 'select' || item['type'] == 'radio' || item['type'] == 'checkbox' || item['type'] == 'image' || item['type'] == 'block' || item['type'] == 'color') {
          poip_refresh_settings();
        }
      <?php } ?>
      // >> Product Option Image PRO module 
      ]]></add>
    </operation>
		
    <!-- OPTION VALUES HEAD -->
    <operation error="skip">
      <search position="iafter"><![CDATA[
				<td class="text-right"><?php echo $entry_weight; ?></td>
      ]]></search>
			<ignoreif><![CDATA[
				POIP OPTION TABLE HEAD
      ]]></ignoreif>
      <add><![CDATA[<?php if ( !empty($poip_installed) && !$poip_global_settings['options_images_edit'] ) { ?><td class="text-left" style="width:240px;"><?php echo $entry_image; ?></td><?php } // POIP OPTION TABLE HEAD // POIP SCRIPT OPTION TABLE HEAD ?>]]></add>
    </operation>

		<!-- OPTION VALUES HEAD comp with other developer RO extension -->
		<operation error="skip">
      <search position="iafter"><![CDATA[
      <td class="text-right relate-option"><?php echo $entry_weight; ?></td>
      ]]></search>
      <add><![CDATA[<!-- Product Option Image PRO module << // new --><?php if ( !empty($poip_installed) && !$poip_global_settings['options_images_edit'] ) { ?><td class="text-left" style="width:240px;"><?php echo $entry_image; ?></td><?php } ?><!-- >> Product Option Image PRO module -->]]></add>
    </operation>
		<!-- for openstock -->
		<operation error="skip">
      <search position="iafter"><![CDATA[
      <td class="text-right os-option-input"><?php echo $entry_weight; ?></td>
      ]]></search>
      <add><![CDATA[<!-- Product Option Image PRO module << // new --><?php if ( !empty($poip_installed) && !$poip_global_settings['options_images_edit'] ) { ?><td class="text-left" style="width:240px;"><?php echo $entry_image; ?></td><?php } ?><!-- >> Product Option Image PRO module -->]]></add>
    </operation>
    
    <!-- OPTION VALUES ROWS -->
    <operation error="skip">
      <search position="after"><![CDATA[
      value="<?php echo $product_option_value['weight']; ?>"
      ]]></search>
			<ignoreif><![CDATA[
				POIP OPTION VALUE ROWS
      ]]></ignoreif>
      <add><![CDATA[
				<!-- Product Option Image PRO module << -->
				<?php
					// POIP OPTION VALUE ROWS // 1
					if ( !empty($poip_installed) && !$poip_global_settings['options_images_edit'] && empty($poip_opion_image_column_displayed[$option_value_row]) ) {
						if (isset($product_option_value['images']) && is_array($product_option_value['images'])) {
							foreach ($product_option_value['images'] as $pov_image) {
								$poip_script .= "add_option_image(".$option_row.", $option_value_row, '".addslashes($pov_image['thumb'])."', '".addslashes($pov_image['image'])."', ".(int)$pov_image['srt'].");\n";
							}
						}
				?>
						<td >
								<button type="button" class="btn btn-default" onclick="add_option_image(<?php echo $option_row; ?>, <?php echo $option_value_row; ?>);" title="<?php echo $button_image_add; ?>">
									<i class="fa fa-plus-circle"></i>
								</button>
							</a>
							<div id="option_images<?php echo $option_row; ?>_<?php echo $option_value_row; ?>"></div>
						</td>
				<?php
						$poip_opion_image_column_displayed[$option_value_row] = true;
					}
				?>
				<!-- >> Product Option Image PRO module -->
      ]]></add>
    </operation>
		
		<!-- OPTION VALUES ROWS for one specific custom modification -->
    <operation error="skip">
      <search position="before"><![CDATA[
      	<td class="text-left"><button type="button" onclick="$(this).tooltip('destroy');$('#option-value-row<?php echo $option_value_row; ?>').remove();"
      ]]></search>
			<ignoreif><![CDATA[
				POIP OPTION VALUE ROWS
      ]]></ignoreif>
      <add><![CDATA[
				<!-- Product Option Image PRO module << -->
				<?php
					// POIP OPTION VALUE ROWS // 2
					if ( !empty($poip_installed) && !$poip_global_settings['options_images_edit'] && empty($poip_opion_image_column_displayed[$option_value_row]) ) {
						if (isset($product_option_value['images']) && is_array($product_option_value['images'])) {
							foreach ($product_option_value['images'] as $pov_image) {
								$poip_script .= "add_option_image(".$option_row.", $option_value_row, '".addslashes($pov_image['thumb'])."', '".addslashes($pov_image['image'])."', ".(int)$pov_image['srt'].");\n";
							}
						}
				?>
						<td >
								<button type="button" class="btn btn-default" onclick="add_option_image(<?php echo $option_row; ?>, <?php echo $option_value_row; ?>);" title="<?php echo $button_image_add; ?>">
									<i class="fa fa-plus-circle"></i>
								</button>
							</a>
							<div id="option_images<?php echo $option_row; ?>_<?php echo $option_value_row; ?>"></div>
						</td>
				<?php
						$poip_opion_image_column_displayed[$option_value_row] = true;
					}
				?>
				<!-- >> Product Option Image PRO module -->
      ]]></add>
    </operation>
    <!-- option value rows - script -->
    <operation error="skip">
      <search position="after"><![CDATA[
				[product_option_value][' + option_value_row + '][weight]
      ]]></search>
			<ignoreif><![CDATA[
				POIP SCRIPT OPTION VALUE ROWS
      ]]></ignoreif>
      <add><![CDATA[
				// Product Option Image PRO module <<
				// POIP SCRIPT OPTION VALUE ROWS // 1
				<?php if ( !empty($poip_installed) && !$poip_global_settings['options_images_edit'] && empty($poip_option_image_script_added) ) { ?>
					html += '<td><button type="button" class="btn btn-default" onclick="add_option_image('+option_row+', '+option_value_row+');"><i class="fa fa-plus-circle"></i></button><div id="option_images'+option_row+'_'+option_value_row+'"></div></td>';
					<?php $poip_option_image_script_added = true; ?>		
				<?php } ?>
				// >> Product Option Image PRO module
      ]]></add>
    </operation>
		<!-- option value rows - script - for one custom modificaiton -->
		<operation error="skip">
      <search position="before"><![CDATA[
				<td class="text-left"><button type="button" onclick="$(this).tooltip(\'destroy\');$(\'#option-value-row' + option_value_row + '\').remove();"
      ]]></search>
			<ignoreif><![CDATA[
				POIP SCRIPT OPTION VALUE ROWS
      ]]></ignoreif>
      <add><![CDATA[
				// Product Option Image PRO module <<
				// POIP SCRIPT OPTION VALUE ROWS // 2
				<?php if ( !empty($poip_installed) && !$poip_global_settings['options_images_edit']  && empty($poip_option_image_script_added) ) { ?>
					html += '<td><button type="button" class="btn btn-default" onclick="add_option_image('+option_row+', '+option_value_row+');"><i class="fa fa-plus-circle"></i></button><div id="option_images'+option_row+'_'+option_value_row+'"></div></td>';
					<?php $poip_option_image_script_added = true; ?>		
				<?php } ?>
				// >> Product Option Image PRO module
      ]]></add>
    </operation>
    
    <!-- OPTION VALUES TABLE BOTTOM ROW -->
    <operation error="log">
      <search position="ibefore"><![CDATA[
      <td class="text-left"><button type="button" onclick="addOptionValue
      ]]></search>
      <add><![CDATA[<!-- Product Option Image PRO module << // new --><?php if ( !empty($poip_installed) && !$poip_global_settings['options_images_edit'] ) { ?><td></td><?php } ?><!-- >> Product Option Image PRO module -->]]></add>
    </operation>
		<!-- custom -->
		<operation error="skip">
      <search position="ibefore"><![CDATA[
      <td class="text-left"><button type="button" onclick="addBanntionValue
      ]]></search>
      <add><![CDATA[<!-- Product Option Image PRO module << // new --><?php if ( !empty($poip_installed) && !$poip_global_settings['options_images_edit'] ) { ?><td></td><?php } ?><!-- >> Product Option Image PRO module -->]]></add>
    </operation>
    
    
    
    <!-- SCRIPTS -->
    <operation >
      <search position="after"><![CDATA[
      var option_value_row
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      <?php
        if ( !empty($poip_installed) ) {
      ?>
      var option_image_row = 0;
      var poip_saved_settings = <?php echo json_encode($poip_saved_settings); ?>;
      
      function poip_settings_toggle(elem) {
        $(elem).toggle();
        $(elem).siblings('#poip_settings_values').toggle();
        $(elem).siblings('#poip_settings_on').toggle();
        $(elem).siblings('#poip_settings_off').toggle();
      }
      
      function poip_refresh_settings() {
        var poip_tabs = $('[id^=tab-option ]');
				var for_types = ['select','radio','checkbox','image','block','color'];
					
				for (var i=0;i<poip_tabs.length;i++) {
				
					if ( $(poip_tabs[i]).closest('#tab-optionCFO').length ) {
						$(poip_tabs[i]).find('[poip_settings]').remove();
						continue;
					}
				
					if ($(poip_tabs[i]).find('input[type=hidden][name*=\\[type\\]]').length && $.inArray($(poip_tabs[i]).find('input[type=hidden][name*=\\[type\\]]').val(), for_types) != -1 ) {
						$(poip_tabs[i]).find('[poip_settings]').show();
					}
					var option_row = poip_tabs[i].id.substr(10);
					<?php  foreach ($poip_settings_names as $poip_setting_name) {  ?>
					$(poip_tabs[i]).find('[<?php echo $poip_setting_name; ?>]').attr('name', 'product_option['+option_row+'][poip_settings][<?php echo $poip_setting_name; ?>]');
					<?php  }  ?>
				}
				
				
      }
      
      function poip_fill_settings() {
        var poip_tabs = $('[id^=tab-option]');
        for (var i=0;i<poip_tabs.length;i++) {
          var option_row = poip_tabs[i].id.substr(10);
          if ($(poip_tabs[i]).find('[name=product_option\\['+option_row+'\\]\\[product_option_id\\]]').length) {
            var product_option_id = $(poip_tabs[i]).find('[name=product_option\\['+option_row+'\\]\\[product_option_id\\]]')[0].value;
            if (poip_saved_settings[product_option_id]) {
              <?php  foreach ($poip_settings_names as $poip_setting_name) {  ?>
                if (poip_saved_settings[product_option_id]['<?php echo $poip_setting_name; ?>']) {
                  $(poip_tabs[i]).find('[<?php echo $poip_setting_name; ?>]').val(poip_saved_settings[product_option_id]['<?php echo $poip_setting_name; ?>']);
                }
              <?php  }  ?>
            }
          }
        }
      }
      
      function add_option_image(option_row, option_value_row, thumb, image, srt) {

        
        html = '';
        
        html += '<div id="div_option_image'+option_image_row+'" style="float:left;">';
				//html += '<div class="image" style="margin: 2px; padding: 5px;  width:100px;" id="div_option_image'+option_image_row+'">';
        if (image && thumb) {
          var current_thumb = thumb;
          var current_image = image;
          var current_srt = srt;
        } else {
          var current_thumb = '<?php echo $placeholder; ?>';
          var current_image = '';
          var current_srt = 0;
          $('#option_images'+option_row+'_'+option_value_row).find('[name*=\\[srt\\]]').each(function() {
            current_srt = Math.max(current_srt, (parseInt(this.value)?parseInt(this.value):0));
          });
          current_srt++;
        }
				
				
				html += '<a href="" id="thumb-option-image'+option_image_row+'" data-toggle="image" class="img-thumbnail" >';
				html += '<img height="100" width="100" src="'+current_thumb+'" alt="" title="" data-placeholder="<?php echo $placeholder; ?>">';
				html += '</a>';
				html += '<input type="hidden" id="option_image'+option_image_row+'" name="product_option[' + option_row + '][product_option_value][' + option_value_row + '][images]['+option_image_row+'][image]" value="'+current_image+'">';
				html += '<div>';
				html += '<input  type="text" class="form-control" style="width:72px;float:left;" title="<?php echo $entry_sort_order; ?>" name="product_option[' + option_row + '][product_option_value][' + option_value_row + '][images]['+option_image_row+'][srt]" value="'+current_srt+'" size="3">';
				html += '<button class="btn btn-default" title="<?php echo $button_remove; ?>" onclick="$(\'#div_option_image' + option_image_row + '\').remove();"><i class="fa fa-trash-o"></i></button>';
				html += '</div>';
				
        html += '</div>';
        
        $('#option_images'+option_row+'_'+option_value_row).append(html);
        
        option_image_row++;
        
      }
      
      $(document).ready(function(){
        
        <?php
          echo $poip_script;
        ?>
        poip_fill_settings();
        poip_refresh_settings();
        
      });
      
      
      <?php
        }
      ?>
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
    
    
  </file>
  


	
	<file name="admin/controller/sale/order.php,vendorpanel/controller/sale/order.php" error="skip">
		<operation >
      <search position="after" error="log"><![CDATA[
      $options = $this->model_sale_order->getOrderOptions(
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
			if ( !empty($product['product_id']) ) {
				if ( !$this->model_module_product_option_image_pro ) {
					$this->load->model('module/product_option_image_pro');
				}
				$poip_installed = $this->model_module_product_option_image_pro->installed();
				if ($poip_installed) {
					if (isset($product['img'])) {
						$product['img'] = array('image'=>$this->model_module_product_option_image_pro->getProductOrderImage($product['product_id'], $options, (isset($product['img']['image'])) ? $product['img']['image'] : $product['img'] ));
					}
					// compatibility with extensions showing product images on order info page
					if ( isset($image) && $this->config->get($this->config->get('config_theme') . '_image_cart_width') && $this->config->get($this->config->get('config_theme') . '_image_cart_height') ) {
						$poip_image = $this->model_module_product_option_image_pro->getProductOrderImage($product['product_id'], $options, '' );
						if ($poip_image) {
							$image = $this->model_tool_image->resize($poip_image, $this->config->get($this->config->get('config_theme') . '_image_cart_width'), $this->config->get($this->config->get('config_theme') . '_image_cart_height'));
						}
					}
				}
			}
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
	</file>

	<!-- Product Images in Order Info Page && Product Images in Invoice -->
  <file name="admin/controller/sale/order.php">
		<operation error="skip">
			<search position="before"><![CDATA[
			$thumb = $this->model_tool_image->resize($image, 60, 60);
			]]></search>
			<add><![CDATA[
			// << Product Option Image PRO module
      if ( !$this->model_module_product_option_image_pro ) {
				$this->load->model('module/product_option_image_pro');
			}
      $image = $this->model_module_product_option_image_pro->getProductOrderImage((int)$product['product_id'], $options, $image);
      // >> Product Option Image PRO module
			]]></add>
		</operation>
  </file>
	
	<file name="admin/view/template/common/footer.tpl" error="log">
		
		<operation error="skip">
			<search position="after"><![CDATA[$('#button-image').on('click', function() {]]></search>
			<add><![CDATA[
			// << Product Option Image PRO
			$('[id^="div_option_image"]').removeAttr('data-poip-fm-active');
			if ( $(this).parent().parent().parent().is('[id^="div_option_image"]') ) {
				$(this).parent().parent().parent().attr('data-poip-fm-active', true);
			}
			// >> Product Option Image PRO
			]]></add>
		</operation>
		
		<operation error="skip">
			<search position="after"><![CDATA[$(document).delegate('a[data-toggle=\'manager\']', 'click', function(e) {]]></search>
			<add><![CDATA[
			// << Product Option Image PRO
			$('[id^="div_option_image"]').removeAttr('data-poip-fm-active');
			if ( $(this).parent().parent().parent().is('[id^="div_option_image"]') ) {
				$(this).parent().parent().parent().attr('data-poip-fm-active', true);
			}
			// >> Product Option Image PRO
			]]></add>
		</operation>
		
  </file>

<!-- ****************** FRONTEND ******************** -->

	
  <file name="catalog/model/catalog/product.php">  
    
    <operation >
      <search position="after"><![CDATA[
      public function getProductOptions($product_id
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      if ( !$this->model_module_product_option_image_pro ) {
				$this->load->model('module/product_option_image_pro');
			}
      $poip_installed = $this->model_module_product_option_image_pro->installed();
      if ($poip_installed) {
        $product_options_images = $this->model_module_product_option_image_pro->getProductOptionImages($product_id, false, false);
        $product_options_settings = $this->model_module_product_option_image_pro->getProductSettings($product_id);
      }
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
		
		<operation error="skip">
			<search position="after" regex="true"><![CDATA[~\$query = \$this->db->query\("SELECT \* FROM " \. DB_PREFIX \. "product_image WHERE product_id|\$query = \$this->db->query\(\$sql\);~]]></search>
			<!--
      <search position="after"><![CDATA[
			  $query = $this->db->query("SELECT * FROM " . DB_PREFIX . "product_image WHERE product_id
      ]]></search>
			-->
      <add><![CDATA[
				if ( __FUNCTION__ == 'getProductImages' ) {
					// Product Option Image PRO module <<
					if ( !$this->model_module_product_option_image_pro ) {
						$this->load->model('module/product_option_image_pro');
					}
					
					$query->rows = $this->model_module_product_option_image_pro->addMainProductImageToAdditional($product_id, $query->rows);
					
					// >> Product Option Image PRO module
				}
      ]]></add>
    </operation>
		
    
    <operation >
      <search position="after"><![CDATA[
      foreach ($product_option_value_query->rows as $product_option_value) {
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      if ( !empty($poip_installed) ) {
        if ( isset($product_options_settings[(int)$product_option['product_option_id']]['img_first']) && $product_options_settings[(int)$product_option['product_option_id']]['img_first'] ) {
          if ( isset($product_options_images[(int)$product_option['product_option_id']][$product_option_value['product_option_value_id']][0]['image'])) {
            $product_option_value['image'] = $product_options_images[(int)$product_option['product_option_id']][$product_option_value['product_option_value_id']][0]['image'];
          }
        }
				if ( isset($product_options_settings[(int)$product_option['product_option_id']]['img_radio_checkbox']) && $product_options_settings[(int)$product_option['product_option_id']]['img_radio_checkbox'] ) {
					
					$product_option_value['poip_image'] = $product_option_value['image'];
				
					if ( isset($product_options_settings[(int)$product_option['product_option_id']]['img_first']) && $product_options_settings[(int)$product_option['product_option_id']]['img_first'] ) {
						if ( isset($product_options_images[(int)$product_option['product_option_id']][$product_option_value['product_option_value_id']][0]['image'])) {
							$product_option_value['poip_image'] = $product_options_images[(int)$product_option['product_option_id']][$product_option_value['product_option_value_id']][0]['image'];
						}
					}
        }
      }
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
		
		<operation >
      <search position="after"><![CDATA[
      $product_option_value_data[] = array(
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      'poip_image'                   => isset($product_option_value['poip_image']) ? $product_option_value['poip_image'] : '',
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
		
		
    
  </file>
	
	<!-- quickview - compatibility with themeXXX -->
	<file name="catalog/controller/extension/module/tm_ajax_quick_view.php" error="skip">
		
		<operation >
      <search position="after" ><![CDATA[$additional_images = $this->model_catalog_product->getProductImages($product_id);]]></search>
      <add><![CDATA[
			
      // Product Option Image PRO module <<
			// $this->request->get['pid'] - journal2 quickview
			//$poip_product_id = !(isset($this->request->get['product_id'])) ? $this->request->get['pid'] : $this->request->get['product_id'];
      if ( isset($this->request->get['product_id']) ) {
        $poip_product_id = $this->request->get['product_id'];
      } elseif ( isset($this->request->get['pid']) ) {
        $poip_product_id = $this->request->get['pid'];
			} elseif ( isset($this->request->post['product_id']) ) {
				$poip_product_id = $this->request->post['product_id'];
      } else {
        $poip_product_id = $this->request->get['prod_id'];
      }
			
      if ( !$this->model_module_product_option_image_pro ) {
				$this->load->model('module/product_option_image_pro');
			}
      $data['poip_installed'] = $this->model_module_product_option_image_pro->installed();
			$data['poip_inclide_file_name_default'] = $this->model_module_product_option_image_pro->getTemplateIncludeFileName('product', true);
			$data['poip_inclide_file_name_custom'] = $this->model_module_product_option_image_pro->getTemplateIncludeFileName('product');
			
			$data['poip_theme_name'] = $this->model_module_product_option_image_pro->getThemeName();
			
			$data['current_class'] = 'related_products';
      if ($data['poip_installed']) {
        $data['poip_product_settings'] = $this->model_module_product_option_image_pro->getProductSettings($poip_product_id);
        $data['poip_settings'] = $this->model_module_product_option_image_pro->getSettings();
        
        $poip_results = $this->model_module_product_option_image_pro->addOptionImagesToProductImages($additional_images, $poip_product_id, array() );
        $additional_images = $poip_results['results'];
        $product_images = $poip_results['product_images'];
				
				foreach ( $product_images as &$poip_image ) {
					$poip_image['quick'] = $this->model_tool_image->resize($poip_image['image'], $image_width, $image_height);
				}
				unset($poip_image);
        $data['poip_images'] = $product_images;
        $data['poip_product_option_ids'] = $this->model_module_product_option_image_pro->getProductOptionsIdsWithImages($product_images);
        $data['poip_images_by_options'] = $this->model_module_product_option_image_pro->getProductOptionImagesByValues($poip_product_id);
				
				
				
				$poip_ov = $this->model_module_product_option_image_pro->getPOIPIdFromRequest();
				if ( $poip_ov ) {
					$data['poip_ov'] = $poip_ov;
				}
				
        
      }
      //>> Product Option Image PRO module
      ]]></add>
    </operation>
		
	</file>
    
	<!-- catalog/controller/themecontrol/product.php - pav fashion -->
  <file name="catalog/controller/product/product.php,catalog/controller/extension/module/ocquickview.php,catalog/controller/module/oct_popup_view.php,catalog/controller/extension/module/oct_popup_view.php,catalog/controller/product/quickview.php,catalog/controller/product/quick_view.php,catalog/controller/welldone/quickview.php,catalog/controller/themecontrol/product.php,catalog/controller/journal2/quickview.php,catalog/controller/extension/soconfig/quickview.php,catalog/controller/extension/module/barbara_quickview.php" error="skip">  
    
    <operation error="skip">
      <search position="after" ><![CDATA[
				$data['images'][] = array(
      ]]></search>
      <add><![CDATA[
				// Product Option Image PRO module <<
				'title' => isset($result['title']) ? $result['title'] : '',
				// >> Product Option Image PRO module
      ]]></add>
    </operation>
    
		<operation >
			<search position="before" ><![CDATA[$this->model_catalog_product->getProductImages(]]></search>
      <add><![CDATA[
				// Product Option Image PRO module <<
				if ( !$this->model_module_product_option_image_pro ) {
					$this->load->model('module/product_option_image_pro');
				}
				//>> Product Option Image PRO module
      ]]></add>
    </operation>
		<!--
		<operation >
			<search position="ireplace" ><![CDATA[$this->model_catalog_product->getProductImages(]]></search>
      <add><![CDATA[ /* POIP */ $this->model_module_product_option_image_pro->getProductImagesForProductPage($data, /* POIP */ ]]></add>
    </operation>
		-->
		
    <operation error="skip">
			<search position="after"><![CDATA[$results = $this->model_catalog_product->getProductImages(]]></search>
      <add><![CDATA[
			
				// Product Option Image PRO module <<
				
				if ( !$this->model_module_product_option_image_pro ) {
					$this->load->model('module/product_option_image_pro');
				}
				if ( $this->model_module_product_option_image_pro->getThemeName() == 'barbaratheme' && !empty($data['page_type']) && $data['page_type'] == 'quickview' ) {
					
					$poip_data = $this->model_module_product_option_image_pro->getDataForProductPage($results, array( 'popup_width' => $config_image_thumb_width, 'popup_height' => $config_image_thumb_height ));
				} else {
					$poip_data = $this->model_module_product_option_image_pro->getDataForProductPage($results);
				}
				if ( $poip_data ) {
					$data = array_merge($data, $poip_data['data']);
					$results = $poip_data['results'];
				}
			
				//>> Product Option Image PRO module
      ]]></add>
    </operation>
		
		<!-- custom -->
		<operation error="skip">
			<search position="after"><![CDATA[
				$product_images = $this->model_catalog_product->getProductImages($this->request->get['product_id']);
			]]></search>
      <add><![CDATA[
			
				// Product Option Image PRO module <<
				
				if ( !$this->model_module_product_option_image_pro ) {
					$this->load->model('module/product_option_image_pro');
				}
				if ( $this->model_module_product_option_image_pro->getThemeName() == 'barbaratheme' && !empty($data['page_type']) && $data['page_type'] == 'quickview' ) {
					
					$poip_data = $this->model_module_product_option_image_pro->getDataForProductPage($results, array( 'popup_width' => $config_image_thumb_width, 'popup_height' => $config_image_thumb_height ));
				} else {
					$poip_data = $this->model_module_product_option_image_pro->getDataForProductPage($results);
				}
				if ( $poip_data ) {
					$data = array_merge($data, $poip_data['data']);
					$product_images = $poip_data['results'];
				}
			
				//>> Product Option Image PRO module
      ]]></add>
    </operation>
		
		<!-- alogin -->
		<operation error="skip">
			<search position="after"><![CDATA[$ress = $this->model_catalog_product->getProductImages(]]></search>
      <add><![CDATA[
			
				// Product Option Image PRO module <<
				
				if ( !$this->model_module_product_option_image_pro ) {
					$this->load->model('module/product_option_image_pro');
				}
				$poip_data = $this->model_module_product_option_image_pro->getDataForProductPage($ress);
				if ( $poip_data ) {
					$data = array_merge($data, $poip_data['data']);
					$ress = $poip_data['results'];
				}
			
				//>> Product Option Image PRO module
      ]]></add>
    </operation>
		
		<!-- fix for Option to Product -->
		<operation error="skip">
			<search position="after"><![CDATA[$standard_images = $this->model_catalog_product->getProductImages(]]></search>
      <add><![CDATA[
			
				// Product Option Image PRO module <<
				
				if ( !$this->model_module_product_option_image_pro ) {
					$this->load->model('module/product_option_image_pro');
				}
				$poip_data = $this->model_module_product_option_image_pro->getDataForProductPage($standard_images);
				if ( $poip_data ) {
					$data = array_merge($data, $poip_data['data']);
					$standard_images = $poip_data['results'];
				}
			
				//>> Product Option Image PRO module
      ]]></add>
    </operation>
		
		
		<!-- related products -->
		<operation error="skip">
      <search position="after" ><![CDATA[
      $data['products'][] = array(
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      
      'option_images'  => $this->model_module_product_option_image_pro->getCategoryImagesForController( $result['product_id'], "related_products" ),
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
		
		<!-- related products (j2 and others themes images swipe: product image to first additional image ) -->
		<operation error="skip">
      <search position="after"><![CDATA[
      $image2 = $this->model_tool_image->resize($additional_images[0]['image']
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      
			if ( !empty($image2 ) ) {
				if ( !empty($image) ) {
					if ( count($additional_images) > 1 && ($image2 == $image || $result['image'] == $additional_images[0]['image'] ) ) {
						$image2 = $this->model_tool_image->resize($additional_images[1]['image'], $this->config->get('config_image_product_width'), $this->config->get('config_image_product_height'));
					}
				} elseif ( !empty($result['image']) )	{ // compatibility with buy together extension installed on Journal2
					if ( count($additional_images) > 1 && ( $result['image'] == $additional_images[0]['image'] ) ) {
						$image2 = $this->model_tool_image->resize($additional_images[1]['image'], $this->config->get('config_image_product_width'), $this->config->get('config_image_product_height'));
					}
				}
			}
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
		
		<operation error="skip">
      <search position="after"><![CDATA[
      	$image2 = $this->model_tool_image->resize($other_img[0]['image'],
      ]]></search>
      <add><![CDATA[
				// Product Option Image PRO module <<
				
				if ( count($other_img) > 1 && $image2 == $image) {
					$image2 = $this->model_tool_image->resize($other_img[1]['image'], $this->config->get($this->config->get('config_theme') . '_image_product_width'), $this->config->get($this->config->get('config_theme') . '_image_product_height'));
				}
				
				// >> Product Option Image PRO module
      ]]></add>
    </operation>
		
		
  </file>
	
	<!-- revolution to disable image change added by the theme -->
	<file name="catalog/view/theme/revolution/template/product/product.tpl" error="skip">
		<operation error="log">
      <search position="before"><![CDATA[
				$('#product_products .product_'+product_id+' .image .owl-item:first-child img').attr('src', json['opt_image']);
			]]></search>
      <add><![CDATA[
      	if ( typeof(poip_images) == 'undefined' )
      ]]></add>
    </operation>
		<operation error="log">
      <search position="before"><![CDATA[
				$('#product_products .product_'+product_id+' .image img').attr('src', json['opt_image']);
			]]></search>
      <add><![CDATA[
      	if ( typeof(poip_images) == 'undefined' )
      ]]></add>
    </operation>
		<operation error="log">
      <search position="before"><![CDATA[
				$('.product_informationss .thumbnails a.main-image').attr('href', json['opt_image_2_big']);
			]]></search>
      <add><![CDATA[
      	if ( typeof(poip_images) == 'undefined' ) { <?php // POIP disable theme image change ?>
      ]]></add>
    </operation>
		<operation error="log">
      <search position="before"><![CDATA[
				var start_quantity = parseFloat($('.product_informationss .pr_quantity').html().replace(/\s*/g,''));
			]]></search>
      <add><![CDATA[
      	} <?php // POIP disable theme image change ?>
      ]]></add>
    </operation> 
	</file>
  
	<!-- pav fashion theme compatibility - fix -->
	<file name="catalog/view/theme/*/template/themecontrol/product.tpl">
		<operation error="skip">
      <search position="before"><![CDATA[</body></html>]]></search>
      <add><![CDATA[
      <?php /* <?php echo $footer; ?> */ ?>
      ]]></add>
    </operation> 
	</file>
	
	<!-- for related products -->	
	<file name="catalog/view/theme/*/template/product/product.tpl">
		<!-- related products -->
		<operation error="skip">
      <search position="ibefore"><![CDATA[
      alt="<?php echo $product['name'];
      ]]></search>
      <add><![CDATA[<?php if (!isset($current_class)) $current_class = time(); ?> data-poip_id="image_<?php echo "".$current_class."_".$product['product_id']; ?>" ]]></add>
    </operation>
		
		<!-- lexus_shopstars -->
		<operation error="skip">
      <search position="ibefore"><![CDATA[require( PAVO_THEME_DIR."/template/product/detail/default.tpl" );]]></search>
      <add><![CDATA[
			// Product Option Image PRO module <<
			if ( !empty($poip_installed) ) {
				if ( class_exists('VQMod') ) {
					include( VQMod::modCheck( PAVO_THEME_DIR."/template/product/detail/default.tpl" ) );
				} else {
					include( modification( PAVO_THEME_DIR."/template/product/detail/default.tpl" ) );
				}
			} else
			
			//  >> Product Option Image PRO module
			]]></add>
    </operation>
		
		<!-- lexus_shopping -->
		<operation error="skip">
      <search position="ireplace"><![CDATA[require( PAVO_THEME_DIR."/template/product/products_related.tpl" );]]></search>
      <add><![CDATA[
			// Product Option Image PRO module << 
			if (!empty($poip_installed)) {
				require( VQMod::modCheck( PAVO_THEME_DIR."/template/product/products_related.tpl" ) );
			} else {
				require( PAVO_THEME_DIR."/template/product/products_related.tpl" );
			}
			//  >> Product Option Image PRO module 
			]]></add>
    </operation>
		
		<operation error="skip">

			<!-- MORE? compatible -->
			<search position="after"><![CDATA[
      <a href="<?php echo $product['href']; ?>"><img
      ]]></search>

      <add><![CDATA[
      
      <?php // Product Option Image PRO module << ?>
			
      <?php  if ( !empty($poip_installed) && !empty($poip_theme_name)  && isset($product['option_images']) && $product['option_images']) {
			
				foreach ($product['option_images'] as $product_option_id => $option_images) {
						
					if ($poip_theme_name == "sellegance" || $poip_theme_name == "theme422"
						|| $poip_theme_name == "polianna" || $poip_theme_name == "moneymaker"
						 ) {
						
						echo "<div data-poip_id=\"poip_img\" style=\"  text-align: center; \">";
						$image_counter = 0;
						foreach ($option_images as $product_option_value_id => $option_image) {
							$image_counter++;
							echo "
											<a ". ($poip_theme_name!="mattimeo" ? "onmouseover=\"poip_show_thumb(this);\"" : "") ."
												style=\"display:inline;\" href=\"".$product['href'].(strpos($product['href'],'?')===false?'?':'&amp;')."poip_ov=".(int)$product_option_value_id."\"
												".( (isset($option_image['title']) && $option_image['title']) ? " title=\"".$option_image['title']."\" " : "" )."
												data-thumb=\"".$option_image['thumb']."\"
												data-image_id=\"".$current_class."_".$product['product_id']."\">
											<img src=\"".$option_image['icon']."\" alt=\"".( (isset($option_image['title']) && $option_image['title']) ? $option_image['title'] : "" )."\"></a>
										";
						}
						echo "</div>";

					} elseif ($poip_theme_name == "pav_styleshop") { // for product_module.tpl
						// just skip
						
					
					
					} else { // OC 2.0 new style default
					
						echo "<div data-poip_id=\"poip_img\" style=\"  text-align: center; margin-top: 3px; \">";
						$image_counter = 0;
						foreach ($option_images as $product_option_value_id => $option_image) {
							$image_counter++;
							echo "
											<a onmouseover=\"poip_show_thumb(this);\" 
												style=\"display:inline;\" href=\"".$product['href'].(strpos($product['href'],'?')===false?'?':'&amp;')."poip_ov=".(int)$product_option_value_id."\"
												".( (isset($option_image['title']) && $option_image['title']) ? " title=\"".$option_image['title']."\" " : "" )."
												data-thumb=\"".$option_image['thumb']."\"
												data-image_id=\"".$current_class."_".$product['product_id']."\">
											<img src=\"".$option_image['icon']."\" class=\"img-thumbnail\" alt=\"".( (isset($option_image['title']) && $option_image['title']) ? $option_image['title'] : "" )."\"></a>
										";
						}
						echo "</div>";
					}
				}
				
      } ?>
      <?php //  >> Product Option Image PRO module ?>
      ]]></add>
    </operation>
		
	</file>
  
  <!-- art theme new slider version should be uploaded (slick.min.js) instead of older version included in general_scripts.js -->
	<file name="catalog/view/theme/art/template/common/header.tpl" error="skip">
		
		<operation error="skip">
      <search position="after"><![CDATA[
      <script src="catalog/view/theme/<?php echo $config->get('config_template'); ?>/js/general_scripts.js" type="text/javascript"></script>
      ]]></search>
      <add><![CDATA[
			<script src="catalog/view/theme/<?php echo $config->get('config_template'); ?>/js/slick.min.js" type="text/javascript"></script>
      ]]></add>
    </operation>  
		
	</file>
	
	<!-- coolbaby theme new slider version should be uploaded (slick.min.js) instead of older version included in general_scripts.js -->
	<file name="catalog/view/theme/coolbaby/template/common/header.tpl" error="skip">
		
		<operation error="skip">
      <search position="after"><![CDATA[
			<script src="catalog/view/theme/<?php echo $config->get('config_theme'); ?>/js/general_scripts.js" type="text/javascript"></script>
      ]]></search>
      <add><![CDATA[
			<script src="//cdn.jsdelivr.net/jquery.slick/1.6.0/slick.min.js" type="text/javascript"></script>
      ]]></add>
			<!--
			<script src="catalog/view/theme/<?php echo $config->get('config_template'); ?>/js/slick.min.js" type="text/javascript"></script>
			-->
    </operation>  
		
	</file>
	
	<!-- tt_oxelar -->
	<file name="catalog/view/theme/*/template/extension/module/ocquickview/product.tpl" error="skip">
		<operation error="skip">
      <search position="before" index="1"><![CDATA[
				<script type="text/javascript">
      ]]></search>
			<ignoreif><![CDATA[echo $footer;]]></ignoreif>
      <add><![CDATA[
				<?php // Product Option Image PRO for quickview <?php echo $footer; ?>
      ]]></add>
    </operation>  
	</file>
	
	<!-- magazin quickview fix -->
	<file name="catalog/view/theme/magazin/template/product/quick_view.tpl" error="skip">
		<operation error="skip"> 
			<search position="before"><![CDATA[
				<?php if($config->get('control_firstoption')== 1) { ?>
      ]]></search>
			<ignoreif><![CDATA[echo $footer;]]></ignoreif>
      <add><![CDATA[
				<?php // Product Option Image PRO for quickview <?php echo $footer; ?>
      ]]></add>	
		</operation>
	</file>
	
	<!-- luxury quickview fix -->
	<file name="catalog/view/theme/*/template/module/oct_popup_view.tpl,catalog/view/theme/*/template/extension/module/oct_popup_view.tpl" error="skip">
		<operation error="skip"> 
			<search position="after"><![CDATA[
				<link href="catalog/view/javascript/jquery/datetimepicker/bootstrap-datetimepicker.min.css" rel="stylesheet" type="text/css" />
      ]]></search>
			<ignoreif><![CDATA[echo $footer;]]></ignoreif>
      <add><![CDATA[
				<?php // Product Option Image PRO for quickview <?php echo $footer; ?>
      ]]></add>	
		</operation>
	</file>
	
	
	<file name="catalog/view/theme/*/template/extension/module/barbara_quickview.tpl" error="skip">
		<operation error="skip"> 
			<search position="before"><![CDATA[
				<script type="text/javascript" src="catalog/view/javascript/jquery/datetimepicker/moment.js"></script>
      ]]></search>
			<ignoreif><![CDATA[echo $footer;]]></ignoreif>
      <add><![CDATA[
				<?php // Product Option Image PRO for quickview <?php echo $footer; ?>
      ]]></add>	
		</operation>
	</file>
	
	<!-- so-furnicom quickview fix -->
	<file name="catalog/view/theme/*/template/extension/soconfig/quickview.tpl" error="skip">
		<operation error="skip"> 
			<search position="before" index="3"><![CDATA[
				<script type="text/javascript">
      ]]></search>
			<ignoreif><![CDATA[echo $footer;]]></ignoreif>
      <add><![CDATA[
				<?php // Product Option Image PRO for quickview <?php echo $footer; ?>
      ]]></add>	
		</operation>
	</file>
	
	<!-- so-market quickview fix -->
	<file name="catalog/view/theme/*/template/soconfig/quickview.tpl" error="skip">
		<operation error="skip"> 
			<search position="before" index="4"><![CDATA[
				<script type="text/javascript">
      ]]></search>
			<ignoreif><![CDATA[echo $footer;]]></ignoreif>
      <add><![CDATA[
				<?php // Product Option Image PRO for quickview <?php echo $footer; ?>
      ]]></add>	
		</operation>
	</file>
	
	<!-- sebian quickview fix  -->
	<file name="catalog/view/theme/sebian/template/product/quickview.tpl" error="skip">
		<operation error="skip"> 
			<search position="after" offset="20"><![CDATA[
      $("#image-additional-carousel-quickview").owlCarousel({
      ]]></search> 
      <add><![CDATA[
			<?php // Product Option Image PRO for sebian quickview <?php echo $footer; ?>
      ]]></add>	
		</operation>
	</file>
	
	<!-- moneymaker2 -->
	<file name="catalog/view/theme/moneymaker2/template/product/product.tpl" error="skip">
		<operation error="skip">
      <search position="replace" ><![CDATA[
				$('.thumbnails').magnificPopup({
			]]></search>
      <add><![CDATA[
				// poip replacement
				$('.thumbnails.image-additional').magnificPopup({
				//$('.thumbnails').magnificPopup({
			]]></add>
    </operation>
	</file>
	
	<!-- pixelshop - image change to second on mouseover -->
	<file name="catalog/controller/product/*.php,catalog/controller/extension/module/*.php" error="skip">
		<operation error="skip">
			<search position="after"><![CDATA[
				foreach ($results_img as $key => $result_img) {
			]]></search>
			<add><![CDATA[
				// << Product Option Image PRO module
				if ( $additional_image_hover == $image ) {
					$key = 0;
				}
				// >> Product Option Image PRO module
			]]></add>
		</operation>
	</file>
	
	<!-- pixelshop -->
	<file name="catalog/view/theme/pixelshop/template/product/product.tpl" error="skip">
		<operation error="skip">
      <search position="replace" ><![CDATA[
				$('.thumbnails').magnificPopup({
			]]></search>
      <add><![CDATA[
				// poip replacement
				$('.thumbnails .image-additional').magnificPopup({
				//$('.thumbnails').magnificPopup({
			]]></add>
    </operation>
	</file>
	
	<!-- aspire quickview fix  -->
	<file name="catalog/view/theme/*/template/product/quickview.tpl" error="skip">
		<operation error="skip"> 
			<search position="before" index="1"><![CDATA[
      <script type="text/javascript"><!--
      ]]></search>
			<ignoreif><![CDATA[echo $footer;]]></ignoreif>
      <add><![CDATA[
			
			<?php // Product Option Image PRO for quickview <?php echo $footer; ?>
			
      ]]></add>	
		</operation>
	</file>
	
	<!-- themeXXX quickview  -->
	<file name="catalog/view/theme/themeXXX/template/extension/module/tm_ajax_quick_view_popup.tpl" error="skip">
		
		<operation error="skip">
      <search position="before" ><![CDATA[
				<div class="cart-button">
			]]></search>
			<ignoreif><![CDATA[echo $footer;]]></ignoreif>
			<add><![CDATA[<?php /* <?php echo $footer; ?> */ ?>]]></add>
		</operation>
		
	</file>
	
	<!-- modern (rus) quickview  -->
	<file name="catalog/view/theme/*/template/product/aridius_quickview.tpl" error="skip">
		
		<operation error="skip">
      <search position="after" ><![CDATA[
				<script src="catalog/view/theme/modern/js/elevatezoom/jquery.elevatezoom.js" type="text/javascript"></script>
			]]></search>
			<ignoreif><![CDATA[echo $footer;]]></ignoreif>
			<add><![CDATA[<?php /* <?php echo $footer; ?> */ ?>]]></add>
		</operation>
		
	</file>
	
	<!-- sebian theme quickview - catalog/view/theme/*/template/product/quickview.tpl -->
	<file path="catalog/view/theme/*/template/" name="product/product.tpl,extension/module/ocquickview/product.tpl,module/oct_popup_view.tpl,extension/module/oct_popup_view.tpl,welldone/quickview.tpl,product/quickview.tpl,product/quick_view.tpl,themecontrol/product.tpl,journal2/quickview/quickview.tpl,extension/module/tm_ajax_quick_view_popup.tpl,soconfig/quickview.tpl,extension/module/barbara_quickview.tpl,product/aridius_quickview.tpl" error="skip">
	<!-- <file name="catalog/view/theme/*/template/product/product.tpl"> -->
    
		<!-- disable sstore theme own image changer -->
		<operation error="skip">
      <search position="before" offset="1"><![CDATA[
      url: 'index.php?route=product/product/getPImages&product_id=<?php echo $product_id; ?>',
      ]]></search>
      <add><![CDATA[
			<?php
        // << Product Option Image PRO module
        if ( !empty($poip_installed) ) echo "return;"; 
        // >> Product Option Image PRO module
      ?>
      ]]></add>
    </operation>
		
    <!-- pav styleshop -->
		<operation error="skip">
      <search position="after" index="1" offset="1" ><![CDATA[
      galleryActiveClass: "active"
      ]]></search>
      <add><![CDATA[
				<?php if ( !empty($poip_theme_name) && ($poip_theme_name == 'pav_styleshop' || $poip_theme_name == 'pav_clothes' || $poip_theme_name == 'pav_digitalstore') ) { ?>
					// << Product Option Image PRO module
					var poip_elevate_zoom_object = $( zoomCollection ).data('elevateZoom');
					// >> Product Option Image PRO module
				<?php } ?>
      ]]></add>
    </operation>
		
    <operation error="skip">
      <search position="replace"><![CDATA[
      src="<?php echo $image['thumb']; ?>" title="<?php echo $heading_title; ?>" alt="<?php echo $heading_title; ?>"
      ]]></search>
      <add><![CDATA[
      src="<?php echo $image['thumb']; ?>" title="<?php echo ( (isset($image['title']) && $image['title']) ? ' '.$image['title'] : $heading_title); ?>" alt="<?php echo ((isset($image['title']) && $image['title']) ? ' '.$image['title'] : $heading_title); ?>"
      ]]></add>
    </operation>
		
		<!-- so-lovefashion -->
		<operation error="skip">
      <search position="after"><![CDATA[
      <?php $i=-1; foreach ($images as $image) : $i++ ?>
      ]]></search>
      <add><![CDATA[
				<?php
					// << Product Option Image PRO
					if ( $i > 0 && $images[$i]['popup'] == $images[$i-1]['popup'] ) continue;
					// >> Product Option Image PRO
				?>
      ]]></add>
    </operation>
		
		<!-- pav fashion - related products -->
		<operation error="skip">
			<search position="after" ><![CDATA[
      <div class="warp-info">
      ]]></search>

      <add><![CDATA[
      
      <?php // Product Option Image PRO module << ?>
			
			<?php  if ( !empty($poip_installed) && isset($product['option_images']) && $product['option_images']) {
			
        foreach ($product['option_images'] as $product_option_id => $option_images) {
				
          //opacity: .99; float:left; 
					echo "<div data-poip_id='poip_img' style='width:100%; display: table-cell;  position:relative; top:-6px; z-index: 1000;'>";
					$image_counter = 0;
          foreach ($option_images as $product_option_value_id => $option_image) {
						$image_counter++;
									
							echo "			 
                    <a style=\"margin:0px; margin-left:2px; margin-bottom:2px;  float:left; \" onmouseover=\"poip_show_thumb(this);\" href=\"".$product['href'].(strpos($product['href'],'?')===false?'?':'&amp;')."poip_ov=".(int)$product_option_value_id."\"
                      ".( (isset($option_image['title']) && $option_image['title']) ? " title=\"".$option_image['title']."\" " : "" )."
                      data-thumb=\"".$option_image['thumb']."\"
                      data-image_id=\"".$current_class."_".$product['product_id']."\">
                    <img style=\"\" src=\"".$option_image['icon']."\"></a>
                   ";		
									
          }
					echo "</div>";
        }
      } ?>
      <?php //  >> Product Option Image PRO module ?>
      ]]></add>
    </operation>
		
		<!-- pav fashion theme script for related products -->
		<operation error="skip">
			<search position="before"><![CDATA[
      <?php echo $footer; ?>
      ]]></search>
      <add><![CDATA[
			<?php
				//<< Product Option Image PRO module
				if (isset($poip_theme_name) && ($poip_theme_name=='pav_fashion' || $poip_theme_name=='fashion' || $poip_theme_name=='pav_styleshop' || $poip_theme_name=='megashop'
				|| $poip_theme_name == 'lexus_shopping' || $poip_theme_name == 'pav_sportshop' ) ) { ?>
				<script type="text/javascript"><!--
					$('div.product-action').css('top', '-70px');
					$('a.pav-colorbox').css('top', 'auto');
					$('a.pav-colorbox').css('bottom', '-40px');
				--></script>
				<?php }
				// >> Product Option Image PRO module
				?>
      ]]></add>	
		</operation>
		
		<!-- pav fashion product details -->
		<operation error="skip">
			<search position="replace"><![CDATA[
      <?php require( PAVO_THEME_DIR."/template/product/product_detail_hitech.tpl" );  ?>
      ]]></search>
      <add><![CDATA[
			<?php
				if ( class_exists('VQMod') ) {
					require( VQMod::modCheck( PAVO_THEME_DIR."/template/product/product_detail_hitech.tpl" ) );
				} else {
					require( PAVO_THEME_DIR."/template/product/product_detail_hitech.tpl" );
				}
			?>
      ]]></add>	
		</operation>
		
		<!-- journal2 quickview -->
		
		<!-- pav fashion theme script for related products -->
		<operation error="skip">
			<search position="after" offset="1"><![CDATA[
      <html class="product-page quickview
      ]]></search>
      <add><![CDATA[
			<!-- << Product Option Image PRO module -->
				<script type="text/javascript"><!--
					var poip_journal2_quickview = true;
				--></script>
			<!-- >> Product Option Image PRO module -->
      ]]></add>	
		</operation>
		
	
		<!-- Pavilion костыль  -->
		<operation error="skip"> 
			<search position="before" ><![CDATA[
      <article id="product" class="tb_<?php echo $tbData->product_layout_design_id; ?>" itemscope itemtype="http://schema.org/Product">
      ]]></search> 
      <add><![CDATA[
			<?php // Product Option Image PRO for Pavilion <?php echo $footer; ?>
      ]]></add>	
		</operation>
		
		
		
		<!-- SCRIPT -->
    <operation > 
			<!-- </body> for journal2 quickview <\?php \$tbData->echoFooter\(\$footer\); \?> -->
      <search position="before" index="1" regex="true"><![CDATA[~echo \$footer;|</body>~]]></search>
			
			<!-- 
			<search position="before"><![CDATA[
      <?php echo $footer; ?>
      ]]></search>
			-->
			
      <add><![CDATA[
      <!-- Product Option Image PRO module << -->
      <?php
				if ( !empty($poip_installed) ) {  
					
					if ( !empty($poip_inclide_file_name_default) ) {
						if (class_exists('VQMod')) {
							include( VQMod::modCheck( modification($poip_inclide_file_name_default) ) );
						} else {
							include( modification($poip_inclide_file_name_default) );
						}
					}
					if ( !empty($poip_inclide_file_name_custom) ) {
						if (class_exists('VQMod')) {
							include( VQMod::modCheck( modification($poip_inclide_file_name_custom) ) );
						} else {
							include( modification($poip_inclide_file_name_custom) );
						}
					} else { // no custom (owerwise it was created in custom file)
						?>
						<script  type = "text/javascript" ><!--
							if ( typeof(poip_product_default) != 'undefined' ) { 
								var poip_product = new poip_product_default();
							}
						//--></script>
						<?php
					}
					
				}
			?>
      <!-- >> Product Option Image PRO module -->
      ]]></add>
    </operation>
    
    
    <!-- shoppystore (so-shoppystore) theme compatibility -->
    <operation error="skip">
      <search position="after"><![CDATA[
      <?php $i=-1; foreach ($images as $image) :$i++ ?>
      ]]></search>
      <add><![CDATA[
      <?php if ( substr($poip_theme_name, 0, 14) == 'so-shoppystore' || substr($poip_theme_name, 0, 10) == 'so-maxshop' || substr($poip_theme_name, 0, 11) == 'so-megashop' ) {
      // Product Option Image PRO module <<
      // to not show the same image twice
      if ( !isset($poip_shown_imgs) ) $poip_shown_imgs = array();
      if ( in_array($image['popup'], $poip_shown_imgs) ) continue;
      $poip_shown_imgs[] = $image['popup'];
      
      // >> Product Option Image PRO module
      } ?>
      ]]></add>
    </operation>
    
		<!-- porto - do not place the main image to the list of additional images if it is already exists there  -->
		<!--
		<operation error="skip">
      <search position="replace"><![CDATA[
      <?php if($theme_options->get( 'product_image_zoom' ) != 2 && $thumb) { ?>
      ]]></search>
      <add><![CDATA[
			<?php // << Product Option Image PRO module ?>
			<?php
				$poip_images_to_check_main = array();
				if ( !empty($images) && is_array($images) ) {
					foreach ( $images as $poip_temp_image ) {
						if ( !empty($poip_temp_image['popup']) ) {
							$poip_images_to_check_main[] = $poip_temp_image['popup'];
						}
					}
				}
			?>
			<?php if ( $theme_options->get( 'product_image_zoom' ) != 2 && $thumb && (!empty($popup) && !in_array($popup, $poip_images_to_check_main)) ) { ?>
      <?php // >> Product Option Image PRO module ?>
			<?php // replaced original : if ( $theme_options->get( 'product_image_zoom' ) != 2 && $thumb ) {  ?>
      ]]></add>
    </operation>
		-->
    
    <!-- goshop & fastor, and some other themes compatibility -->
    <operation error="skip">
      <search position="iafter"><![CDATA[
      <?php foreach ($images as $image) { ?>
      ]]></search>
      <add><![CDATA[
			<?php // << Product Option Image PRO module ?>
      <?php if ( !empty($poip_theme_name) && ($poip_theme_name == 'goshop'
							|| ($poip_theme_name == 'fastor' && $theme_options->get( 'product_image_zoom' ) != 2)
							|| ($poip_theme_name == 'porto' && $theme_options->get( 'product_image_zoom' ) != 2)
							|| ($poip_theme_name == 'techone')
							|| ($poip_theme_name == 'unitystore')
							|| $poip_theme_name == 'alogin'
							|| $poip_theme_name == 'journal2'
							|| $poip_theme_name == 'fractal'
							|| $poip_theme_name == 'anystore'
							|| $poip_theme_name == 'modern'
							|| $poip_theme_name == 'barbaratheme'
							|| $poip_theme_name == 'lilac'
							|| $poip_theme_name == 'tt_wenro'
							|| $poip_theme_name == 'theme643'
							|| $poip_theme_name == 'OPC080191'
							|| $poip_theme_name == 'BurnEngine_pavilion'
							|| $poip_theme_name == 'BurnEngine_technopolis'
							|| $poip_theme_name == 'BurnEngine_shoppica'
							) && !empty($poip_installed) && !empty($popup)  ) {
      
				// to not show the main image twice
				if ( $image['popup'] == $popup || (!empty($thumb) && $thumb == $image['popup'] ) ) continue;
			} ?>
      <?php // >> Product Option Image PRO module ?>
      ]]></add>
    </operation>
		
		<!-- alogin / unitystore -->
		<operation error="skip">
      <search position="iafter"><![CDATA[
				<?php foreach ($imags as $image) { ?>
      ]]></search>
      <add><![CDATA[
				<?php // << Product Option Image PRO module ?>
				<?php if ( !empty($poip_theme_name) && !empty($poip_installed) && !empty($popup)
					&& ($poip_theme_name == 'alogin' || $poip_theme_name == 'unitystore')) {
				
					// to not show the main image twice
					if ( $image['popup'] == $popup || (!empty($thumb) && $thumb == $image['popup'] ) ) continue;
				} ?>
				<?php // >> Product Option Image PRO module ?>
      ]]></add>
    </operation>
    
  </file>
  

  
  <!-- FilterPRO compatibility -->
  <file name="catalog/controller/module/filterpro.php,catalog/controller/extension/module/filterpro.php" error="skip">  
    
    <operation error="log">
      <search position="after" offset="1"><![CDATA[
      private function getHtmlProducts($results, $product_total)
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      if ( !$this->model_module_product_option_image_pro ) {
				$this->load->model('module/product_option_image_pro');
			}
      $data['poip_installed'] = $this->model_module_product_option_image_pro->installed();
      $data['current_class'] = str_replace("Controller", "", get_class($this));
			$data['poip_theme_name'] = $this->model_module_product_option_image_pro->getThemeName();
      
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
    
    <operation >
      <search position="after"><![CDATA[
      $data['products'][] = array(
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      
      'option_images'  => $this->model_module_product_option_image_pro->getCategoryImagesForController( isset($result['product_id']) ? $result['product_id'] : $product_info['product_id'],
        (isset($data['current_class']) && $data['current_class']!= 'ProductCategory' && isset($setting))?($setting):(false)  ),
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
    
  </file>
	
	
	<!-- pav fashion theme compatibility -->
	<file name="catalog/controller/module/pavproducttabs.php,catalog/controller/extension/module/pavproducttabs.php" error="skip">  
		
		<operation error="skip">
      <search position="before"><![CDATA[
				$data['tabs'] = $tabs;
      ]]></search>
      <add><![CDATA[
				// << Product Option Image PRO module
				if ( !$this->model_module_product_option_image_pro ) {
					$this->load->model('module/product_option_image_pro');
				}
				$data['poip_installed'] = $this->model_module_product_option_image_pro->installed();
				$data['current_class'] = str_replace("Controller", "", get_class($this));
				$data['poip_theme_name'] = $this->model_module_product_option_image_pro->getThemeName();
				if ($data['poip_installed'] && $tabs && is_array($tabs)) {
					
					foreach ($tabs as &$products_tab) {
						if ($products_tab && is_array($products_tab)) {
							foreach ($products_tab as &$product) {
								if (isset($product['product_id']) && $product['product_id']) {
									$product['option_images'] = $this->model_module_product_option_image_pro->getCategoryImagesForController($product['product_id'], false);
								}
							}
							unset($product);
						}
						unset($products_tab);
					}
				}
				// >> Product Option Image PRO module
      ]]></add>
    </operation>
		
		<!-- older variants -->
		<operation error="skip">
      <search position="before"><![CDATA[
				$this->data['tabs'] = $tabs;
      ]]></search>
      <add><![CDATA[
				// << Product Option Image PRO module
				if ( !$this->model_module_product_option_image_pro ) {
					$this->load->model('module/product_option_image_pro');
				}
				$this->data['poip_installed'] = $this->model_module_product_option_image_pro->installed();
				$this->data['current_class'] = str_replace("Controller", "", get_class($this));
				$this->data['poip_theme_name'] = $this->model_module_product_option_image_pro->getThemeName();
				if ($this->data['poip_installed'] && $tabs && is_array($tabs)) {
					
					foreach ($tabs as &$products_tab) {
						if ($products_tab && is_array($products_tab)) {
							foreach ($products_tab as &$product) {
								if (isset($product['product_id']) && $product['product_id']) {
									$product['option_images'] = $this->model_module_product_option_image_pro->getCategoryImagesForController($product['product_id'], false);
								}
							}
							unset($product);
						}
						unset($products_tab);
					}
				}
				// >> Product Option Image PRO module
      ]]></add>
    </operation>
		
		
	</file>
  
	<!-- lexus_shopping - pav deals -->
	<file name="catalog/controller/pavdeals/deals.php" error="skip">
	
		 <operation >
      <search position="before"><![CDATA[
      $this->load->model('catalog/product');
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      if ( !$this->model_module_product_option_image_pro ) {
				$this->load->model('module/product_option_image_pro');
			}
      $this->mdata['poip_installed'] = $this->model_module_product_option_image_pro->installed();
      $this->mdata['current_class'] = str_replace("Controller", "", get_class($this));
			$this->mdata['poip_theme_name'] = $this->model_module_product_option_image_pro->getThemeName();
			
      
			
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
	
		<operation error="skip">
      <search position="after"><![CDATA[
      $products[] = $this->getItemDeal($result, $setting);
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      
      $products[count($products)-1]['option_images'] = $this->model_module_product_option_image_pro->getCategoryImagesForController( $result['product_id'],
        (isset($data['current_class']) && $this->mdata['current_class']!= 'ProductCategory' && isset($setting))?($setting):(false)  );
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
		
	</file>
	
	<!-- lexus_shopping and others -->
	<file name="catalog/controller/module/pavproductcarousel.php,catalog/controller/extension/module/pavproductcarousel.php" error="skip">  
    
    <operation >
      <search position="before"><![CDATA[
      $this->load->model('catalog/product');
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      if ( !$this->model_module_product_option_image_pro ) {
				$this->load->model('module/product_option_image_pro');
			}
      $this->data['poip_installed'] = $this->model_module_product_option_image_pro->installed();
      $this->data['current_class'] = str_replace("Controller", "", get_class($this));
			$this->data['poip_theme_name'] = $this->model_module_product_option_image_pro->getThemeName();
			
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
		
		<operation error="skip">
      <search position="after"><![CDATA[
      'product_id' => $result['product_id'],
      ]]></search>
			<ignoreif><![CDATA[$data['products'][] = array(]]></ignoreif>
      <add><![CDATA[
      // Product Option Image PRO module <<
      
      'option_images'  => $this->model_module_product_option_image_pro->getCategoryImagesForController( $result['product_id'], (isset($this->data['current_class']) && $this->data['current_class']!= 'ProductCategory' && isset($setting))?($setting):(false)  ),
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
		
		
		<operation error="skip">
      <search position="after"><![CDATA[
      $thumb2 = $this->model_tool_image->resize($product_images[0]['image'], $setting['width'], $setting['height']);
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      
			if ( count($product_images) > 1 && $thumb2 == $image) {
				$thumb2 = $this->model_tool_image->resize($product_images[1]['image'], $setting['width'], $setting['height']);
			}
			
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
		
		<operation error="skip">
      <search position="after"><![CDATA[
      $image = 
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      
			$thumb2 = false;
			
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
		
		
	</file>
	
	<!-- lexus_shopping and others -->
	<file path="catalog/controller/" name="module/pavcategorytabs.php,extension/module/pavcategorytabs.php,module/pavverticalcategorytabs.php,extension/module/pavverticalcategorytabs.php" error="skip">  
    
    <operation >
      <search position="before"><![CDATA[
      $this->load->model('catalog/product');
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      if ( !$this->model_module_product_option_image_pro ) {
				$this->load->model('module/product_option_image_pro');
			}
      $this->mdata['poip_installed'] = $this->model_module_product_option_image_pro->installed();
      $this->mdata['current_class'] = str_replace("Controller", "", get_class($this));
			$this->mdata['poip_theme_name'] = $this->model_module_product_option_image_pro->getThemeName();
			
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
		
		<operation error="skip">
      <search position="after"><![CDATA[
			'product_id'  => $result['product_id'],
      ]]></search>
			<ignoreif><![CDATA[$data['products'][] = array(]]></ignoreif>
      <add><![CDATA[
      // Product Option Image PRO module <<
      
      'option_images'  => $this->model_module_product_option_image_pro->getCategoryImagesForController( $result['product_id'], (isset($this->mdata['current_class']) && $this->mdata['current_class']!= 'ProductCategory' && isset($setting))?($setting):(false)  ),
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
		
		<operation error="skip">
      <search position="after"><![CDATA[
      'product_id' => $product_info['product_id'],
      ]]></search>
			<ignoreif><![CDATA[$data['products'][] = array(]]></ignoreif>
      <add><![CDATA[
      // Product Option Image PRO module <<
      
      'option_images'  => $this->model_module_product_option_image_pro->getCategoryImagesForController( $product_info['product_id'], (isset($this->mdata['current_class']) && $this->mdata['current_class']!= 'ProductCategory' && isset($setting))?($setting):(false)  ),
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
		
		
		<operation error="skip">
      <search position="after"><![CDATA[
      $thumb2 = $this->model_tool_image->resize($product_images[0]['image'], $setting['width'], $setting['height']);
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      
			if ( count($product_images) > 1 && $thumb2 == $image) {
				$thumb2 = $this->model_tool_image->resize($product_images[1]['image'], $setting['width'], $setting['height']);
			}
			
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
		
		<operation error="skip">
      <search position="after"><![CDATA[
      $image = 
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      
			$thumb2 = false;
			
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
		
		
		
	</file>
	
	<file path="catalog/controller/" name="extension/module/so_deals.php,extension/module/so_deals_category.php,extension/module/so_listing_tabs.php" error="skip">  
    
    <operation >
      <search position="before"><![CDATA[
				$this->load->model('catalog/product');
      ]]></search>
      <add><![CDATA[
				// Product Option Image PRO module <<
				if ( !$this->model_module_product_option_image_pro ) {
					$this->load->model('module/product_option_image_pro');
				}
				$data['poip_installed'] = $this->model_module_product_option_image_pro->installed();
				$data['current_class'] = str_replace("Controller", "", get_class($this));
				$data['poip_theme_name'] = $this->model_module_product_option_image_pro->getThemeName();
				
				$setting['poip_installed'] = $this->model_module_product_option_image_pro->installed();
				$setting['current_class'] = str_replace("Controller", "", get_class($this));
				$setting['poip_theme_name'] = $this->model_module_product_option_image_pro->getThemeName();
				
				// >> Product Option Image PRO module
      ]]></add>
    </operation>
		
	</file>
	
	<!-- relatedproductspro -->
	<file path="catalog/controller/" name="extension/module/relatedproductspro.php" error="skip">  
    
    <operation error="log">
      <search position="before" regex="true"><![CDATA[
				~\$this->load->model\('catalog/(product|random)'\);~
      ]]></search>
      <add><![CDATA[
				// Product Option Image PRO module <<
				if ( !$this->model_module_product_option_image_pro ) {
					$this->load->model('module/product_option_image_pro');
				}
				$this->data['poip_installed'] = $this->model_module_product_option_image_pro->installed();
				$this->data['current_class'] = str_replace("Controller", "", get_class($this));
				$this->data['poip_theme_name'] = $this->model_module_product_option_image_pro->getThemeName();
				
				// >> Product Option Image PRO module
      ]]></add>
    </operation>
		
		<operation error="log">
      <search position="after"><![CDATA[
      	$this->data['products'][] = array(
      ]]></search>
			<ignoreif><![CDATA[Template: EAGENCY]]></ignoreif>
      <add><![CDATA[
				// Product Option Image PRO module <<
				'option_images'  => $this->model_module_product_option_image_pro->getCategoryImagesForController( isset($result['product_id']) ? $result['product_id'] : (isset($product_info['product_id'])?$product_info['product_id']:0),
					(isset($data['current_class']) && $data['current_class']!= 'ProductCategory' && isset($setting))?($setting):(false)  ),
				// >> Product Option Image PRO module
      ]]></add>
    </operation>
		
	</file>
	
  <!-- filter_product.php - eagency theme -->
  <file path="catalog/controller/" name="product/category.php,extension/module/tt_product_tab.php,module/mega_filter.php,module/filter_product.php,product/search.php,product/special.php,product/manufacturer.php,module/latest.php,module/bestseller.php,module/special.php,module/featured.php,extension/module/latest.php,extension/module/bestseller.php,extension/module/special.php,extension/module/featured.php,module/boss_featured.php,module/random.php,extension/module/relatedproductspro.php" error="skip">  
    
    <operation >
      <search position="before" regex="true"><![CDATA[
				~\$this->load->model\('catalog/(product|random)'\);~
      ]]></search>
      <add><![CDATA[
				// Product Option Image PRO module <<
				if ( !$this->model_module_product_option_image_pro ) {
					$this->load->model('module/product_option_image_pro');
				}
				$data['poip_installed'] = $this->model_module_product_option_image_pro->installed();
				$data['current_class'] = str_replace("Controller", "", get_class($this));
				$data['poip_theme_name'] = $this->model_module_product_option_image_pro->getThemeName();
				$data['poip_cosyone_rollover_effect'] = $this->config->get('cosyone_rollover_effect');
				
				// >> Product Option Image PRO module
      ]]></add>
    </operation>
		
    <operation error="skip">
      <search position="after"><![CDATA[
      $data['products'][] = array(
      ]]></search>
			<ignoreif><![CDATA[Template: EAGENCY]]></ignoreif>
      <add><![CDATA[
      // Product Option Image PRO module <<
      'option_images'  => $this->model_module_product_option_image_pro->getCategoryImagesForController( isset($result['product_id']) ? $result['product_id'] : (isset($product_info['product_id'])?$product_info['product_id']:0),
        (isset($data['current_class']) && $data['current_class']!= 'ProductCategory' && isset($setting))?($setting):(false)  ),
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
		
		<!-- << marketshop_product_tab.php -->
		<operation error="skip">
      <search position="after"><![CDATA[
      $data['latest_products'][] = array(
      ]]></search>
			<ignoreif><![CDATA[Template: EAGENCY]]></ignoreif>
      <add><![CDATA[
      // Product Option Image PRO module <<
      
      'option_images'  => $this->model_module_product_option_image_pro->getCategoryImagesForController( isset($result['product_id']) ? $result['product_id'] : $product_info['product_id'],
        (isset($data['current_class']) && $data['current_class']!= 'ProductCategory' && isset($setting))?($setting):(false)  ),
      // >> Product Option Image PRO module
      ]]></add>
		</operation>
		<operation error="skip">
      <search position="after"><![CDATA[
      $data['bestseller_products'][] = array(
      ]]></search>
			<ignoreif><![CDATA[Template: EAGENCY]]></ignoreif>
      <add><![CDATA[
      // Product Option Image PRO module <<
      
      'option_images'  => $this->model_module_product_option_image_pro->getCategoryImagesForController( isset($result['product_id']) ? $result['product_id'] : $product_info['product_id'],
        (isset($data['current_class']) && $data['current_class']!= 'ProductCategory' && isset($setting))?($setting):(false)  ),
      // >> Product Option Image PRO module
      ]]></add>
		</operation>
		<operation error="skip">
      <search position="after"><![CDATA[
      $data['special_products'][] = array(
      ]]></search>
			<ignoreif><![CDATA[Template: EAGENCY]]></ignoreif>
      <add><![CDATA[
      // Product Option Image PRO module <<
      
      'option_images'  => $this->model_module_product_option_image_pro->getCategoryImagesForController( isset($result['product_id']) ? $result['product_id'] : $product_info['product_id'],
        (isset($data['current_class']) && $data['current_class']!= 'ProductCategory' && isset($setting))?($setting):(false)  ),
      // >> Product Option Image PRO module
      ]]></add>
		</operation>
		<!-- >> marketshop_product_tab.php -->
		
		
		<!-- eagency theme  -->
		<operation error="skip">
      <search position="after"><![CDATA[
      'product_id' => $result['product_id'],
      ]]></search>
			<ignoreif><![CDATA[$data['products'][] = array(]]></ignoreif>
      <add><![CDATA[
      // Product Option Image PRO module <<
      
      'option_images'  => $this->model_module_product_option_image_pro->getCategoryImagesForController( $result['product_id'], (isset($data['current_class']) && $data['current_class']!= 'ProductCategory' && isset($setting))?($setting):(false)  ),
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
		
		<!-- eagency theme -->
		<operation error="skip">
      <search position="after"><![CDATA[
      'product_id' => $product_info['product_id'],
      ]]></search>
			<ignoreif><![CDATA[$data['products'][] = array(]]></ignoreif>
      <add><![CDATA[
      // Product Option Image PRO module <<
      
      'option_images'  => $this->model_module_product_option_image_pro->getCategoryImagesForController( $product_info['product_id'], (isset($data['current_class']) && $data['current_class']!= 'ProductCategory' && isset($setting))?($setting):(false)  ),
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
		
    <!-- opc1000 theme - category.php -->
    <operation error="skip">
      <search position="after"><![CDATA[
      $image_2 = $this->model_tool_image->resize($images[0]['image'], $this->config->get('config_image_product_width'), $this->config->get('config_image_product_height'));
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      
			if ( count($images) > 1 && $image_2 == $image) {
				$image_2 = $this->model_tool_image->resize($images[1]['image'], $this->config->get('config_image_product_width'), $this->config->get('config_image_product_height'));
			}
			
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
    
    <!-- opc1000 - featured.php etc -->
    <operation error="skip">
      <search position="after"><![CDATA[
      $image_2 = $this->model_tool_image->resize($images[0]['image'], $setting['width'], $setting['height']);
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      
			if ( count($images) > 1 && $image_2 == $image) {
        $image_2 = $this->model_tool_image->resize($images[1]['image'], $setting['width'], $setting['height']);
			}
			
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
    
    
    <operation error="skip">
      <search position="after"><![CDATA[
				$image2 = $this->model_tool_image->resize($additional_images[0]['image']
      ]]></search>
      <add><![CDATA[
				// Product Option Image PRO module <<
				
				if ( count($additional_images) > 1 && $image2 == $image) {
					$image2 = $this->model_tool_image->resize($additional_images[1]['image'], $this->config->get('config_image_product_width'), $this->config->get('config_image_product_height'));
				}
				
				// >> Product Option Image PRO module
      ]]></add>
    </operation>
		
		<operation error="skip">
      <search position="after"><![CDATA[
      	$image2 = $this->model_tool_image->resize($other_img[0]['image'],
      ]]></search>
      <add><![CDATA[
				// Product Option Image PRO module <<
				
				if ( count($other_img) > 1 && $image2 == $image) {
					$image2 = $this->model_tool_image->resize($other_img[1]['image'], $this->config->get($this->config->get('config_theme') . '_image_product_width'), $this->config->get($this->config->get('config_theme') . '_image_product_height'));
				}
				
				// >> Product Option Image PRO module
      ]]></add>
    </operation>
		
		<!-- OPC040_ -->
		<operation error="skip">
      <search position="after"><![CDATA[
      	if(isset($images[0]['image']) && !empty($images[0]['image'])){
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      
			if ( !empty($images[0]['image']) && !empty($result['image']) && $images[0]['image'] == $result['image'] && !empty($images[1]['image']) ) {
				$images = $images[1]['image']; // strange idea to use the same variable for this, but it is in the template
				
			} elseif ( !empty($images[0]['image']) && !empty($product_info['image']) && $images[0]['image'] == $product_info['image'] && !empty($images[1]['image']) ) {
				$images = $images[1]['image']; // strange idea to use the same variable for this, but it is in the template	
				
			} else 
			
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
		
		<!-- butik -->
		<operation error="skip">
      <search position="before"><![CDATA[
      	$additional_img = $this->model_tool_image->resize($additional_img[0]['image']
      ]]></search>
      <add><![CDATA[
				// Product Option Image PRO module <<
				
				if ( count($additional_img) > 1 && !empty($result) && $additional_img[0]['image'] == $result['image'] ) {
					$additional_img[0] = $additional_img[1];
				}
				
				// >> Product Option Image PRO module
      ]]></add>
    </operation>
		
  </file>
	
	<!-- marketshop_product_tab.php -->
	<file name="catalog/controller/module/marketshop_product_tab.php" error="skip">  
    
    <operation >
      <search position="before"><![CDATA[
      $this->load->model('catalog/product');
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
			if ( !$this->model_module_product_option_image_pro ) {
				$this->load->model('module/product_option_image_pro');
			}
      $data['poip_installed'] = $this->model_module_product_option_image_pro->installed();
      $data['current_class'] = str_replace("Controller", "", get_class($this));
			$data['poip_theme_name'] = $this->model_module_product_option_image_pro->getThemeName();
			$data['poip_cosyone_rollover_effect'] = $this->config->get('cosyone_rollover_effect');
      
			
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
    
    <operation error="skip">
      <search position="after"><![CDATA[
      $data['products'][] = array(
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      
      'option_images'  => $this->model_module_product_option_image_pro->getCategoryImagesForController( $product_info['product_id'], (isset($data['current_class']) && $data['current_class']!= 'ProductCategory' && isset($setting))?($setting):(false)  ),
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
		
		
		<operation error="skip">
      <search position="after"><![CDATA[
      $data['latest_products'][] = array(
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      
      'option_images'  => $this->model_module_product_option_image_pro->getCategoryImagesForController( isset($result['product_id']) ? $result['product_id'] : $product_info['product_id'],
        (isset($data['current_class']) && $data['current_class']!= 'ProductCategory' && isset($setting))?($setting):(false)  ),
      // >> Product Option Image PRO module
      ]]></add>
		</operation>
		
		<operation error="skip">
      <search position="after"><![CDATA[
      $data['bestseller_products'][] = array(
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      
      'option_images'  => $this->model_module_product_option_image_pro->getCategoryImagesForController( isset($result['product_id']) ? $result['product_id'] : $product_info['product_id'],
        (isset($data['current_class']) && $data['current_class']!= 'ProductCategory' && isset($setting))?($setting):(false)  ),
      // >> Product Option Image PRO module
      ]]></add>
		</operation>
		
		<operation error="skip">
      <search position="after"><![CDATA[
      $data['special_products'][] = array(
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      
      'option_images'  => $this->model_module_product_option_image_pro->getCategoryImagesForController( isset($result['product_id']) ? $result['product_id'] : $product_info['product_id'],
        (isset($data['current_class']) && $data['current_class']!= 'ProductCategory' && isset($setting))?($setting):(false)  ),
      // >> Product Option Image PRO module
      ]]></add>
		</operation>
		
    
  </file>
	
	<!-- journal2 compatibility -->
	<file name="catalog/controller/module/journal2_custom_sections.php,catalog/controller/module/journal2_carousel.php" error="skip"> 
    
		<!-- $this->template = "journal2/template/journal2/module/carousel -->
		<!-- 			$this->template = $this->config->get('config_template') . "/template/journal2/module/carousel_{$this->data['module_type']}.tpl"; -->
    <!-- template/journal2/module/custom_sections_ -->
    <operation error="log">
      <search position="before" regex="true"><![CDATA[~journal2/module/custom_sections_|journal2/module/carousel_~]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      if ( !$this->model_module_product_option_image_pro ) {
				$this->load->model('module/product_option_image_pro');
			}
      $this->data['poip_installed'] = $this->model_module_product_option_image_pro->installed();
			$this->data['current_class'] = str_replace("Controller", "", get_class($this));
			$this->data['poip_theme_name'] = $this->model_module_product_option_image_pro->getThemeName();
			/*
      if ( !empty($this->data['sections']) ) {
				foreach ($this->data['sections'] as &$section) {
					if (isset($section['items'])) {
						foreach ($section['items'] as &$product) {
							if (isset($product['product_id'])) {
								$product['option_images'] = $this->model_module_product_option_image_pro->getCategoryImagesForController( $product['product_id'], false  );
							}
						}
					}
				}
			}
			unset($section);
			unset($product);
      
			if ( !empty($this->data['items']) ) {
				foreach ($this->data['items'] as &$product) {
					if ( !empty($product['product_id']) ) {
						$product['option_images'] = $this->model_module_product_option_image_pro->getCategoryImagesForController( $product['product_id'], false  );
					}
				}
			}
			unset($product);
			*/
      
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
    
    <operation error="skip">
      <search position="after"><![CDATA[
      $image2 = Journal2Utils::resizeImage($this->model_tool_image, $results[0]['image']
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      
			if ( count($results) > 1 && $image2 == $image) {
				$image2 = Journal2Utils::resizeImage($this->model_tool_image, $results[1]['image'] ? $results[1]['image'] : 'data/journal2/no_image_large.jpg', $this->data['image_width'], $this->data['image_height'], $this->data['image_resize_type']);
			}
			
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
    
  </file>
	
	<!-- journal2 compatibility -->
	<file name="catalog/controller/module/journal2_super_filter.php" error="skip">  
    
		<!-- $this->template = 'journal2/template/journal2/module/super_filter_product.tpl'; -->
    <!-- template/journal2/module/super_filter_product.tpl'; -->
    <operation error="log">
      <search position="before"><![CDATA[
			journal2/module/super_filter_product
      ]]></search>
      <add><![CDATA[

      // Product Option Image PRO module <<
      if ( !$this->model_module_product_option_image_pro ) {
				$this->load->model('module/product_option_image_pro');
			}
      $this->data['poip_installed'] = $this->model_module_product_option_image_pro->installed();
      $this->data['current_class'] = str_replace("Controller", "", get_class($this));
			$this->data['poip_theme_name'] = $this->model_module_product_option_image_pro->getThemeName();
			/*
			foreach ($this->data['products'] as &$product) {
				$product['option_images'] = $this->model_module_product_option_image_pro->getCategoryImagesForController( $product['product_id'],
					(isset($this->data['current_class']) && $this->data['current_class']!= 'ProductCategory' && isset($setting))?($setting):(false)  );
			}
			unset($product);
			*/
      
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
    
    <operation error="skip">
      <search position="after"><![CDATA[
      $image2 = $this->model_tool_image->resize($results[0]['image']
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      
			if ( count($results) > 1 && $image2 == $image) {
				$image2 = $this->model_tool_image->resize($results[1]['image'] ? $results[1]['image'] : (Front::$IS_OC2 ? 'placeholder.png' : 'no_image.jpg'), $this->config->get('config_image_product_width'), $this->config->get('config_image_product_height'));
			}
			
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
    
  </file>
	
	<!-- journal2 compatibility - to not load journal2 on POIP ajax calls (checked on 2.9.1) -->
	<file name="system/journal2/startup.php" error="skip">  
    
    <operation >
      <search position="after"><![CDATA[
				$load_theme = !(defined('BLOCK_JOURNAL') && BLOCK_JOURNAL === true);
      ]]></search>
      <add><![CDATA[
				// << Product Option Image PRO
				if (isset($_GET['route']) && strpos($_GET['route'], 'module/product_option_image_pro') === 0) {
					$load_theme = false;
				}
				// >> Product Option Image PRO 
			]]></add>
    </operation>
	</file>
  
	<!-- journal2 compatibility -->
	<file name="catalog/view/theme/*/template/journal2/module/carousel_product.tpl,catalog/view/theme/*/template/journal2/module/custom_sections_product.tpl" error="skip">  
    
    <operation error="log">
      <search position="replace"><![CDATA[
      alt="<?php echo $product['name']; ?>"
      ]]></search>
      <add><![CDATA[<?php if (!empty($poip_installed)) { ?>alt="<?php echo $product['name']; ?>" data-poip_id="image_<?php echo "".$current_class."_".$product['product_id']; ?>"<?php } else { ?>alt="<?php echo $product['name']; ?>"<?php } ?>]]></add>

    </operation>
    
		
    <operation error="skip">
			<search position="after"><![CDATA[<div class="name">' + $(element).find('.name').html() + '</div>]]></search> 
      <add><![CDATA[
			// Product Option Image PRO module <<
			if ($(element).find('[data-poip_id="poip_img"]').length) { html += '<div data-poip_id=\'poip_img\'>' + $(element).find('[data-poip_id="poip_img"]').html() + '<div>' };
			//if ($(element).find('[data-poip_id="poip_img"]').length) { html += $('<div>').append( $(element).find('[data-poip_id="poip_img"]').clone() ).html() };
			//>> Product Option Image PRO module
			]]></add>
    </operation>
    
		<!--
    <operation >

			<search position="before" ><![CDATA[<div class="product-details">]]></search>
      <add><![CDATA[
				<?php /*
				<?php // Product Option Image PRO module <<  ?>
				<?php  if ( !empty($poip_installed) && isset($product['option_images']) && $product['option_images']) {
				
					foreach ($product['option_images'] as $product_option_id => $option_images) {
						
						echo "<div data-poip_id='poip_img'>";
						$image_counter = 0;
						foreach ($option_images as $product_option_value_id => $option_image) {
							$image_counter++;
										
							echo "			 
											<a style=\"padding-left:6px; padding-top:2px; margin:0px; width:25px; height:25px; float:center; \" onmouseover=\"poip_show_thumb(this);\" href=\"".$product['href'].(strpos($product['href'],'?')===false?'?':'&amp;')."poip_ov=".(int)$product_option_value_id."\"
												".( (isset($option_image['title']) && $option_image['title']) ? " title=\"".$option_image['title']."\" " : "" )."
												data-thumb=\"".$option_image['thumb']."\"
												data-image_id=\"".$current_class."_".$product['product_id']."\">
											<img style=\"width:24px; height:24px;\" src=\"".$option_image['icon']."\"></a>
										 ";			
						}
						echo "</div>";
						
					}
				
				} ?>
				<?php //  >> Product Option Image PRO module ?>
				*/ ?>
      ]]></add>
    </operation>
		-->
		
  </file>
	
	
	<!-- mattimeo theme -->
	<file name="catalog/view/theme/mattimeo/template/product/category.tpl,catalog/view/theme/mattimeo/template/module/featured.tpl,catalog/view/theme/mattimeo/template/module/bestseller.tpl,catalog/view/theme/mattimeo/template/module/latest.tpl" error="skip">  
		<operation error="skip">
			<search position="after" offset="1"><![CDATA[
      <!--end additional images-->
      ]]></search>
      <add><![CDATA[
      <?php // Product Option Image PRO module << ?>
      <?php  if ( !empty($poip_installed) && isset($product['option_images']) && $product['option_images']) {
      
				foreach ($product['option_images'] as $product_option_id => $option_images) {
          
					echo "<div data-poip_id=\"poip_img\" style=\"  text-align: center; \">";
					$image_counter = 0;
					foreach ($option_images as $product_option_value_id => $option_image) {
						$image_counter++;
						echo "
										<a ". ($poip_theme_name!="mattimeo" ? "onmouseover=\"poip_show_thumb(this);\"" : "") ."
											style=\"display:inline;\" href=\"".$product['href'].(strpos($product['href'],'?')===false?'?':'&amp;')."poip_ov=".(int)$product_option_value_id."\"
											".( (isset($option_image['title']) && $option_image['title']) ? " title=\"".$option_image['title']."\" " : "" )."
											data-thumb=\"".$option_image['thumb']."\"
											data-image_id=\"".$current_class."_".$product['product_id']."\">
										<img src=\"".$option_image['icon']."\" alt=\"".( (isset($option_image['title']) && $option_image['title']) ? $option_image['title'] : "" )."\"></a>
									";
					}
					echo "</div>";
					
        }
      
      } ?>
      <?php //  >> Product Option Image PRO module ?>
      ]]></add>
    </operation>
	</file>
	
	<!-- cosyone theme 
	<file name="catalog/view/theme/*/template/product/category.tpl,catalog/view/theme/*/template/product/search.tpl">  
		<operation error="skip">
			<search position="after" ><![CDATA[
      <a href="<?php echo $product['href']; ?>"><img src="<?php echo $product['thumb']; ?>" alt="<?php echo $product['name']; ?>" /></a>
      ]]></search>
      <add><![CDATA[
      <?php // Product Option Image PRO module << ?>
      <?php  if ( !empty($poip_installed) && !empty($poip_theme_name)  && isset($product['option_images']) && $product['option_images'] && $poip_theme_name == 'cosyone') {
      
        foreach ($product['option_images'] as $product_option_id => $option_images) {
          
					echo "<div data-poip_id='poip_img'>";
					$image_counter = 0;
          foreach ($option_images as $product_option_value_id => $option_image) {
						$image_counter++;
									
						echo "			 
									<a style=\"padding-left:6px; padding-top:2px; margin:0px; width:25px; height:25px; float:left; \" onmouseover=\"poip_show_thumb(this);\" href=\"".$product['href'].(strpos($product['href'],'?')===false?'?':'&amp;')."poip_ov=".(int)$product_option_value_id."\"
										".( (isset($option_image['title']) && $option_image['title']) ? " title=\"".$option_image['title']."\" " : "" )."
										data-thumb=\"".$option_image['thumb']."\"
										data-image_id=\"".$current_class."_".$product['product_id']."\">
									<img style=\"width:24px; height:24px;\" src=\"".$option_image['icon']."\"></a>
								 ";		
          }
					echo "</div>";
					
        }
      
      } ?>
      <?php //  >> Product Option Image PRO module ?>
      ]]></add>
    </operation>
	</file>
	-->
  
	<!-- project-store -->
  <file name="catalog/view/theme/*/template/product/category.tpl" error="skip">  
		<operation error="skip">
			<search position="ibefore" ><![CDATA[
      include 'catalog/view/theme/project-store/template/product/pjs-include/pjs_grid_item.tpl';
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      
			if (!empty($poip_installed)) {
				if (class_exists('VQMod')) {
					include( VQMod::modCheck('catalog/view/theme/project-store/template/product/pjs-include/pjs_grid_item.tpl') );
				} else {
					include( modification('catalog/view/theme/project-store/template/product/pjs-include/pjs_grid_item.tpl') );
				}
			} else 
			
      //  >> Product Option Image PRO module
      ]]></add>
    </operation>
	</file>
	
	<!-- project-store -->
  <file name="catalog/view/theme/*/template/module/*.tpl" error="skip">  
		<operation error="skip">
			<search position="ibefore" ><![CDATA[
      include 'catalog/view/theme/project-store/template/module/pjs-include/pjs_grid_item.tpl';
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      
			if (!empty($poip_installed)) {
				if (class_exists('VQMod')) {
					include( VQMod::modCheck('catalog/view/theme/project-store/template/module/pjs-include/pjs_grid_item.tpl') );
				} else {
					include( modification('catalog/view/theme/project-store/template/module/pjs-include/pjs_grid_item.tpl') );
				}
			} else 
			
      //  >> Product Option Image PRO module
      ]]></add>
    </operation>
	</file>
	
	<!-- project-store -->
	<file name="catalog/view/theme/*/template/product/pjs-include/pjs_grid_item.tpl,catalog/view/theme/*/template/module/pjs-include/pjs_grid_item.tpl" error="skip">  

		<operation error="skip">
      <search position="iafter" ><![CDATA[
			src="<?php echo $product['thumb']; ?>"
			]]></search>
      <add><![CDATA[ <?php // Product Option Image PRO module << ?><?php if (!isset($current_class)) $current_class = time(); ?> data-poip_id="image_<?php echo "".$current_class."_".$product['product_id']; ?>" <?php   //  >> Product Option Image PRO module  ?> ]]></add>
    </operation>
		
	</file>
	
	<!-- lexus_shopping and others -->	
	<file path="catalog/view/theme/*/template/" name="common/products_module.tpl,product/products_related.tpl,module/pavproductcarousel.tpl,module/pavcategorytabs.tpl,module/pavverticalcategorytabs.tpl,extension/module/pavproductcarousel.tpl,extension/module/pavcategorytabs.tpl,extension/module/pavproducttabs.tpl,extension/module/pavverticalcategorytabs.tpl" error="skip">
		
		<operation error="skip">
			
      <search position="ireplace" ><![CDATA[require( $productLayout );]]></search>
      <add><![CDATA[
				// << Product Option Image PRO module
				if ( !empty($poip_installed) ) {
					if (class_exists('VQMod')) {
						require( VQMod::modCheck($productLayout) );
					} else {
						require( modification($productLayout) );
					}
				} else {
					require( $productLayout );
				}
				//  >> Product Option Image PRO module
			]]></add>

    </operation>
		
	</file>
	
	<!-- rgen-opencart theme compatibility -->	
	<file path="rgen/catalog/template/product/" name="prd_block1.tpl,prd_block2.tpl,prd_block3.tpl,prd_block4.tpl" error="skip">
		<operation error="skip">
      <search position="iafter" ><![CDATA[
			src="<?php echo $product['thumb']; ?>"
			]]></search>
      <add><![CDATA[ <?php // Product Option Image PRO module << ?><?php if (!isset($current_class)) $current_class = time(); ?> data-poip_id="image_<?php echo "".$current_class."_".$product['product_id']; ?>" <?php   //  >> Product Option Image PRO module  ?> ]]></add>
    </operation>
	</file>
	
	
		
		
	<file path="catalog/view/theme/so-furnicom/template/" name="extension/module/so_deals_category/*.tpl,extension/module/so_listing_tabs/*.tpl" error="skip">
		
		<!-- so-furnicom theme compatibility (newer version? ) -->
		<operation error="skip">
      <search position="ireplace"><![CDATA[
				include("default_items.tpl");
      ]]></search>
			<add><![CDATA[
				// Product Option Image PRO module <<
				if ( strpos(__FILE__, 'so_deals_category') !== false ) { // no slashes to make the search working for vq-cache
					$poip_theme_inclide = DIR_TEMPLATE . 'so-furnicom' . '/template/extension/module/so_deals_category/default_items.tpl';
				} elseif ( strpos(__FILE__, 'so_listing_tabs') !== false ) {
					$poip_theme_inclide = DIR_TEMPLATE . 'so-furnicom' . '/template/extension/module/so_listing_tabs/default_items.tpl';
				}
				if ( !empty($poip_theme_inclide) && file_exists($poip_theme_inclide) ) {
					
					if ( !empty($poip_installed) ) {
						if (class_exists('VQMod')) {
							include( VQMod::modCheck( $poip_theme_inclide ) );
						} else {
							include( modification( $poip_theme_inclide ) );
						}
					} else {
						include($poip_theme_inclide);
					}
				}
				//  >> Product Option Image PRO module
			
			]]></add>
    </operation>
		
		<!-- so-furnicom theme compatibility (newer version? ) -->
		<operation error="skip">
      <search position="ireplace"><![CDATA[
				include("default_tabs.tpl");
      ]]></search>
      <add><![CDATA[
				// Product Option Image PRO module << 
				if ( strpos(__FILE__, 'so_deals_category') !== false ) { // no slashes to make the search working for vq-cache
					$poip_theme_inclide = DIR_TEMPLATE . 'so-furnicom' . '/template/extension/module/so_deals_category/default_tabs.tpl';
				} elseif ( strpos(__FILE__, 'so_listing_tabs') !== false ) {
					$poip_theme_inclide = DIR_TEMPLATE . 'so-furnicom' . '/template/extension/module/so_listing_tabs/default_tabs.tpl';
				}
				if ( !empty($poip_theme_inclide) && file_exists($poip_theme_inclide) ) {
					if ( !empty($poip_installed) ) {
						if (class_exists('VQMod')) {
							include( VQMod::modCheck( $poip_theme_inclide ) );
						} else {
							include( modification( $poip_theme_inclide ) );
						}
					} else {
						include($poip_theme_inclide);
					}
				}
				//  >> Product Option Image PRO module
			
			]]></add>
    </operation>
		
		<!-- so-furnicom theme compatibility (newer version? ) -->
		<operation error="skip">
      <search position="ireplace"><![CDATA[
				include("default_js.tpl");
      ]]></search>
      <add><![CDATA[
				// Product Option Image PRO module << 
				if ( strpos(__FILE__, 'so_deals_category') !== false ) { // no slashes to make the search working for vq-cache
					$poip_theme_inclide = DIR_TEMPLATE . 'so-furnicom' . '/template/extension/module/so_deals_category/default_js.tpl';
				} elseif ( strpos(__FILE__, 'so_listing_tabs') !== false ) {
					$poip_theme_inclide = DIR_TEMPLATE . 'so-furnicom' . '/template/extension/module/so_listing_tabs/default_js.tpl';
				}
				if ( !empty($poip_theme_inclide) && file_exists($poip_theme_inclide) ) {
					if ( !empty($poip_installed) ) {
						if (class_exists('VQMod')) {
							include( VQMod::modCheck( $poip_theme_inclide ) );
						} else {
							include( modification( $poip_theme_inclide ) );
						}
					} else {
						include($poip_theme_inclide);
					}
				}
				//  >> Product Option Image PRO module 
			
			]]></add>
    </operation>
		
	</file>	
	
	<!-- category.tpl etc -->
	<file path="catalog/view/theme/*/template/" name="module/product_module.tpl,module/marketshop_product_tab.tpl,module/filter_product.tpl,pavdeals/list.tpl,product/product_collection.tpl,common/product_collection.tpl,common/product/default.tpl,common/product/swap.tpl,module/pavproducttabs.tpl,module/filterpro_products.tpl,extension/module/filterpro_products.tpl,journal2/module/super_filter_product.tpl,product/category.tpl,product/search.tpl,product/manufacturer_info.tpl,product/special.tpl,module/latest.tpl,module/bestseller.tpl,module/special.tpl,module/featured.tpl,extension/module/latest.tpl,extension/module/bestseller.tpl,extension/module/special.tpl,extension/module/featured.tpl,welldone/listing.php,extension/module/oclayerednavigation/occategory.tpl,extension/module/oclayerednavigation/occategoryfilter.tpl,module/boss_featured.tpl,extension/module/tg_fashionista_filter_product.tpl,soconfig/listing.php,extension/module/so_deals/*.tpl,extension/module/so_deals_category/*.tpl,extension/module/so_listing_tabs/*.tpl,product/category_*.tpl,extension/module/adv_ajaxfilter_products.tpl,extension/module/showintabs_output.tpl,extension/module/cosyone_recently.tpl,extension/module/random.tpl,module/oclayerednavigation/occategory.tpl,extension/module/relatedproductspro/relatedproductspro.tpl" error="skip">  
  <!--<file name="catalog/view/theme/*/template/module/product_module.tpl,catalog/view/theme/*/template/module/marketshop_product_tab.tpl,catalog/view/theme/*/template/module/filter_product.tpl,catalog/view/theme/*/template/pavdeals/list.tpl,catalog/view/theme/*/template/product/product_collection.tpl,catalog/view/theme/*/template/common/product_collection.tpl,catalog/view/theme/*/template/common/product/default.tpl,catalog/view/theme/*/template/common/product/swap.tpl,catalog\view\theme\*\template\module\pavproducttabs.tpl,catalog\view\theme\*\template\module\filterpro_products.tpl,catalog\view\theme\*\template\journal2\module\super_filter_product.tpl,catalog/view/theme/*/template/product/category.tpl,catalog/view/theme/*/template/product/search.tpl,catalog/view/theme/*/template/product/manufacturer_info.tpl,catalog/view/theme/*/template/product/special.tpl,catalog/view/theme/*/template/module/latest.tpl,catalog/view/theme/*/template/module/bestseller.tpl,catalog/view/theme/*/template/module/special.tpl,catalog/view/theme/*/template/module/featured.tpl">  -->
    
		<!--
    <operation error="skip">
			
      <search position="ibefore"><![CDATA[
      alt="<?php echo $product['name'];
      ]]></search>
      <add><![CDATA[<?php // Product Option Image PRO module << if ($poip_installed) { ?> data-poip_id="image_<?php echo "".$current_class."_".$product['product_id']; ?>" <?php } //  >> Product Option Image PRO module ?>]]></add>

    </operation>
		-->
		
		<operation error="skip">
      <search position="replace"><![CDATA[
      <?php include('catalog/view/theme/'.$config->get('config_template').'/template/new_elements/product.tpl'); ?>
      ]]></search>
      <add><![CDATA[
			<?php
				// Product Option Image PRO module <<
				if (!empty($poip_installed)) {
					include( VQMod::modCheck('catalog/view/theme/'.$config->get('config_template').'/template/new_elements/product.tpl') );
				} else {
					include( 'catalog/view/theme/'.$config->get('config_template').'/template/new_elements/product.tpl' );
				}
				//  >> Product Option Image PRO module
			?>
			]]></add>
    </operation>
		
		<operation error="skip">			
      <search position="iafter" ><![CDATA[
			src="<?php echo $product['thumb']; ?>"
			]]></search>
      <add><![CDATA[ <?php // Product Option Image PRO module << ?><?php if (!isset($current_class)) $current_class = time(); ?> data-poip_id="image_<?php echo "".$current_class."_".$product['product_id']; ?>" <?php   //  >> Product Option Image PRO module  ?> ]]></add>
    </operation>
		
		<operation error="skip">			
      <search position="iafter" ><![CDATA[
			src="<?php echo $product['thumb']?>"
			]]></search>
      <add><![CDATA[ <?php // Product Option Image PRO module << ?><?php if (!isset($current_class)) $current_class = time(); ?> data-poip_id="image_<?php echo "".$current_class."_".$product['product_id']; ?>" <?php   //  >> Product Option Image PRO module  ?> ]]></add>
    </operation>
		
		<!-- custom -->
		<operation error="skip">			
      <search position="iafter" ><![CDATA[
				<img src="<?php echo $val['thumb'];?>" alt=""
			]]></search>
      <add><![CDATA[ <?php // Product Option Image PRO module << ?><?php if ( isset($val['product_id']) ) { if (!isset($current_class)) $current_class = time(); echo 'data-poip_id="image_'.$current_class.'_'.$val['product_id'].'"'; } ?><?php   //  >> Product Option Image PRO module  ?> ]]></add>
    </operation>
		
		<!-- BurnEngine_trendo_minimal -->
		<operation error="skip">			
      <search position="iafter" ><![CDATA[
				<div class="image_hover"><a href="<?php echo $product['href']; ?>"><img src="<?php echo $tbData->theme_catalog_image_url; ?>pixel.gif"
			]]></search>
      <add><![CDATA[ <?php // Product Option Image PRO module << ?><?php if (!isset($current_class)) $current_class = time(); ?> data-poip_id="image_<?php echo "".$current_class."_".$product['product_id']; ?>" <?php   //  >> Product Option Image PRO module  ?> ]]></add>
    </operation>
		
		<!-- << Pavilion (BurnEngine) -->
		<operation error="skip">
      <search position="before"><![CDATA[
				item_hover('#{{widget_dom_id}}'
      ]]></search>
      <add><![CDATA[
				// << Product Option Image PRO module
				var poip_BurnEngine_products_hover_timer = setInterval(function(){
					if ( typeof(poip_list)=='undefined' || typeof(poip_list.wait_server_call)=='undefined' || !poip_list.wait_server_call) {
				// >> Product Option Image PRO module
			]]></add>
    </operation>
		
		<operation error="skip">
      <search position="after"><![CDATA[
				item_hover('#{{widget_dom_id}}'
      ]]></search>
      <add><![CDATA[
				// << Product Option Image PRO module
						clearInterval(poip_BurnEngine_products_hover_timer);
					}
				}, 100);
				// >> Product Option Image PRO module
			]]></add>
    </operation>
		<!-- >> Pavilion (BurnEngine) -->
		
		<!-- welldone theme compatibility -->
    <operation error="skip">
      <search position="replace"><![CDATA[
      <?php include("catalog/view/theme/welldone/template/welldone/listing.php");?>
      ]]></search>
      <add><![CDATA[
			<?php
				// Product Option Image PRO module << 
				if ( !empty($poip_installed) ) {
					if (class_exists('VQMod')) {
						include( VQMod::modCheck('catalog/view/theme/welldone/template/welldone/listing.php') );
					} else {
						include( modification('catalog/view/theme/welldone/template/welldone/listing.php') );
					}
				} else {
					include('catalog/view/theme/welldone/template/welldone/listing.php');
				}
				//  >> Product Option Image PRO module 
			?>
			]]></add>
    </operation>
		
		<!-- unitystore - remove possible doubles of images in theme image preview -->
		<operation error="skip">
      <search position="iafter"><![CDATA[foreach ($product['images'] as $image) {]]></search>
      <add><![CDATA[
				// Product Option Image PRO module << 
				if ( !empty($product['thumb']) && $product['thumb'] == $image['thumb'] ) continue;
				//  >> Product Option Image PRO module 
			]]></add>
    </operation>
		
		<!-- barbaratheme - remove possible doubles of images in theme image preview -->
		<operation error="skip">
      <search position="iafter"><![CDATA[foreach ($product['dop_img'] as $key => $img) {]]></search>
      <add><![CDATA[
				// Product Option Image PRO module << 
				if ( !empty($product['thumb']) && $product['thumb'] == $img ) continue;
				//  >> Product Option Image PRO module 
			]]></add>
    </operation>
		
		<!-- lightshop -->
		<operation error="skip">
      <search position="ibefore"><![CDATA[
      	require( DIR_APPLICATION.'view/theme/theme_lightshop/template/product/category_'.$view.'.tpl' );
      ]]></search>
      <add><![CDATA[
				// Product Option Image PRO module <<
				
				if ( !empty($poip_installed) ) {
					
					$poip_inclide_file_name = DIR_APPLICATION.'view/theme/theme_lightshop/template/product/category_'.$view.'.tpl';
					if (class_exists('VQMod')) {
						include( VQMod::modCheck($poip_inclide_file_name) );
					} else {
						include( modification($poip_inclide_file_name) );
					}
					
				} else // default
				
				// >> Product Option Image PRO module
      ]]></add>
    </operation>
		
		<!-- myshop theme compatibility -->
    <operation error="skip">
      <search position="ireplace"><![CDATA[include('catalog/view/theme/module_list.php');]]></search>
      <add><![CDATA[
				// Product Option Image PRO module << 
				if ( !empty($poip_installed) ) {
					if (class_exists('VQMod')) {
						include( VQMod::modCheck('catalog/view/theme/module_list.php') );
					} else {
						include( modification('catalog/view/theme/module_list.php') );
					}
				} else {
					include('catalog/view/theme/module_list.php'); // original
				}
				//  >> Product Option Image PRO module 
			]]></add>
    </operation>
		
		<!-- yourstore theme compatibility -->
    <operation error="skip">
      <search position="ireplace"><![CDATA[include('catalog/view/theme/list.php');]]></search>
      <add><![CDATA[
				// Product Option Image PRO module << 
				if ( !empty($poip_installed) ) {
					if (class_exists('VQMod')) {
						include( VQMod::modCheck( modification('catalog/view/theme/list.php') ) );
					} else {
						include( modification('catalog/view/theme/list.php') );
					}
				} else {
					include('catalog/view/theme/list.php'); // original
				}
				//  >> Product Option Image PRO module 
			]]></add>
    </operation>
		
		<!-- so-furnicom theme compatibility -->
    <operation error="skip">
      <search position="replace"><![CDATA[
				if (file_exists(DIR_TEMPLATE . $theme . '/template/soconfig/listing.php')) include(DIR_TEMPLATE.$theme.'/template/soconfig/listing.php');
      ]]></search>
      <add><![CDATA[
				// Product Option Image PRO module << 
				if (file_exists(DIR_TEMPLATE . $theme . '/template/soconfig/listing.php')) {
					if ( !empty($poip_installed) ) {
						if (class_exists('VQMod')) {
							include( VQMod::modCheck(DIR_TEMPLATE.$theme.'/template/soconfig/listing.php') );
						} else {
							include( modification(DIR_TEMPLATE.$theme.'/template/soconfig/listing.php') );
						}
					} else {
						include(DIR_TEMPLATE.$theme.'/template/soconfig/listing.php');
					}
				}
				//  >> Product Option Image PRO module 
			
			]]></add>
    </operation>
		
		<!-- optimus theme compatibility -->
    <operation error="skip">
      <search position="replace"><![CDATA[
      <?php include('catalog/view/theme/listing.php'); ?>
      ]]></search>
      <add><![CDATA[
			<?php
				// Product Option Image PRO module << 
				if ( !empty($poip_installed) ) {
					if (class_exists('VQMod')) {
						include( VQMod::modCheck('catalog/view/theme/listing.php') );
					} else {
						include( modification('catalog/view/theme/listing.php') );
					}
				} else {
					include('catalog/view/theme/listing.php');
				}
				//  >> Product Option Image PRO module 
			?>
			]]></add>
    </operation>
    
    <!-- fastor and some other themes compatibility theme compatibility -->
    <operation error="skip">
      <search position="replace"><![CDATA[
      <?php include('catalog/view/theme/'.$config->get($config->get('config_theme') . '_directory').'/template/new_elements/product.tpl'); ?>
      ]]></search>
      <add><![CDATA[
			<?php
				// Product Option Image PRO module <<
				if ( !empty($poip_installed) ) {
					if (class_exists('VQMod')) {
						include( VQMod::modCheck( modification('catalog/view/theme/'.$config->get($config->get('config_theme') . '_directory').'/template/new_elements/product.tpl') ) );
					} else {
						include( modification('catalog/view/theme/'.$config->get($config->get('config_theme') . '_directory').'/template/new_elements/product.tpl') );
					}
				} else {
					include('catalog/view/theme/'.$config->get($config->get('config_theme') . '_directory').'/template/new_elements/product.tpl');
				}
				//  >> Product Option Image PRO module
			?>
			]]></add>
    </operation>
    
		
		
		
		<!-- tt_wenro -->
		<operation error="skip">			
      <search position="iafter" ><![CDATA[
				src="image/catalog/loading.gif" data-original="<?php echo $product['thumb']; ?>"
			]]></search>
      <add><![CDATA[ <?php // Product Option Image PRO module << ?><?php if (!isset($current_class)) $current_class = time(); ?> data-poip_id="image_<?php echo "".$current_class."_".$product['product_id']; ?>" <?php   //  >> Product Option Image PRO module  ?> ]]></add>
    </operation>
		
		<!-- julytheme -->
		<operation error="skip">			
      <search position="iafter" ><![CDATA[
			class="imgan"  style="background-image:url('<?php echo $product['thumb'];?>');"
			]]></search>
      <add><![CDATA[ <?php // Product Option Image PRO module << ?><?php if (!isset($current_class)) $current_class = time(); ?> data-poip_id="image_<?php echo "".$current_class."_".$product['product_id']; ?>" <?php   //  >> Product Option Image PRO module  ?> ]]></add>
    </operation>
		
		<!-- cosyone hover -->
		<operation error="skip">
			
      <search position="iafter" ><![CDATA[
			<img src="<?php echo $product['thumb_hover']; ?>"
			]]></search>
      <add><![CDATA[ <?php // Product Option Image PRO module << ?><?php if (!isset($current_class)) $current_class = time(); ?> data-poip_id="image_<?php echo "".$current_class."_".$product['product_id']; ?>" <?php   //  >> Product Option Image PRO module  ?> ]]></add>

    </operation>
    
    <!-- goshop -->
    <operation error="skip">
			
      <search position="iafter" ><![CDATA[
			<a href="<?php echo $product['href']; ?>"><img src="image/catalog/blank.gif"
			]]></search>
      <add><![CDATA[ <?php // Product Option Image PRO module << if (!isset($current_class)) $current_class = time(); ?> data-poip_id="image_<?php echo "".$current_class."_".$product['product_id']; ?>" <?php   //  >> Product Option Image PRO module ?> ]]></add>

    </operation>
		
		<!-- lexus_shopping & lexus_berrykid & Pav Beat & megashop -->
		<operation  error="skip">
      <search position="ireplace"><![CDATA[
				require( ThemeControlHelper::getLayoutPath( 'common/product_collection.tpl' ) );
      ]]></search>
      <add><![CDATA[
				// << Product Option Image PRO module
				if ( !empty($poip_installed) ) {
					if (class_exists('VQMod')) {
						require( VQMod::modCheck( ThemeControlHelper::getLayoutPath( 'common/product_collection.tpl' ) ) );
					} else {
						require( modification( ThemeControlHelper::getLayoutPath( 'common/product_collection.tpl' ) ) );
					}
				} else {
					require( ThemeControlHelper::getLayoutPath( 'common/product_collection.tpl' ) );
				}
				// >> Product Option Image PRO module
			]]></add>
    </operation>
		
		<!-- lexus_shopping & lexus_berrykid & megashop -->
		<operation  error="skip">
      <search position="ireplace"><![CDATA[
				require( ThemeControlHelper::getLayoutPath( 'common/product/'.$listingConfig['product_layout'].'.tpl' ) );
      ]]></search>
      <add><![CDATA[
				// << Product Option Image PRO module
				if ( !empty($poip_installed) ) {
					if (class_exists('VQMod')) {
						require( VQMod::modCheck( ThemeControlHelper::getLayoutPath( 'common/product/'.$listingConfig['product_layout'].'.tpl' ) ) );
					} else {
						require( modification( ThemeControlHelper::getLayoutPath( 'common/product/'.$listingConfig['product_layout'].'.tpl' ) ) );
					}
				} else {
					require( ThemeControlHelper::getLayoutPath( 'common/product/'.$listingConfig['product_layout'].'.tpl' ) );
				}
				// >> Product Option Image PRO module
			]]></add>
    </operation>
		
		<!-- Pav Beat -->
		<operation  error="skip">
      <search position="ireplace"><![CDATA[
				require( ThemeControlHelper::getLayoutPath( 'common/product/default.tpl' ) );
      ]]></search>
      <add><![CDATA[
				// Product Option Image PRO module <<
				if (!empty($poip_installed)) {
					require( VQMod::modCheck( ThemeControlHelper::getLayoutPath( 'common/product/default.tpl' ) ) );
				} else {
					require( ThemeControlHelper::getLayoutPath( 'common/product/default.tpl' ) );
				}
				//  >> Product Option Image PRO module
			]]></add>
    </operation>
		
		<!-- lexus_shopping for bestsellers -->
		<operation  error="skip">
      <search position="ireplace"><![CDATA[require( DIR_TEMPLATE.$config->get('config_template')."/template/common/products_module.tpl" );]]></search>
      <add><![CDATA[
			
				// Product Option Image PRO module <<
				if (!empty($poip_installed)) {
					require( VQMod::modCheck( DIR_TEMPLATE.$config->get('config_template')."/template/common/products_module.tpl" ) );
				} else {
					require( DIR_TEMPLATE.$config->get('config_template')."/template/common/products_module.tpl" );
				}
				//  >> Product Option Image PRO module
			
			]]></add>
    </operation>
		
		<!-- rgen -->
    <operation error="skip">
      <search position="replace" ><![CDATA[
			<?php include $this->rgen('prd'.$rgen['search_prd']['prd_style']); ?>
			]]></search>
      <add><![CDATA[
			<?php
				// Product Option Image PRO module <<
				if ( !empty($poip_installed) ) {
					if (class_exists('VQMod')) {
						include( VQMod::modCheck( $this->rgen('prd'.$rgen['search_prd']['prd_style']) ) );
					} else {
						include( modification( $this->rgen('prd'.$rgen['search_prd']['prd_style']) ) );
					}
				} else {
					include( $this->rgen('prd'.$rgen['search_prd']['prd_style']) );
				}
				//  >> Product Option Image PRO module
			?>
			]]></add>
    </operation>
		
		<!-- pav styleshop -->
		<operation  error="skip">
			
      <search position="replace"><![CDATA[
      require( DIR_TEMPLATE.$poip_theme_name."/template/product/product_collection.tpl" );
      ]]></search>
      <add><![CDATA[
			// Product Option Image PRO module <<
			if (!empty($poip_installed)) {
				require( VQMod::modCheck(DIR_TEMPLATE.$poip_theme_name."/template/product/product_collection.tpl" ) );
			} else {
				require( DIR_TEMPLATE.$poip_theme_name."/template/product/product_collection.tpl" );
			}
			//  >> Product Option Image PRO module
			]]></add>

    </operation>
		
    <!-- pav styleshop -->
		<operation  error="skip">
			
      <search position="replace"><![CDATA[
      require( DIR_TEMPLATE.$poip_theme_name."/template/module/product_module.tpl" );
      ]]></search>
      <add><![CDATA[
			// Product Option Image PRO module <<
			if (!empty($poip_installed)) {
				require( VQMod::modCheck(DIR_TEMPLATE.$poip_theme_name."/template/module/product_module.tpl" ) );
			} else {
				require( DIR_TEMPLATE.$poip_theme_name."/template/module/product_module.tpl" );
			}
			//  >> Product Option Image PRO module
			]]></add>

    </operation>
    
		
    <operation error="skip">
			<search position="before"><![CDATA[<div class="name">' + $(element).find('.name').html() + '</div>]]></search>
      <!--<search position="before"><![CDATA[var price = $(element).find('.price').html();]]></search> -->
      <add><![CDATA[
			// Product Option Image PRO module <<
			<?php if ($poip_theme_name!='polianna' ) { ?>
				if ($(element).find('[data-poip_id="poip_img"]').length) {  html += $('<div>').append( $(element).find('[data-poip_id="poip_img"]').clone() ).html(); $(element).find('[data-poip_id="poip_img"]').remove() };
			<?php } ?>
			//>> Product Option Image PRO module
			]]></add>
    </operation>
    
		<operation error="skip">
			
			<!-- to one line for some themes -->
			<search position="iafter"><![CDATA[foreach ($products as $product) {]]></search>
      <add><![CDATA[/* << Product Option Image PRO module */ $poip_product_images_shown = false; /* variable to check and not show poip_img twice for the same product */ /* >> Product Option Image PRO module */ ]]></add>
    </operation>
		
		<!-- bt_comohos -->
		<operation error="skip">
			<search position="before" regex="true"><![CDATA[~<div class="caption">|<div class="pro-detail">~]]></search>
      <add><![CDATA[
      <?php // Product Option Image PRO module << ?>
      <?php  if ( !empty($poip_installed) && !empty($poip_theme_name)  && isset($product['option_images']) && $product['option_images']
							&& ($poip_theme_name == "bt_comohos" || $poip_theme_name == "theme573" || $poip_theme_name == "theme628" || $poip_theme_name == 'theme630' || $poip_theme_name == "theme640") ) {
			
				if (!isset($poip_product_images_shown)) $poip_product_images_shown = false;
				
				if (!$poip_product_images_shown) {
				
					$poip_product_images_shown = true;
				
					foreach ($product['option_images'] as $product_option_id => $option_images) {
						
						echo "<div data-poip_id=\"poip_img\" style=\"  text-align: left; margin-top: 3px; width:100%; \">";
						$image_counter = 0;
						foreach ($option_images as $product_option_value_id => $option_image) {
							$image_counter++;
							echo "
											<a onmouseover=\"poip_show_thumb(this);return false;\"
												style=\"display:inline;\" href=\"".$product['href'].(strpos($product['href'],'?')===false?'?':'&amp;')."poip_ov=".(int)$product_option_value_id."\"
												".( (isset($option_image['title']) && $option_image['title']) ? " title=\"".$option_image['title']."\" " : "" )."
												data-thumb=\"".$option_image['thumb']."\"
												data-image_id=\"".$current_class."_".$product['product_id']."\">
											<img src=\"".$option_image['icon']."\" class=\"img-thumbnail\" width=\"23\" height=\"23\" alt=\"".( (isset($option_image['title']) && $option_image['title']) ? $option_image['title'] : "" )."\"></a>
										";
						}
						echo "</div>";
					}
				}
      } ?>
      <?php //  >> Product Option Image PRO module ?>
      ]]></add>
    </operation>
		
		<!-- different themes, different operations -->
		<!-- usual: default, sellegance etc -->
    <operation error="skip">

			<!-- MORE? compatible -->
			<search position="after" regex="true"><![CDATA[~<a href="<\?php echo \$product\['href'\]; \?>"><img~]]></search>
			
			<!-- skip for cosyone theme -->
			<ignoreif><![CDATA[<?php if ($product['thumb_hover'] && $cosyone_rollover_effect == 'enabled') { ?>]]></ignoreif>
			

      <add><![CDATA[
      
      <?php // Product Option Image PRO module << ?>
			
      <?php  if ( !empty($poip_installed) && !empty($poip_theme_name)  && isset($product['option_images']) && $product['option_images'] && $poip_theme_name != "mattimeo"
        && $poip_theme_name != "bt_comohos" && $poip_theme_name != 'stowear' && $poip_theme_name != 'themegloballite' && $poip_theme_name != 'logancee' ) {
				
				if (!isset($poip_product_images_shown) ) $poip_product_images_shown = false;
				
				if (!$poip_product_images_shown) {
				
					if ( $poip_theme_name !== 'marketshop') {
						$poip_product_images_shown = true;
					}
				
					foreach ($product['option_images'] as $product_option_id => $option_images) {
						
						if ($poip_theme_name == "sellegance" || $poip_theme_name == "theme422"
							|| $poip_theme_name == "polianna" || $poip_theme_name == "moneymaker"
							 ) {
							
							echo "<div data-poip_id=\"poip_img\" style=\"  text-align: center; \">";
							$image_counter = 0;
							foreach ($option_images as $product_option_value_id => $option_image) {
								$image_counter++;
								echo "
												<a ". ($poip_theme_name!="mattimeo" ? "onmouseover=\"poip_show_thumb(this);\"" : "") ."
													style=\"display:inline;\" href=\"".$product['href'].(strpos($product['href'],'?')===false?'?':'&amp;')."poip_ov=".(int)$product_option_value_id."\"
													".( (isset($option_image['title']) && $option_image['title']) ? " title=\"".$option_image['title']."\" " : "" )."
													data-thumb=\"".$option_image['thumb']."\"
													data-image_id=\"".$current_class."_".$product['product_id']."\">
												<img src=\"".$option_image['icon']."\" alt=\"".( (isset($option_image['title']) && $option_image['title']) ? $option_image['title'] : "" )."\"></a>
											";
							}
							echo "</div>";
	
						} elseif ($poip_theme_name == "pav_styleshop" ) { // for product_module.tpl
							// just skip
							
						} elseif ($poip_theme_name == "bt_comohos" ) {
						
						} elseif ($poip_theme_name == "welldone" ) {
						
						} elseif ($poip_theme_name == "tt_minoan" ) {
						
						} elseif ($poip_theme_name == "OPC080185" ) {
						
						} elseif ($poip_theme_name == "bt_parallax" ) {
							
            } elseif ($poip_theme_name == 'fastor') { 
						
							echo "<div data-poip_id=\"poip_img\" style=\"   \">";
							$image_counter = 0;
							foreach ($option_images as $product_option_value_id => $option_image) {
								$image_counter++;
								echo "
												<a onmouseover=\"poip_show_thumb(this);\" 
													style=\"display:inline;float:left;\" href=\"".$product['href'].(strpos($product['href'],'?')===false?'?':'&amp;')."poip_ov=".(int)$product_option_value_id."\"
													".( (isset($option_image['title']) && $option_image['title']) ? " title=\"".$option_image['title']."\" " : "" )."
													data-thumb=\"".$option_image['thumb']."\"
													data-image_id=\"".$current_class."_".$product['product_id']."\">
												<img src=\"".$option_image['icon']."\" class=\"img-thumbnail\" alt=\"".( (isset($option_image['title']) && $option_image['title']) ? $option_image['title'] : "" )."\"></a>
											";
							}
							echo "</div>";  
							
						} elseif ($poip_theme_name == "mariposa-purple") {
					
							echo "<div data-poip_id=\"poip_img\" style=\"  text-align: center; margin-top: 3px; \">";
							$image_counter = 0;
							foreach ($option_images as $product_option_value_id => $option_image) {
								$image_counter++;
								echo "
												<a onmouseover=\"poip_show_thumb(this);\" 
													style=\"display:inline;\" href=\"".$product['href'].(strpos($product['href'],'?')===false?'?':'&amp;')."poip_ov=".(int)$product_option_value_id."\"
													".( (isset($option_image['title']) && $option_image['title']) ? " title=\"".$option_image['title']."\" " : "" )."
													data-thumb=\"".$option_image['thumb']."\"
													data-image_id=\"".$current_class."_".$product['product_id']."\">
												<img style=\"width:auto;height:auto;\" src=\"".$option_image['icon']."\" class=\"img-thumbnail\"></a>
											";
							}
							echo "</div>";	
						
						} else { // OC 2.0 new style default
						
							echo "<div data-poip_id=\"poip_img\" style=\"  text-align: center; margin-top: 3px; \">";
							$image_counter = 0;
							foreach ($option_images as $product_option_value_id => $option_image) {
								$image_counter++;
								echo "
												<a onmouseover=\"poip_show_thumb(this);\" 
													style=\"display:inline;\" href=\"".$product['href'].(strpos($product['href'],'?')===false?'?':'&amp;')."poip_ov=".(int)$product_option_value_id."\"
													".( (isset($option_image['title']) && $option_image['title']) ? " title=\"".$option_image['title']."\" " : "" )."
													data-thumb=\"".$option_image['thumb']."\"
													data-image_id=\"".$current_class."_".$product['product_id']."\">
												<img src=\"".$option_image['icon']."\" class=\"img-thumbnail\" alt=\"".( (isset($option_image['title']) && $option_image['title']) ? $option_image['title'] : "" )."\"></a>
											";
											
								
											
							}
							echo "</div>";
						
						}
						
						/* OC 1.X old-style default
						} else {
						
							echo "<table data-poip_id=\"poip_img\" style=\"width: auto; padding:0px; border-collapse:collapse; border-spacing:0px; border:0px;\"><tr><td style='padding:0px;'>";
							$image_counter = 0;
							foreach ($option_images as $product_option_value_id => $option_image) {
								$image_counter++;
								if ($image_counter % 5 == 0) echo "<br>";
								echo "<div class=\"image\" style=\"float:left; margin-left:0px; margin-right:0px; \">
												<a onmouseover=\"poip_show_thumb(this);\" href=\"".$product['href'].(strpos($product['href'],'?')===false?'?':'&amp;')."poip_ov=".(int)$product_option_value_id."\"
													".( (isset($option_image['title']) && $option_image['title']) ? " title=\"".$option_image['title']."\" " : "" )."
													data-thumb=\"".$option_image['thumb']."\"
													data-image_id=\"".$current_class."_".$product['product_id']."\">
												<img src=\"".$option_image['icon']."\" alt=\"".( (isset($option_image['title']) && $option_image['title']) ? $option_image['title'] : "" )."\"></a>
											</div>";
											
								if ($image_counter % 4 == 0) echo "<br>";
							}
							echo "</td></tr></table>";
						}
						*/
					}
				}
      } ?>
      <?php //  >> Product Option Image PRO module ?>
      ]]></add>
    </operation>
		
		<!-- aspire -->
		<operation error="skip">
			<search position="before"><![CDATA[
      <?php if($config->get('magikaspire_sale_label')==1) {
      ]]></search>
      <add><![CDATA[
      <?php // Product Option Image PRO module << ?>
      <?php  if ( !empty($poip_installed) && !empty($poip_theme_name)  && isset($product['option_images']) && $product['option_images'] && substr($poip_theme_name,0,6) == "aspire") {
				if (!isset($poip_product_images_shown) ) $poip_product_images_shown = false;
				if (!$poip_product_images_shown) {
					$poip_product_images_shown = true;
					foreach ($product['option_images'] as $product_option_id => $option_images) {
						
						echo "<div data-poip_id=\"poip_img\" style=\"  text-align: center; margin-top: 3px; \">";
						$image_counter = 0;
						foreach ($option_images as $product_option_value_id => $option_image) {
							$image_counter++;
							echo "
											<a onmouseover=\"poip_show_thumb(this);\" 
												style=\"display:inline;\" href=\"".$product['href'].(strpos($product['href'],'?')===false?'?':'&amp;')."poip_ov=".(int)$product_option_value_id."\"
												".( (isset($option_image['title']) && $option_image['title']) ? " title=\"".$option_image['title']."\" " : "" )."
												data-thumb=\"".$option_image['thumb']."\"
												data-image_id=\"".$current_class."_".$product['product_id']."\">
											<img src=\"".$option_image['icon']."\" class=\"img-thumbnail\" alt=\"".( (isset($option_image['title']) && $option_image['title']) ? $option_image['title'] : "" )."\"></a>
										";
						}
						echo "</div>";
					}
				}
      } ?>
      <?php //  >> Product Option Image PRO module ?>
      ]]></add>
    </operation>
		
    <!-- pav_mode -->
    <operation error="skip">

			<!-- MORE? compatible -->
			<search position="before"><![CDATA[
      <div class="product-meta">
      ]]></search>

      <add><![CDATA[
      
      <?php // Product Option Image PRO module << ?>
			
      <?php if ( !empty($poip_installed) && !empty($poip_theme_name)  && isset($product['option_images']) && $product['option_images'] && $poip_theme_name == "pav_mode") {
				
				if (!isset($poip_product_images_shown) ) $poip_product_images_shown = false;
				
				if (!$poip_product_images_shown) {
				
					$poip_product_images_shown = true;
				
					foreach ($product['option_images'] as $product_option_id => $option_images) {
						
            echo "<div data-poip_id=\"poip_img\" style=\"  text-align: center; \">";
            $image_counter = 0;
            foreach ($option_images as $product_option_value_id => $option_image) {
              $image_counter++;
              echo "
                      <a onmouseover=\"poip_show_thumb(this);\"
                        style=\"display:inline;\" href=\"".$product['href'].(strpos($product['href'],'?')===false?'?':'&amp;')."poip_ov=".(int)$product_option_value_id."\"
                        ".( (isset($option_image['title']) && $option_image['title']) ? " title=\"".$option_image['title']."\" " : "" )."
                        data-thumb=\"".$option_image['thumb']."\"
                        data-image_id=\"".$current_class."_".$product['product_id']."\">
                      <img src=\"".$option_image['icon']."\" alt=\"".( (isset($option_image['title']) && $option_image['title']) ? $option_image['title'] : "" )."\"></a>
                    ";
            }
            echo "</div>";

					}
				}
      } ?>
      <?php //  >> Product Option Image PRO module ?>
      ]]></add>
    </operation>
		
		<!-- pav fashion -->
		<operation error="skip">
			<search position="before"><![CDATA[$.totalStorage('display', 'list');]]></search>
      <add><![CDATA[
			// << Product Option Image PRO module
			$('div#[data-poip_id="poip_img"]').css('top', 'auto');
			$('div.product-action').css('top', 'auto');
			//>> Product Option Image PRO module
			]]></add>
    </operation>
		
		<!-- pav fashion -->
		<operation error="skip">
			<search position="before"><![CDATA[$.totalStorage('display', 'grid');]]></search>
      <add><![CDATA[
			// << Product Option Image PRO module
			$('[data-poip_id="poip_img"]').css('top', '-6px');
			$('div.product-action').css('top', '-70px');
			$('a.pav-colorbox').css('top', 'auto');
			$('a.pav-colorbox').css('bottom', '-40px');
			//>> Product Option Image PRO module
			]]></add>
    </operation>
		
		<!-- pav fashion -->
		<!-- and for lexus_shopping common\product\default.tpl -->
		<operation error="skip">
			<search position="after" ><![CDATA[
      <div class="warp-info">
      ]]></search>
      <add><![CDATA[
      <?php // Product Option Image PRO module << ?>
      <?php  if ( !empty($poip_installed) && !empty($poip_theme_name)  && isset($product['option_images']) && $product['option_images']) {
        foreach ($product['option_images'] as $product_option_id => $option_images) {
					echo "<div data-poip_id='poip_img' style='width:100%; display: table-cell;  position:relative; top:-6px; z-index: 1000;'>";
					$image_counter = 0;
          foreach ($option_images as $product_option_value_id => $option_image) {
						$image_counter++;
						echo "			 
									<a style=\"margin:0px; margin-left:2px; margin-bottom:2px;  float:left; \" onmouseover=\"poip_show_thumb(this);\" href=\"".$product['href'].(strpos($product['href'],'?')===false?'?':'&amp;')."poip_ov=".(int)$product_option_value_id."\"
										".( (isset($option_image['title']) && $option_image['title']) ? " title=\"".$option_image['title']."\" " : "" )."
										data-thumb=\"".$option_image['thumb']."\"
										data-image_id=\"".$current_class."_".$product['product_id']."\">
									<img style=\"\" src=\"".$option_image['icon']."\"></a>
								 ";		
          }
					echo "</div>";
        }
      } ?>
      <?php //  >> Product Option Image PRO module ?>
      ]]></add>
    </operation>
		
		<!-- pav styleshop for product_collection.tpl & product_module.tpl -->
		<operation error="skip">
			<!--
			<search position="before" ><![CDATA[
      <h3 class="name"><a href="<?php echo $product['href']; ?>
      ]]></search>
			-->
			<search position="before" ><![CDATA[
      <h3 class="name"><a href="<?php echo $product['href']; ?>"><?php echo $product['name']; ?></a></h3>
      ]]></search>
			<ignoreif><![CDATA[<div class="productdeals">]]></ignoreif>
			
      <add><![CDATA[
      <?php // Product Option Image PRO module << ?>
      <?php  if ( !empty($poip_installed) && !empty($poip_theme_name)  && isset($product['option_images']) && $product['option_images']) {
        foreach ($product['option_images'] as $product_option_id => $option_images) {
					echo "<div data-poip_id='poip_img' style='width:100%; display: table-cell;  position:relative; top:-6px; z-index: 1000;'>";
					$image_counter = 0;
          foreach ($option_images as $product_option_value_id => $option_image) {
						$image_counter++;
						echo "			 
									<a style=\"margin:0px; margin-left:2px; margin-bottom:2px;  float:left; \" onmouseover=\"poip_show_thumb(this);\" href=\"".$product['href'].(strpos($product['href'],'?')===false?'?':'&amp;')."poip_ov=".(int)$product_option_value_id."\"
										".( (isset($option_image['title']) && $option_image['title']) ? " title=\"".$option_image['title']."\" " : "" )."
										data-thumb=\"".$option_image['thumb']."\"
										data-image_id=\"".$current_class."_".$product['product_id']."\">
									<img style=\"\" src=\"".$option_image['icon']."\"></a>
								 ";		
          }
					echo "</div>";
        }
      } ?>
      <?php //  >> Product Option Image PRO module ?>
      ]]></add>
    </operation>
		
		<!-- theme stowear compatibility - list -->
		<operation error="skip">
			<search position="before" offset="1"><![CDATA[
			<div class="name"><a href="<?php echo $product['href']; ?>"><?php echo $product['name']; ?></a></div>
			]]></search>
      <add><![CDATA[
			<?php // Product Option Image PRO module << ?>
			
      <?php if ( !empty($poip_installed) && isset($product['option_images']) && $product['option_images'] && $poip_theme_name != "mattimeo") {
			
				foreach ($product['option_images'] as $product_option_id => $option_images) {
					
					if ( $poip_theme_name == 'stowear' || $poip_theme_name == 'themegloballite' || $poip_theme_name == 'logancee' ) {
					
						echo "<div data-poip_id=\"poip_img\" style=\" display:inline-block;  \">";
						$image_counter = 0;
						foreach ($option_images as $product_option_value_id => $option_image) {
							$image_counter++;
							echo "
											<a onmouseover=\"poip_show_thumb(this);\" 
												style=\"display:inline;\" href=\"".$product['href'].(strpos($product['href'],'?')===false?'?':'&')."poip_ov=".(int)$product_option_value_id."\"
												".( (isset($option_image['title']) && $option_image['title']) ? " title=\"".$option_image['title']."\" " : "" )."
												data-thumb=\"".$option_image['thumb']."\"
												data-image_id=\"".$current_class."_".$product['product_id']."\">
											<img src=\"".$option_image['icon']."\" class=\"img-thumbnail\"></a>
										";
						}
						echo "</div>";
					
					}
				}
      } ?>
      <?php //  >> Product Option Image PRO module ?>
			]]></add>

    </operation>
		
		<!-- theme stowear compatibility - grid in separate tpl-->
		<operation error="skip">
			
      <search position="replace"><![CDATA[
      <?php include('catalog/view/theme/'.$config->get('config_template').'/template/new_elements/product.tpl'); ?>
      ]]></search>
      <add><![CDATA[
			<?php
				// Product Option Image PRO module <<
				
				if (!empty($poip_installed)) {
					include( VQMod::modCheck('catalog/view/theme/'.$config->get('config_template').'/template/new_elements/product.tpl') );
				} else {
					include( 'catalog/view/theme/'.$config->get('config_template').'/template/new_elements/product.tpl' );
				}
				
				
				//  >> Product Option Image PRO module
			?>
			]]></add>

    </operation>
    
    <!-- theme themegloballite compatibility - grid in separate tpl-->
		<operation error="skip">
      <search position="replace"><![CDATA[
      <?php include('catalog/view/theme/'.$config->get('config_template').'/template/themeglobal/product_grid.tpl'); ?>
      ]]></search>
      <add><![CDATA[
			<?php
				// Product Option Image PRO module <<
				if (!empty($poip_installed)) {
          include( VQMod::modCheck( 'catalog/view/theme/'.$config->get('config_template').'/template/themeglobal/product_grid.tpl' ) );
				} else {
					include('catalog/view/theme/'.$config->get('config_template').'/template/themeglobal/product_grid.tpl');
				}
				//  >> Product Option Image PRO module
			?>
			]]></add>
    </operation>
    
    <!-- theme themegloballite compatibility - list in separate tpl-->
		<operation error="skip">
      <search position="replace"><![CDATA[
      <?php include('catalog/view/theme/'.$config->get('config_template').'/template/themeglobal/product_list.tpl'); ?>
      ]]></search>
      <add><![CDATA[
			<?php
				// Product Option Image PRO module <<
				if (!empty($poip_installed)) {
          include( VQMod::modCheck( 'catalog/view/theme/'.$config->get('config_template').'/template/themeglobal/product_list.tpl' ) );
				} else {
					include('catalog/view/theme/'.$config->get('config_template').'/template/themeglobal/product_list.tpl');
				}
				//  >> Product Option Image PRO module
			?>
			]]></add>
    </operation>
		
		<!-- theme fashionista compatibility -->
		<operation error="skip">
      <search position="replace"><![CDATA[
				<?php include('catalog/view/theme/'.$config->get($config->get('config_theme') . '_directory').'/template/themeglobal/product_list.tpl'); ?>
      ]]></search>
      <add><![CDATA[
			<?php
				/* << Product Option Image PRO module */
				if (class_exists('VQMod')) {
					include( VQMod::modCheck( modification( 'catalog/view/theme/'.$config->get($config->get('config_theme') . '_directory').'/template/themeglobal/product_list.tpl' ) ) );
				} else {
					include( modification( 'catalog/view/theme/'.$config->get($config->get('config_theme') . '_directory').'/template/themeglobal/product_list.tpl' ) );
				}
				//  >> Product Option Image PRO module
			?>
			]]></add>
    </operation>
		
		<!-- theme fashionista compatibility -->
		<operation error="skip">
      <search position="replace"><![CDATA[
				<?php include('catalog/view/theme/'.$config->get($config->get('config_theme') . '_directory').'/template/themeglobal/product_grid.tpl'); ?>
      ]]></search>
      <add><![CDATA[
			<?php
				/* << Product Option Image PRO module  */
				if (class_exists('VQMod')) {
					include( VQMod::modCheck( modification( 'catalog/view/theme/'.$config->get($config->get('config_theme') . '_directory').'/template/themeglobal/product_grid.tpl' ) ) );
				} else {
					include( modification( 'catalog/view/theme/'.$config->get($config->get('config_theme') . '_directory').'/template/themeglobal/product_grid.tpl' ) );
				}
				//  >> Product Option Image PRO module
			?>
			]]></add>
    </operation>
		
		<!-- theme fashionista compatibility -->
		<operation error="skip">
      <search position="replace"><![CDATA[
				<?php include('catalog/view/theme/'.$config->get($config->get('config_theme') . '_directory').'/template/themeglobal/product.tpl'); ?>
      ]]></search>
      <add><![CDATA[
			<?php
				/* << Product Option Image PRO module  */
				if (class_exists('VQMod')) {
					include( VQMod::modCheck( modification( 'catalog/view/theme/'.$config->get($config->get('config_theme') . '_directory').'/template/themeglobal/product.tpl' ) ) );
				} else {
					include( modification( 'catalog/view/theme/'.$config->get($config->get('config_theme') . '_directory').'/template/themeglobal/product.tpl' ) );
				}
				//  >> Product Option Image PRO module
			?>
			]]></add>
    </operation>
    
    <!-- opc1000 - Fashion Store 2.0 theme -->
    <operation error="skip">
			<search position="before" ><![CDATA[
      <div class="caption">
      ]]></search>
      <add><![CDATA[
      <?php // Product Option Image PRO module << ?>
      <?php  if ( !empty($poip_installed) && !empty($poip_theme_name)  && isset($product['option_images']) && $product['option_images'] && $poip_theme_name == 'opc1000') {
      
        foreach ($product['option_images'] as $product_option_id => $option_images) {
          
					echo "<div data-poip_id=\"poip_img\" style=\"  text-align: center; margin-top: 3px; \">";
          $image_counter = 0;
          foreach ($option_images as $product_option_value_id => $option_image) {
            $image_counter++;
            echo "
                    <a onmouseover=\"poip_show_thumb(this);\" 
                      style=\"display:inline;\" href=\"".$product['href'].(strpos($product['href'],'?')===false?'?':'&amp;')."poip_ov=".(int)$product_option_value_id."\"
                      ".( (isset($option_image['title']) && $option_image['title']) ? " title=\"".$option_image['title']."\" " : "" )."
                      data-thumb=\"".$option_image['thumb']."\"
                      data-image_id=\"".$current_class."_".$product['product_id']."\">
                    <img src=\"".$option_image['icon']."\" class=\"img-thumbnail\" alt=\"".( (isset($option_image['title']) && $option_image['title']) ? $option_image['title'] : "" )."\"></a>
                  ";
          }
          echo "</div>";
					
        }
      
      } ?>
      <?php //  >> Product Option Image PRO module ?>
      ]]></add>
    </operation>
    
    
    <operation error="skip">
			<search position="before" ><![CDATA[
      <div class="row product-bottom-info">
      ]]></search>
      <add><![CDATA[
      <?php // Product Option Image PRO module << ?>
      <?php  if ( !empty($poip_installed) && !empty($poip_theme_name)  && isset($product['option_images']) && $product['option_images'] && $poip_theme_name == 'moment') {
      
        foreach ($product['option_images'] as $product_option_id => $option_images) {
          
					echo "<div data-poip_id=\"poip_img\" style=\"  text-align: center; margin-top: 3px; \">";
          $image_counter = 0;
          foreach ($option_images as $product_option_value_id => $option_image) {
            $image_counter++;
            echo "
                    <a onmouseover=\"poip_show_thumb(this);$('.product-thumb__secondary').hide();\" onmouseout=\"$('.product-thumb__secondary').show();\"
                      style=\"display:inline;\" href=\"".$product['href'].(strpos($product['href'],'?')===false?'?':'&amp;')."poip_ov=".(int)$product_option_value_id."\"
                      ".( (isset($option_image['title']) && $option_image['title']) ? " title=\"".$option_image['title']."\" " : "" )."
                      data-thumb=\"".$option_image['thumb']."\"
                      data-image_id=\"".$current_class."_".$product['product_id']."\">
                    <img src=\"".$option_image['icon']."\" class=\"img-thumbnail\" alt=\"".( (isset($option_image['title']) && $option_image['title']) ? $option_image['title'] : "" )."\"></a>
                  ";
          }
          echo "</div>";
					
        }
      
      } ?>
      <?php //  >> Product Option Image PRO module ?>
      ]]></add>
    </operation>
		
		<!-- alogin (additional images in product lists -->
		<operation error="skip">
      <search position="iafter"><![CDATA[
				<?php foreach ($product['images'] as $image) { ?>
			]]></search>
      <add><![CDATA[
				<?php // << Product Option Image PRO module ?>
				<?php if ( !empty($poip_theme_name) && $poip_theme_name == 'alogin' && !empty($poip_installed) && !empty($product['imageaddit'])  ) {
				
					// to not show the main image twice
					if ( $image['popup'] == $product['imageaddit'] || (!empty($product['thumb']) && $product['thumb'] == $image['popup'] ) ) continue;
				} ?>
				<?php // >> Product Option Image PRO module ?>
      ]]></add>
    </operation>
		
  </file>
	
	<!-- optimus & myshop & yourstore theme specific file -->
	<file name="catalog/view/theme/listing.php,catalog/view/theme/module_list.php,catalog/view/theme/list.php" error="skip">
		<operation error="skip">
      <search position="iafter" ><![CDATA[
				src="<?php echo $product['thumb']; ?>"
			]]></search>
      <add><![CDATA[ <?php // Product Option Image PRO module << ?><?php if (!isset($current_class)) $current_class = time(); ?> data-poip_id="image_<?php echo "".$current_class."_".$product['product_id']; ?>" <?php   //  >> Product Option Image PRO module  ?> ]]></add>
    </operation>
		
		<operation error="skip">
      <search position="after"><![CDATA[
				foreach ($product['additional_images'] as $additional_image) :
			]]></search>
      <add><![CDATA[
				if ( $additional_image['image'] == $product['thumb'] ) continue;
			]]></add>
    </operation>
		
		<operation error="skip">			
      <search position="iafter" ><![CDATA[
				<img src="<?php echo str_replace(' ', '%20',$product['thumb']); ?>"
			]]></search>
      <add><![CDATA[ <?php // Product Option Image PRO module << ?><?php if (!isset($current_class)) $current_class = uniqid(); ?> data-poip_id="image_<?php echo "".$current_class."_".$product['product_id']; ?>" <?php   //  >> Product Option Image PRO module  ?> ]]></add>
    </operation>
		
	</file>
	
	
	<!-- fastor, porto, stowear && themeglobal && tg fashionista compatibility - grid-->
	<file name="catalog/view/theme/*/template/new_elements/product.tpl,catalog/view/theme/*/template/themeglobal/product_grid.tpl,catalog/view/theme/*/template/themeglobal/product.tpl" error="skip">
		
		<operation error="skip">
      <search position="iafter" ><![CDATA[
				src="<?php echo $product['thumb']; ?>"
			]]></search>
      <add><![CDATA[
				<?php
					// << Product Option Image PRO
					if (!isset($current_class)) $current_class = (microtime(true)*10000).rand(0,1000000);
					echo 'data-poip_id="image_'.$current_class.'_'.$product['product_id'].'"';
					if ( !empty($product['option_images']) ) {
						echo 'data-poip-images="'.htmlspecialchars(json_encode( $product['option_images']), ENT_QUOTES, 'UTF-8' ).'"';
					}
					// >> Product Option Image PRO
				?>
			]]></add>
    </operation>			
					
		<!--
		<operation error="skip">
      <search position="iafter" ><![CDATA[
				src="<?php echo $product['thumb']; ?>"
			]]></search>
      <add><![CDATA[ <?php // Product Option Image PRO module << if (!isset($current_class)) $current_class = time(); ?> data-poip_id="image_<?php echo "".$current_class."_".$product['product_id']; ?>" <?php   //  >> Product Option Image PRO module ?> ]]></add>
    </operation>
		-->
		
    <!-- goshop -->
    <operation error="skip">
      <search position="iafter" ><![CDATA[
			<img src="image/catalog/blank.gif" data-echo="<?php echo $product['thumb']; ?>"
			]]></search>
      <add><![CDATA[ <?php // Product Option Image PRO module << if (!isset($current_class)) $current_class = time(); ?> data-poip_id="image_<?php echo "".$current_class."_".$product['product_id']; ?>" <?php   //  >> Product Option Image PRO module ?> ]]></add>

    </operation>
    
    <!-- goshop -->
		
	</file>
  
  <!-- themeglobal compatibility - list -->
	<file name="catalog/view/theme/*/template/themeglobal/product_list.tpl" error="skip">
		
		<operation>
			<search position="after"><![CDATA[
			<div class="name-desc col-sm-6">
			]]></search>
      <add><![CDATA[
			<?php // Product Option Image PRO module << ?>
			
      <?php if ( !empty($poip_installed) && isset($product['option_images']) && $product['option_images'] && $poip_theme_name != "mattimeo") {
			
				foreach ($product['option_images'] as $product_option_id => $option_images) {
					
					if ( $poip_theme_name == 'themegloballite' ) {
					
						echo "<div data-poip_id=\"poip_img\" style=\" display:inline-block;  \">";
						$image_counter = 0;
						foreach ($option_images as $product_option_value_id => $option_image) {
							$image_counter++;
							echo "
											<a onmouseover=\"poip_show_thumb(this);\" 
												style=\"display:inline;\" href=\"".$product['href'].(strpos($product['href'],'?')===false?'?':'&')."poip_ov=".(int)$product_option_value_id."\"
												".( (isset($option_image['title']) && $option_image['title']) ? " title=\"".$option_image['title']."\" " : "" )."
												data-thumb=\"".$option_image['thumb']."\"
												data-image_id=\"".$current_class."_".$product['product_id']."\">
											<img src=\"".$option_image['icon']."\" class=\"img-thumbnail\"></a>
										";
						}
						echo "</div>";
					
					}
				}
      } ?>
      <?php //  >> Product Option Image PRO module ?>
			]]></add>

    </operation>
		
		<operation error="skip">
      <search position="iafter" ><![CDATA[
			src="<?php echo $product['thumb']; ?>"
			]]></search>
      <add><![CDATA[ <?php // Product Option Image PRO module << if (!isset($current_class)) $current_class = time(); ?> data-poip_id="image_<?php echo "".$current_class."_".$product['product_id']; ?>" <?php   //  >> Product Option Image PRO module ?> ]]></add>
    </operation>
		
	</file>	
    
  <file name="catalog/controller/common/header.php">  
    
    <operation >
      <search position="after"><![CDATA[
      function index() {
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
			
      if ( !$this->model_module_product_option_image_pro ) {
				$this->load->model('module/product_option_image_pro');
			}
      $data['poip_installed'] = $this->model_module_product_option_image_pro->installed();
			$data['poip_settings'] = $this->model_module_product_option_image_pro->getSettings();
			$data['poip_theme_name'] = $this->model_module_product_option_image_pro->getThemeName();
			$data['poip_inclide_file_name_default'] = $this->model_module_product_option_image_pro->getTemplateIncludeFileName('list', true);
			$data['poip_inclide_file_name_custom'] = $this->model_module_product_option_image_pro->getTemplateIncludeFileName('list');
			
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
    
  </file>  
    
  <!-- journal2 theme header compatibility -->
  <file name="catalog/view/theme/journal2/template/common/header.tpl" error="skip">
    
    <operation error="skip">
      <search position="before" index="2"><![CDATA[
      <?php if (version_compare(VERSION, '2.1', '<')): ?>
      ]]></search>
      <add><![CDATA[
      <?php /* POIP poip_show_thumb place */ ?>
      ]]></add>
    </operation>
    
  </file>
	
	<!-- journal2 hide carousel from the start -->
	<file name="catalog/view/theme/journal2/template/product/product.tpl" error="skip">
    
    <operation error="skip">
      <search position="iafter" ><![CDATA[
      <div id="product-gallery"
      ]]></search>
      <add><![CDATA[
				<?php if (!empty($poip_installed)) { ?> style="height:0px!important;" <?php } ?>
      ]]></add>
    </operation>
    
  </file>
	
	<!-- Comohos hide carousel from the start -->
	<file name="catalog/view/theme/bt_comohos/template/product/product.tpl,catalog/view/theme/*/template/module/boss_zoom.tpl,catalog/view/theme/*/template/extension/module/boss_zoom.tpl" error="skip">
		
		<operation error="skip">
      <search position="iafter" ><![CDATA[<li><a href="<?php echo $popup; ?>" title="<?php echo $heading_title; ?>"]]></search>
      <add><![CDATA[  <?php if (!empty($poip_installed)) { ?> style="opacity: 0;" <?php } ?>  ]]></add>
    </operation>
		
    <operation error="skip">
      <search position="ireplace" ><![CDATA[<div class="image"><a href="<?php echo $popup; ?>"]]></search>
      <add><![CDATA[<div class="image"  <?php if (!empty($poip_installed)) { ?> style="opacity: 0;" <?php } ?>  ><a href="<?php echo $popup; ?>" ]]></add>
    </operation>
		
		<operation error="skip">
      <search position="replace" regex="true"><![CDATA[~<div class( )?="image-additional">~]]></search>
      <add><![CDATA[
				<div class="image-additional" <?php if (!empty($poip_installed)) { ?> style="opacity: 0;" <?php } ?> >
      ]]></add>
    </operation>
		
		<!--
		<operation error="skip">
      <search position="iafter" ><![CDATA[<li><a href="<?php echo $popup; ?>" title="<?php echo $heading_title; ?>"]]></search>
      <add><![CDATA[  <?php if (!empty($poip_installed)) { ?> style="display: none;" <?php } ?>  ]]></add>
    </operation>
		
    <operation error="skip">
      <search position="ireplace" ><![CDATA[<div class="image"><a href="<?php echo $popup; ?>"]]></search>
      <add><![CDATA[<div class="image"  <?php if (!empty($poip_installed)) { ?> style="display: none;" <?php } ?>  ><a href="<?php echo $popup; ?>" ]]></add>
    </operation>
		
		<operation error="skip">
      <search position="replace" regex="true"><![CDATA[~<div class( )?="image-additional">~]]></search>
      <add><![CDATA[
				<div class="image-additional" <?php if (!empty($poip_installed)) { ?> style="display: none;" <?php } ?> >
      ]]></add>
    </operation>
		-->
    
  </file>
    
    
  <file name="catalog/view/theme/*/template/common/header.tpl,catalog/view/theme/*/template/common/header*.tpl,catalog/view/theme/*/template/common/mobiheader.tpl" error="skip">    
    
    <!-- SCRIPT -->
		<!-- before </head> -->
    <operation error="skip">
			<search position="before" regex="true" index="1"><![CDATA[~POIP poip_show_thumb place|</head>|<div class="nav-submenu">|<header>~]]></search>
			<ignoreif><![CDATA[include( modification($poip_inclide_file_name_default) );]]></ignoreif>
			<!-- both analitics may be wrong for BurnEngine -->
			<!--<search position="before" regex="true" index="1"><![CDATA[~POIP poip_show_thumb place|</head>|echo \$google_analytics;|foreach \(\$analytics as \$analytic\) { \?>~]]></search>-->
      <!--<ignoreif><![CDATA[function poip_show_thumb(elem) {]]></ignoreif>-->
			<!-- <search position="before" regex="true"><![CDATA[~echo \$google_analytics;|foreach \(\$analytics as \$analytic\) { \?>~]]></search> -->
			<!--<search position="before" regex="true" index="1"><![CDATA[~echo \$google_analytics;|foreach \(\$analytics as \$analytic\) { \?>~]]></search>-->
			<!--
      <search position="after"><![CDATA[
			$google_analytics;  
      ]]></search>
			-->
      <add><![CDATA[
			
			<?php // << Product Option Image PRO ?>
			<!-- 123123 -->
			<?php if ( !empty($poip_installed) ) { ?>
				<script  type = "text/javascript" ><!--
					function poip_show_thumb(elem) {
						
						if ($(elem).attr('data-thumb') && $(elem).attr('data-image_id')) {
										
							var main_img = $('img[data-poip_id="image_'+$(elem).attr('data-image_id')+'"]');
							if (main_img.length == 0) {
								main_img = $('img[data-poip_id="'+$(elem).attr('data-image_id')+'"]');
							}
							
							var prev_img = main_img.attr('src'); // journal2 compatibility
							main_img.attr('src', $(elem).attr('data-thumb'));
							main_img.closest('a').attr('href', $(elem).attr('href'));
							
							// moment theme compatibility (second image)
							if ( main_img.parent().parent().is('div.product-thumb__primary') ) {
								main_img.parent().parent().siblings('div.product-thumb__secondary').find('a').attr('href', $(elem).attr('href'));
							}
							
							// journal2 compatibility
							if (main_img.parent().hasClass('has-second-image')) {
								main_img.parent().attr('style', main_img.parent().attr('style').replace(prev_img, $(elem).attr('data-thumb')) );
							}
							
						}
					}
				//--></script>
			<?php } ?>
					
			<?php
			
				if ( !empty($poip_installed) ) {
					if ( !empty($poip_inclide_file_name_custom) ) {
					
						// for poip_list (for common/header script) default should be loaded only if custom exists
						if ( !empty($poip_inclide_file_name_default) ) {
							if (class_exists('VQMod')) {
								include( VQMod::modCheck( modification($poip_inclide_file_name_default) ) );
							} else {
								include( modification($poip_inclide_file_name_default) );
							}
						}
					
						if (class_exists('VQMod')) {
							include( VQMod::modCheck( modification($poip_inclide_file_name_custom) ) );
						} else {
							include( modification($poip_inclide_file_name_custom) );
						}
						
					}
					
					if (isset($poip_theme_name) && $poip_theme_name=='cosyone') {
						set_include_path(get_include_path() . PATH_SEPARATOR . DIR_APPLICATION.'/view/theme/cosyone/template/common');
					}
				}
			?>
			<?php // >> Product Option Image PRO ?>
			]]></add>
    </operation>
		
  </file>
  
  <!-- картинки в корзинке -->
  <file name="system/library/cart.php,system/library/cart/cart.php" error="skip">    
  
    
   <operation >
      <search position="after" index="1"><![CDATA[
      class Cart 
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      
			private $poipregistry;
      //private $poiploader;
			
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
		
		<operation >
      <search position="after"><![CDATA[
      public function __construct($registry) {
      ]]></search>
      <add><![CDATA[
      // Product Option Image PRO module <<
      
			$this->poipregistry = $registry;
      //$this->poiploader = $registry->get('load');
			
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
		
    <operation >
			<search position="before" regex="true"><![CDATA[~\$this->data\[\$key\] = array\(|\$product_data\[\] = array\(~]]></search>
			<!--
      <search position="before"><![CDATA[
      $this->data[$key] = array(
      ]]></search>
			-->
      <add><![CDATA[
      // Product Option Image PRO module <<
      
      /*
			global $registry;
      //global $loader, $registry;
			
			if ($registry) {
				$poipregistry = $registry;
			} else {
				$poipregistry = $this->poipregistry;
			}
			$poiploader = new Loader($poipregistry);
      */
      $poiploader = $this->poipregistry->get('load');
			
      $poiploader->model('module/product_option_image_pro');
      $poip_model = $this->poipregistry->get('model_module_product_option_image_pro');
      //$poip_model = $poipregistry->get('model_module_product_option_image_pro');
      $product_query->row['image'] = $poip_model->getProductCartImage($product_query->row['product_id'], $option_data, $product_query->row['image']);
      
      // >> Product Option Image PRO module
      ]]></add>
    </operation>
    
  </file>
  


	<!-- <<<< Product Option Image PRO - compatibility with Product images anywhere  / Изображения опций PRO - совместимость с Product images anywhere</id> -->
  
  
  <!-- Product Images in Checkout -->
  <file name="catalog/controller/checkout/confirm.php">
		<operation error="skip">
			<search position="before"><![CDATA[
			$thumb = $this->model_tool_image->resize($image, 60, 60);
			]]></search>
			<add><![CDATA[
			// << Product Option Image PRO module
      if ( !$this->model_module_product_option_image_pro ) {
				$this->load->model('module/product_option_image_pro');
			}
      $image = $this->model_module_product_option_image_pro->getProductCartImage((int)$product['product_id'], $product['option'], $image);
      // >> Product Option Image PRO module
			]]></add>
		</operation>
  </file>
	
	<!-- so themes: add to cart -->
	<file name="catalog/controller/soconfig/cart.php" error="skip">
		<operation error="skip">
			<search position="before"><![CDATA[
				$image = $this->model_tool_image->resize($product_info['image']
			]]></search>
			<add><![CDATA[
				// << Product Option Image PRO module
				if ( !$this->model_module_product_option_image_pro ) {
					$this->load->model('module/product_option_image_pro');
				}
				if ( $this->model_module_product_option_image_pro->installed() ) {
					$poip_options = array();
					foreach ($option as $po_id => $pov_id) {
						$poip_options[] = array('product_option_id'=>$po_id, 'product_option_value_id'=>$pov_id);
					}
					$product_info['image'] = $this->model_module_product_option_image_pro->getProductCartImage((int)$product_info['product_id'], $poip_options, $product_info['image']);
				}
				// >> Product Option Image PRO module
			]]></add>
		</operation>
	</file>
	
	<file name="catalog/controller/checkout/cart.php">
		
		<!-- journal2 compatibility Product Images in temp-success-window -->
		<operation error="skip">
			<search position="before"><![CDATA[
				$json['image'] = Journal2Utils::resizeImage($this->model_tool_image, $product_info['image']
			]]></search>
			<add><![CDATA[
				// << Product Option Image PRO module
				if ( !$this->model_module_product_option_image_pro ) {
					$this->load->model('module/product_option_image_pro');
				}
				$poip_options = array();
				foreach ($option as $po_id => $pov_id) {
					$poip_options[] = array('product_option_id'=>$po_id, 'product_option_value_id'=>$pov_id);
				}
				$product_info['image'] = $this->model_module_product_option_image_pro->getProductCartImage((int)$product_info['product_id'], $poip_options, $product_info['image']);
				// >> Product Option Image PRO module
			]]></add>
		</operation>
		
		<!-- butik compatibility Product Images in temp-success-window -->
		<operation error="skip">
			<search position="before"><![CDATA[
				$json['image'] = $image;
			]]></search>
			<add><![CDATA[
				// << Product Option Image PRO module
				if ( !$this->model_module_product_option_image_pro ) {
				$this->load->model('module/product_option_image_pro');
				}
				$poip_options = array();
				foreach ($option as $po_id => $pov_id) {
				$poip_options[] = array('product_option_id'=>$po_id, 'product_option_value_id'=>$pov_id);
				}
				$product_info['image'] = $this->model_module_product_option_image_pro->getProductCartImage((int)$product_info['product_id'], $poip_options, $product_info['image']);
				if ($product_info['image']) {
				$image = $this->model_tool_image->resize($product_info['image'], 210,210);
				} else {
				$image = $this->model_tool_image->resize('placeholder.png', 210, 210);
				}
				// >> Product Option Image PRO module
			]]></add>
		</operation>
		
		<!-- unishop compatibility Product Images in success popup -->
		<operation error="skip">
			<search position="before"><![CDATA[
				if (isset($uniset['show_checkout'])) {
			]]></search>
			<add><![CDATA[
				// << Product Option Image PRO
				if ( !$this->model_module_product_option_image_pro ) {
					$this->load->model('module/product_option_image_pro');
				}
				if ( $this->model_module_product_option_image_pro->installed() ) {
					$poip_options = array();
					foreach ($option as $po_id => $pov_id) {
						$poip_options[] = array('product_option_id'=>$po_id, 'product_option_value_id'=>$pov_id);
					}
					$poip_image = $this->model_module_product_option_image_pro->getProductCartImage((int)$product_info['product_id'], $poip_options, $product_info['image']);
					$success_image = $poip_image ? $this->model_tool_image->resize($poip_image, 100, 100) : '';
				}
				// >> Product Option Image PRO 
			]]></add>
		</operation>
		
		<!-- unishop fix the theme bug with multiplication of #modal-cart -->
		<operation error="skip">
			<search position="after"><![CDATA[
				$json['success_new'] =
			]]></search>
			<add><![CDATA[
				// << Product Option Image PRO
				if ( !$this->model_module_product_option_image_pro ) {
					$this->load->model('module/product_option_image_pro');
				}
				if ( $this->model_module_product_option_image_pro->installed() ) {
					$json['success_new'].= '<script>$(\'[id="modal-cart"]:not(:eq(\'+($(\'[id="modal-cart"]\').length-1)+\'))\').remove()</script>';
				}
				// >> Product Option Image PRO 
			]]></add>
		</operation>
		
		<!-- storeset (shop-store2) -->
		<operation error="skip">
			<search position="before"><![CDATA[
				$product_info['image'] = $this->model_tool_image->resize(
			]]></search>
			<add><![CDATA[
				// << Product Option Image PRO module
				if ( !$this->model_module_product_option_image_pro ) {
					$this->load->model('module/product_option_image_pro');
				}
				$poip_options = array();
				foreach ($option as $po_id => $pov_id) {
					$poip_options[] = array('product_option_id'=>$po_id, 'product_option_value_id'=>$pov_id);
				}
				$product_info['image'] = $this->model_module_product_option_image_pro->getProductCartImage((int)$product_info['product_id'], $poip_options, $product_info['image']);
				// >> Product Option Image PRO module
			]]></add>
		</operation>
		
  </file>
  
  
  <file name="catalog/model/checkout/order.php">
		
		<!-- Product Images in Order Order Email -->
		<operation error="skip">
			<search position="before"><![CDATA[
			$thumb = $this->model_tool_image->resize($image, 60, 60);
			]]></search>
			<add><![CDATA[
			// << Product Option Image PRO module
      $order_option_query = $this->db->query("SELECT * FROM " . DB_PREFIX . "order_option WHERE order_id = '" . (int)$order_id . "' AND order_product_id = '" . (int)$product['order_product_id'] . "'");
      if ( !$this->model_module_product_option_image_pro ) {
				$this->load->model('module/product_option_image_pro');
			}
      $image = $this->model_module_product_option_image_pro->getProductCartImage((int)$product['product_id'], $order_option_query->rows, $image);
      // >> Product Option Image PRO module
			]]></add>
		</operation>
		
		<!-- compatibility with other modification to show images in order -->
		<operation error="skip">
			<search position="before"><![CDATA[
			if ($product_info['image']) {
			]]></search>
			<add><![CDATA[
			// << Product Option Image PRO module
      if ( !$this->model_module_product_option_image_pro ) {
				$this->load->model('module/product_option_image_pro');
			}
			if ( $this->model_module_product_option_image_pro->installed() ) {
				
				if ( !$this->model_account_order ) {
					$this->load->model('account/order');
				}
			
				$poip_options = $this->model_account_order->getOrderOptions($order_id, $product['order_product_id']);
				if ( !empty($poip_options) ) {
					$product_info['image'] = $this->model_module_product_option_image_pro->getProductCartImage((int)$product_info['product_id'], $poip_options, $product_info['image']);
				}
				unset($poip_options);
			}
      // >> Product Option Image PRO module
			]]></add>
		</operation>
		
  </file>
	
  <file name="catalog/controller/account/order.php">
		
		<!-- Product Images in Order History Page -->
		<operation error="skip">
			<search position="before"><![CDATA[
			$thumb = $this->model_tool_image->resize($image, 60, 60);
			]]></search>
			<add><![CDATA[
			// << Product Option Image PRO module
      if ( !$this->model_module_product_option_image_pro ) {
				$this->load->model('module/product_option_image_pro');
			}
      $image = $this->model_module_product_option_image_pro->getProductCartImage((int)$product['product_id'], $options, $image);
      // >> Product Option Image PRO module
			]]></add>
		</operation>
		
		<!-- compatibility with other modification to show images in order -->
		<operation error="skip">
			<search position="before"><![CDATA[
			if ($product_info['image']) {
			]]></search>
			<add><![CDATA[
			// << Product Option Image PRO module
      if ( !$this->model_module_product_option_image_pro ) {
				$this->load->model('module/product_option_image_pro');
			}
			if ( $this->model_module_product_option_image_pro->installed() && !empty($options) ) {
				$product_info['image'] = $this->model_module_product_option_image_pro->getProductCartImage((int)$product_info['product_id'], $options, $product_info['image']);
			}
      // >> Product Option Image PRO module
			]]></add>
		</operation>
		
  </file>

	<!-- >>>> Product Option Image PRO - compatibility with Product images anywhere  / Изображения опций PRO - совместимость с Product images anywhere</id> -->

	
	<!-- Images for RadioBoxes and Checkboxes -->
	<file name="catalog/view/theme/*/template/product/product.tpl,catalog/view/theme/*/template/product/product_detail_hitech.tpl,catalog/view/theme/*/template/product/detail/default.tpl" error="skip">
		<operation error="skip">
			<search position="after"><![CDATA[
			<input type="radio" name="option
			]]></search>
			<add><![CDATA[
			<?php
			// << Product Option Image PRO module

			if ($option['type'] == 'radio' && isset($option_value['poip_image']) && $option_value['poip_image'] ) {
				?>
				<img src="<?php echo $option_value['poip_image']; ?>" alt="<?php echo $option_value['name'] . ($option_value['price'] ? ' ' . $option_value['price_prefix'] . $option_value['price'] : ''); ?>" class="img-thumbnail" /> 
				<?php
			}
			
      // >> Product Option Image PRO module
			?>
			]]></add>
		</operation>
		
		<operation error="skip">
			<search position="after"><![CDATA[
			<input type="checkbox" name="option
			]]></search>
			<add><![CDATA[
			<?php
			// << Product Option Image PRO module

			if ($option['type'] == 'checkbox' && isset($option_value['poip_image']) && $option_value['poip_image'] ) {
				?>
				<img src="<?php echo $option_value['poip_image']; ?>" alt="<?php echo $option_value['name'] . ($option_value['price'] ? ' ' . $option_value['price_prefix'] . $option_value['price'] : ''); ?>" class="img-thumbnail" /> 
				<?php
			}
			
      // >> Product Option Image PRO module
			?>
			]]></add>
		</operation>
		
  </file>
	
	
  <file name="catalog/controller/product/product.php">
		<operation error="skip">
			<search position="after"><![CDATA[
			$product_option_value_data[] = array(
			]]></search>
			<add><![CDATA[
			
			// << Product Option Image PRO module
      
			'poip_image'                   => (isset($option_value['poip_image']) && $option_value['poip_image'])
				? ( strpos($this->model_module_product_option_image_pro->getThemeName(), 'journal2') === 0 ? Journal2Utils::resizeImage($this->model_tool_image, $option_value['poip_image'], $this->journal2->settings->get('product_page_options_push_image_width', 30), $this->journal2->settings->get('product_page_options_push_image_height', 30), 'crop') : $this->model_tool_image->resize($option_value['poip_image'], 50, 50) )
				: '',
			
      // >> Product Option Image PRO module
			
			]]></add>
		</operation>
  </file>
	
	
	
	
	<!-- Product Option Discount compatibility -->
	<file name="catalog/controller/myoc/pod.php" error="skip">
		<operation error="skip">
			<search position="after"><![CDATA[
			$product_option_value_data[] = array(
			]]></search>
			<add><![CDATA[
			
			// << Product Option Image PRO module
			'poip_image'						=> isset($product_option_value['poip_image']) ? $this->model_tool_image->resize($product_option_value['poip_image'], 50, 50) : false,
      // >> Product Option Image PRO module
			
			
			]]></add>
		</operation>
  </file>
	
	<!-- Product Option Discount compatibility -->
	<file name="catalog/view/theme/*/template/myoc/pod.tpl" error="skip">
		<operation error="skip">
			<search position="before"><![CDATA[
			<?php if($option['type'] == 'image') { ?>
			]]></search>
			<add><![CDATA[
			<?php
			// << Product Option Image PRO module
      if($option['type'] != 'image' && isset($option_value['poip_image']) && $option_value['poip_image'] ) { ?>
				<img src="<?php echo $option_value['poip_image']; ?>" alt="<?php echo $option_value['name'] . ($option_value['price'] ? ' ' . $option_value['price_prefix'] . $option_value['price'] : ''); ?>">
			<?php } 
      // >> Product Option Image PRO module
			?>
			]]></add>
		</operation>
  </file>
	
	<!-- bt_claudine boss zoom compatibility (and other bt_) -->
	<file name="catalog/controller/module/boss_zoom.php,catalog/controller/extension/module/boss_zoom.php" error="skip">
		<operation error="skip">
			<search position="after"><![CDATA[
			$results = $this->model_catalog_product->getProductImages($product_id);
			]]></search>
			<add><![CDATA[
			
			// << Product Option Image PRO module
      if ( !$this->model_module_product_option_image_pro ) {
				$this->load->model('module/product_option_image_pro');
			}
      if ( $this->model_module_product_option_image_pro->installed() ) {
				$poip_sizes = array( 	'popup_width' => $data['zoom_image_width'],
															'popup_height' => $data['zoom_image_heigth'],
															'main_width' => $data['thumb_image_width'],
															'main_height' => $data['thumb_image_heigth'],
														);
        $poip_results = $this->model_module_product_option_image_pro->addOptionImagesToProductImages($results, $product_id, array(), $poip_sizes );
        $results 									= $poip_results['results'];
        $product_images 					= $poip_results['product_images'];
				$data['poip_installed'] 	= $this->model_module_product_option_image_pro->installed();
				$data['poip_images'] 			= $product_images;
        $data['poip_theme_name'] 	= $this->model_module_product_option_image_pro->getThemeName();;
			}
      // >> Product Option Image PRO module
			
			]]></add>
		</operation>
  </file>
	
	<!-- bt_claudine boss zoom compatibility (and some other bt_) -->
	<file name="catalog/view/theme/*/template/module/boss_zoom.tpl,catalog/view/theme/*/template/extension/module/boss_zoom.tpl" error="skip">
		<operation error="skip">
			<search position="after"><![CDATA[
			<script type="text/javascript" src="catalog/view/javascript/bossthemes/cloud-zoom/cloud-zoom.1.0.3.js"></script>
			]]></search>
			<add><![CDATA[
			<script type="text/javascript"><!--
			// << Product Option Image PRO module
      <?php
			
			if (isset($poip_images)) {
				echo 'var poip_images2 = '.json_encode($poip_images);
			}
			
			?>
      // >> Product Option Image PRO module
			//--></script>
			]]></add>
		</operation>
    
    
    <operation error="skip">
			<search position="after"><![CDATA[
			<?php foreach ($images as $image) { ?>
			]]></search>
			<add><![CDATA[
      <?php
        // << Product Option Image PRO module
        if ( !empty($poip_theme_name) && $poip_theme_name == 'bt_leather' ) {
          if ( empty($poip_shown_imgs) ) $poip_shown_imgs = array();
          if ( in_array($image['popup'], $poip_shown_imgs) ) continue;
          $poip_shown_imgs[] = $image['popup'];
        }
        // >> Product Option Image PRO module
			?>
			]]></add>
		</operation>
    
  </file>
	
	<!-- iWatermark compatibility -->
	<file name="catalog/model/tool/image.php" error="skip">
		<operation error="skip">
			<search position="replace"><![CDATA[
			$inProducts = $this->db->query('(SELECT image FROM ' . DB_PREFIX . 'product p JOIN ' . DB_PREFIX . 'product_to_category p2c ON (p.product_id = p2c.product_id) WHERE p.image="' . $filename . '"' . (!empty($extra_conditions) ? ' AND (' . implode(' OR ', $extra_conditions) . ')' : '') . ') UNION (SELECT image FROM ' . DB_PREFIX . 'product_image p JOIN ' . DB_PREFIX . 'product_to_category p2c ON (p.product_id = p2c.product_id) WHERE p.image="' . $filename . '"' . (!empty($extra_conditions) ? ' AND (' . implode(' OR ', $extra_conditions) . ')' : '') . ')');
			]]></search>
			<add><![CDATA[
			
			// << Product Option Image PRO module replacement
			
			$inProducts = $this->db->query('(	SELECT image
																				FROM ' . DB_PREFIX . 'product p
																					JOIN ' . DB_PREFIX . 'product_to_category p2c ON (p.product_id = p2c.product_id)
																				WHERE p.image="' . $filename . '"' . (!empty($extra_conditions) ? '
																					AND (' . implode(' OR ', $extra_conditions) . ')' : '') . ')
																				UNION (	SELECT image
																								FROM ' . DB_PREFIX . 'product_image p
																									JOIN ' . DB_PREFIX . 'product_to_category p2c ON (p.product_id = p2c.product_id)
																									WHERE p.image="' . $filename . '"' . (!empty($extra_conditions) ? '
																										AND (' . implode(' OR ', $extra_conditions) . ')' : '') . ')
																										
																				UNION (	SELECT image
																								FROM ' . DB_PREFIX . 'poip_option_image p
																									JOIN ' . DB_PREFIX . 'product_to_category p2c ON (p.product_id = p2c.product_id)
																								WHERE p.image="' . $filename . '"' . (!empty($extra_conditions) ? '
																									AND (' . implode(' OR ', $extra_conditions) . ')' : '') . ')						
																										
																				');
			
      // >> Product Option Image PRO module replacement
			
			]]></add>
		</operation>
  </file>
	
	<!-- theme500 - do not show main image twice if it's added to additional images (and do not show additional images twice ) -->
	<file name="catalog/view/theme/theme500/template/product/product.tpl" error="skip">
		
		<operation error="skip">
			<search position="iafter"><![CDATA[<?php if (!empty($thumb)) {]]></search>
			<add><![CDATA[
			// << Product Option Image PRO
				$added_images = array($popup);
			// >> Product Option Image PRO
			]]></add>
		</operation>
		
		<operation error="skip">
			<search position="iafter"><![CDATA[<?php foreach ($images as $image) {]]></search>
			<add><![CDATA[
			// << Product Option Image PRO
				if ( in_array($image['popup'], $added_images) ) continue;
				$added_images[] = $image['popup'];
			// >> Product Option Image PRO
			]]></add>
		</operation>
		
  </file>
	
	<!-- BurnEngine (Pavilion theme, may be Kiddos too) -->
	<file name="catalog/view/theme/BurnEngine/template/product/product.tpl" error="skip">
		
		<operation error="skip">
			<search position="before"><![CDATA[<div id="product_images"]]></search>
			<add><![CDATA[
			<script type="text/javascript"><!--
			// << Product Option Image PRO
			var poip_BurnEngineSlider = false;
			var poip_BurnEngineCallback = false;
			var poip_BurnEngineZoomPreview = false;
			// >> Product Option Image PRO
			--></script>
			]]></add>
		</operation>
		
		<operation error="skip">
			<search position="before"><![CDATA[var myInterval = null;]]></search>
			<add><![CDATA[
			// << Product Option Image PRO
			poip_BurnEngineSlider = $slider;
			// >> Product Option Image PRO
			]]></add>
		</operation>
		
		<operation error="skip">
			<search position="replace"><![CDATA[if ($(this).attr('href') != $slider.slides[index].options.cover) {]]></search>
			<add><![CDATA[
			//  Product Option Image PRO replaced
			//if ( typeof($slider.slides[index]) == 'undefined' || $(this).attr('href') != $slider.slides[index].options.cover && typeof(zoom_preview) == 'function' ) {
			if (typeof($slider.slides[index]) == 'undefined' || $(this).attr('href') != $slider.slides[index].options.cover) {
				if ( typeof(zoom_preview) == 'undefined' ) {
					zoom_preview = function(){};
				}
			//if ($(this).attr('href') != $slider.slides[index].options.cover) {
			]]></add>
		</operation>
		
		<operation error="skip">
			<search position="before" offset="1"><![CDATA[$(document).one("ajaxStop.product-images", function() {]]></search>
			<add><![CDATA[
			// << Product Option Image PRO
			poip_BurnEngineCallback = callback;
			// >> Product Option Image PRO
			]]></add>
		</operation>
		
		<operation error="skip">
			<search position="before" ><![CDATA[$('#{{widget_dom_id}} .tb_zoom_box.tb_zoom_click').bind('click', function(){]]></search>
			<add><![CDATA[
			// << Product Option Image PRO
			if (typeof(zoom_preview)!='undefined') {
				poip_BurnEngineZoomPreview = zoom_preview;
			}
			// >> Product Option Image PRO
			]]></add>
		</operation>

		
		<operation error="skip">
			<search position="before"><![CDATA[<div data-mightyslider="type: 'image', cover: '<?php echo $tbData->escapeImg($image['popup']); ?>']]></search>
			<add><![CDATA[
			<?php
				// << Product Option Image PRO
				if (!empty($poip_installed) && !empty($popup) && $popup==$image['popup'] ) continue;
				// >> Product Option Image PRO
			?>
			]]></add>
		</operation>
		
  </file>
	
	<!-- seopro compatibility -->
	<file name="catalog/controller/common/seo_pro.php,catalog/controller/startup/seo_pro.php" error="skip">
		<operation error="skip">
			<search position="before"><![CDATA[
				if (isset($tmp['tracking'])) {
			]]></search>
			<add><![CDATA[
				// << Product Option Image PRO module
				if (isset($tmp['poip_ov'])) {
					$data['poip_ov'] = $tmp['poip_ov'];
				}
				// >> Product Option Image PRO module
			]]></add>
		</operation>
  </file>
	
	
	<!-- seopro compatibility -->
	<file name="catalog/controller/startup/seo_pro.php" error="skip">
		<operation error="skip">
			<search position="before"><![CDATA[
				foreach($allowed_parameters as $ap) {
			]]></search>
			<add><![CDATA[
				// << Product Option Image PRO module
				if ( !in_array('poip_ov', $allowed_parameters) ) {
					$allowed_parameters[] = 'poip_ov';
				}
				// >> Product Option Image PRO module
			]]></add>
		</operation>
  </file>
	
	<!-- opencart pro compatibility -->
	<file name="catalog/controller/startup/seo_pro.php" error="skip">
		<operation error="skip">
			<search position="after"><![CDATA[
				private $valide_routes = array(
			]]></search>
			<add><![CDATA[
				// << Product Option Image PRO module
				'poip_ov',
				// >> Product Option Image PRO module
			]]></add>
		</operation>
  </file>
	
	<!-- << sellegance compatibility -->
	<file path="catalog/controller/product/" name="category.php,special.php,manufacturer.php,search.php" error="skip">
		<operation error="skip">
			<search position="after"><![CDATA[
				if ($result['image']) {
			]]></search>
			<add><![CDATA[
				// << Product Option Image PRO module
				if (!empty($swapImg)) {
					$poip_product_image = $result['image'];
					if ( $poip_product_image == $swapImg && count($images) > 1 && !empty($images[1]['image']) ) {
						$swapImg = $images[1]['image'];
					}
				}
				// >> Product Option Image PRO module
			]]></add>
		</operation>
	</file>

	<file path="catalog/controller/module/" name="related.php,bestseller.php,latest.php,special.php,anylist.php,tabbed_products.php" error="skip">
		<operation error="skip">
			<search position="after"><![CDATA[
				if ($result['image']) {
			]]></search>
			<add><![CDATA[
				// << Product Option Image PRO module
				if (!empty($swapImg)) {
					$poip_product_image = $result['image'];
					if ( $poip_product_image == $swapImg && count($images) > 1 && !empty($images[1]['image']) ) {
						$swapImg = $images[1]['image'];
					}
				}
				// >> Product Option Image PRO module
			]]></add>
		</operation>
		<!-- featured block -->
		<operation error="skip">
			<search position="after"><![CDATA[
				if ($product_info['image']) {
			]]></search>
			<add><![CDATA[
				// << Product Option Image PRO module
				if (!empty($swapImg)) {
					$poip_product_image = $product_info['image'];
					if ( $poip_product_image == $swapImg && count($images) > 1 && !empty($images[1]['image']) ) {
						$swapImg = $images[1]['image'];
					}
				}
				// >> Product Option Image PRO module
			]]></add>
		</operation>
	</file>

	<file name="catalog/controller/module/featured.php" error="skip">
		<operation error="skip">
			<search position="after"><![CDATA[
				if ($product_info['image']) {
			]]></search>
			<add><![CDATA[
				// << Product Option Image PRO module
				if (!empty($swapImg)) {
					$poip_product_image = $product_info['image'];
					if ( $poip_product_image == $swapImg && count($images) > 1 && !empty($images[1]['image']) ) {
						$swapImg = $images[1]['image'];
					}
				}
				// >> Product Option Image PRO module
			]]></add>
		</operation>
	</file>
	<!-- >> sellegance compatibility -->

	<!-- << OC 2.3 fix -->
	<file name="admin/controller/user/user_permission.php" error="skip">
		<operation error="skip">
			<search position="before"><![CDATA[sort($files);]]></search>
			<add><![CDATA[
			// << Related Options
			if (VERSION >= '2.3.0.0') {
				$moduleFileNameOld = DIR_APPLICATION.'controller/module/product_option_image_pro.php';
				$moduleFileNameNew = DIR_APPLICATION.'controller/extension/module/product_option_image_pro.php';
				/*
				// for new controller location
				if ( in_array($moduleFileNameNew, $files) && in_array($moduleFileNameOld, $files) ) {
					$files = array_diff($files, array($moduleFileNameOld));
				}
				*/
				// for old controller location
				if (in_array($moduleFileNameOld, $files) && !in_array($moduleFileNameNew, $files)) {
					$files[] = $moduleFileNameNew;
				}
			}
			// >> Related Options
			]]></add>
		</operation>
	</file>
	
	<file name="catalog/view/theme/theme_lightshop/template/product/category_popup.tpl" error="skip">
		<operation error="skip">
			<search position="after"><![CDATA[
				<?php  foreach ($product['images'] as $image) { ?>
			]]></search>
			<add><![CDATA[
			<?php
				// << Product Option Image PRO 
				if ( !empty($product['thumb']) && $product['thumb'] == $image  ) {
					continue;
				}
				// >> Product Option Image PRO
			?>
			]]></add>
		</operation>
	</file>
	
	<!-- logancee and some other themes (maybe fastor, etc.) -->
	<file name="catalog/controller/extension/module/advanced_grid.php,catalog/controller/extension/module/filter_product.php" error="skip">
		
		<operation error="log">
			<search position="after"><![CDATA[
				public function index(
			]]></search>
			<add><![CDATA[
				// Product Option Image PRO module <<
				
				if ( !$this->model_module_product_option_image_pro ) {
					$this->load->model('module/product_option_image_pro');
				}
				$data['poip_installed'] = $this->model_module_product_option_image_pro->installed();
				$data['current_class'] = str_replace("Controller", "", get_class($this));
				$data['poip_theme_name'] = $this->model_module_product_option_image_pro->getThemeName();
				
				// >> Product Option Image PRO module
			]]></add>
		</operation>
		
		<operation error="log">
      <search position="after"><![CDATA[
				'product_id' => $result['product_id'],
      ]]></search>
      <add><![CDATA[
				// Product Option Image PRO module <<
				'option_images'  => $this->model_module_product_option_image_pro->getCategoryImages( $result['product_id'], isset($setting) ? $setting : false ),
				// >> Product Option Image PRO module
      ]]></add>
    </operation>
		
		<operation error="log">
      <search position="after"><![CDATA[
				'product_id' => $product_info['product_id'],
      ]]></search>
      <add><![CDATA[
				// Product Option Image PRO module <<
				'option_images'  => $this->model_module_product_option_image_pro->getCategoryImages( $product_info['product_id'], isset($setting) ? $setting : false ),
				// >> Product Option Image PRO module
      ]]></add>
    </operation>
		
	</file>
	
	<!-- logancee and some other themes (maybe fastor, etc.) -->
	<file path="catalog/view/theme/*/template/extension/module/" name="advanced_grid/products/*,advanced_grid/products_tabs/*,filter_product.tpl" error="skip">
		
		<operation error="log">
			<search position="iafter" regex="true">
				<![CDATA[~alt="'[ ]*\.[ ]*\$product\['name'\][ ]*\.[ ]*'"~]]>
			</search>
			<add><![CDATA[
				<?php
					// << Product Option Image PRO
					if (!isset($current_class)) $current_class = (microtime(true)*10000).rand(0,1000000);
					echo 'data-poip_id="image_'.$current_class.'_'.$product['product_id'].'"';
					if ( !empty($product['option_images']) ) {
						echo 'data-poip-images="'.htmlspecialchars(json_encode( $product['option_images']), ENT_QUOTES, 'UTF-8' ).'"';
					}
				  // >> Product Option Image PRO
				?>
				]]></add>
		</operation>
		
		<operation error="skip">
			<search position="ireplace"><![CDATA[
				include('catalog/view/theme/'.$config->get($config->get('config_theme') . '_directory').'/template/new_elements/product.tpl');
			]]></search>
			<add><![CDATA[
				// Product Option Image PRO module <<
				$poip_include_path = 'catalog/view/theme/'.$config->get($config->get('config_theme') . '_directory').'/template/new_elements/product.tpl';
				if ( !empty($poip_installed) ) {
					if ( class_exists('VQMod') ) {
						include( VQMod::modCheck( modification($poip_include_path) ) );
					} else {
						include( modification($poip_include_path) );
					}
				} else { // theme standard
					include( $poip_include_path);
				}
				
				// >> Product Option Image PRO module
			]]></add>
		</operation>
		
	</file>
	
	<!-- logancee and some other themes (maybe fastor, etc.) -->
	<file path="catalog/view/theme/*/template/extension/module/" name="advanced_grid/advanced_grid.tpl" error="skip">
		
		<operation error="skip">
			<search position="ireplace"><![CDATA[
				include('catalog/view/theme/' . $config->get($config->get('config_theme') . '_directory') . '/template/extension/module/advanced_grid/products/' . $module['content']['module_template'] . '');
			]]></search>
			<add><![CDATA[
				// Product Option Image PRO module <<
				
				$poip_include_path = 'catalog/view/theme/' . $config->get($config->get('config_theme') . '_directory') . '/template/extension/module/advanced_grid/products/' . $module['content']['module_template'] . '';
				if ( !empty($poip_installed) ) {
					if ( class_exists('VQMod') ) {
						include( VQMod::modCheck( modification($poip_include_path) ) );
					} else {
						include( modification($poip_include_path) );
					}
				} else { // theme standard
					include( $poip_include_path);
				}
				
				// >> Product Option Image PRO module
			]]></add>
		</operation>
		
		<operation error="skip">
			<search position="ireplace"><![CDATA[
				include('catalog/view/theme/' . $config->get($config->get('config_theme') . '_directory') . '/template/extension/module/advanced_grid/products_tabs/' . $module['content']['module_template'] . '');
			]]></search>
			<add><![CDATA[
				// Product Option Image PRO module <<
				
				$poip_include_path = 'catalog/view/theme/' . $config->get($config->get('config_theme') . '_directory') . '/template/extension/module/advanced_grid/products_tabs/' . $module['content']['module_template'] . '';
				if ( !empty($poip_installed) ) {
					if ( class_exists('VQMod') ) {
						include( VQMod::modCheck( modification($poip_include_path) ) );
					} else {
						include( modification($poip_include_path) );
					}
				} else { // theme standard
					include( $poip_include_path);
				}
				
				// >> Product Option Image PRO module
			]]></add>
		</operation>
		
	</file>
	
	<!-- compatibility old version fix -->
	<file name="admin/controller/event/compatibility.php" error="skip">
		<operation error="skip">
			<search position="after"><![CDATA[$route = $part[1] . '/' . $part[2];]]></search>
			<add><![CDATA[
			// << Product Option Image PRO
			if (VERSION >= '2.3.0.0') {
				if (!empty($part[3])) {
					$route = $route . '/' . $part[3];
					unset($part[3]);
					$part = array_values($part);
				}
			}
			// >> Product Option Image PRO
			]]></add>
		</operation>
	</file>
	<!-- >> OC 2.3 fix -->
	
</modification>